import{k as Op,p as Fp,q as Bp,b as jp}from"./web-DuEVvOp5.js";import{C as sr,S as Wp}from"./chess-lriRiorr.js";var Re=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Up(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}function Ip(m){if(m.__esModule)return m;var n=m.default;if(typeof n=="function"){var c=function p(){return this instanceof p?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};c.prototype=n.prototype}else c={};return Object.defineProperty(c,"__esModule",{value:!0}),Object.keys(m).forEach(function(p){var d=Object.getOwnPropertyDescriptor(m,p);Object.defineProperty(c,p,d.get?d:{enumerable:!0,get:function(){return m[p]}})}),c}var Ws={exports:{}};(function(m,n){(function(c,p){p(n)})(Re,function(c){var p=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Re<"u"?Re:typeof self<"u"?self:{};function d(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var b={exports:{}};(function(N){(function(W,Y){N.exports&&(N.exports=Y())})(p,function(){function W(f,F){function r(){this.constructor=f}r.prototype=F.prototype,f.prototype=new r}function Y(f,F,r,X){var z=Error.call(this,f);return Object.setPrototypeOf&&Object.setPrototypeOf(z,Y.prototype),z.expected=F,z.found=r,z.location=X,z.name="SyntaxError",z}W(Y,Error);function ae(f,F,r){return r=r||" ",f.length>F?f:(F-=f.length,r+=r.repeat(F),f+r.slice(0,F))}Y.prototype.format=function(f){var F="Error: "+this.message;if(this.location){var r=null,X;for(X=0;X<f.length;X++)if(f[X].source===this.location.source){r=f[X].text.split(/\r\n|\n|\r/g);break}var z=this.location.start,K=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(z):z,oe=this.location.source+":"+K.line+":"+K.column;if(r){var ne=this.location.end,V=ae("",K.line.toString().length," "),q=r[z.line-1],G=z.line===ne.line?ne.column:q.length+1,ee=G-z.column||1;F+=`
 --> `+oe+`
`+V+` |
`+K.line+" | "+q+`
`+V+" | "+ae("",z.column-1," ")+ae("",ee,"^")}else F+=`
 at `+oe}return F},Y.buildMessage=function(f,F){var r={literal:function(q){return'"'+z(q.text)+'"'},class:function(q){var G=q.parts.map(function(ee){return Array.isArray(ee)?K(ee[0])+"-"+K(ee[1]):K(ee)});return"["+(q.inverted?"^":"")+G.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(q){return q.description}};function X(q){return q.charCodeAt(0).toString(16).toUpperCase()}function z(q){return q.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(G){return"\\x0"+X(G)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(G){return"\\x"+X(G)})}function K(q){return q.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(G){return"\\x0"+X(G)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(G){return"\\x"+X(G)})}function oe(q){return r[q.type](q)}function ne(q){var G=q.map(oe),ee,ue;if(G.sort(),G.length>0){for(ee=1,ue=1;ee<G.length;ee++)G[ee-1]!==G[ee]&&(G[ue]=G[ee],ue++);G.length=ue}switch(G.length){case 1:return G[0];case 2:return G[0]+" or "+G[1];default:return G.slice(0,-1).join(", ")+", or "+G[G.length-1]}}function V(q){return q?'"'+z(q)+'"':"end of input"}return"Expected "+ne(f)+" but "+V(F)+" found."};function Q(f,F){F=F!==void 0?F:{};var r={},X=F.grammarSource,z={pgn:Et,tags:Xa,game:cs,games:Tv},K=Et,oe="\uFEFF",ne="Event",V="event",q="Site",G="site",ee="Date",ue="date",be="Round",Ce="round",Sr="White",ir="white",Dt="Black",Tt="black",Rt="Result",nr="result",Ne="WhiteTitle",Fe="Whitetitle",Mr="whitetitle",fr="whiteTitle",Dr="BlackTitle",Tr="Blacktitle",Rr="blacktitle",Nt="blackTitle",Nr="WhiteELO",Pt="WhiteElo",Pr="Whiteelo",Or="whiteelo",or="whiteElo",Fr="BlackELO",Ae="BlackElo",Ot="Blackelo",pe="blackelo",Br="blackElo",lr="WhiteUSCF",jr="WhiteUscf",Ke="Whiteuscf",Ee="whiteuscf",De="whiteUscf",Wr="BlackUSCF",we="BlackUscf",Ft="Blackuscf",Ur="blackuscf",Ir="blackUscf",qr="WhiteNA",Kr="WhiteNa",Bt="Whitena",Gr="whitena",Pe="whiteNa",jt="whiteNA",Ge="BlackNA",zr="BlackNa",Wt="Blackna",Lr="blackna",Yr="blackNA",Hr="blackNa",Xr="WhiteType",ze="Whitetype",Vr="whitetype",Qr="whiteType",Zr="BlackType",Ut="Blacktype",It="blacktype",qt="blackType",cr="EventDate",Le="Eventdate",Kt="eventdate",ur="eventDate",Gt="EventSponsor",zt="Eventsponsor",Lt="eventsponsor",Be="eventSponsor",Yt="Section",Ht="section",Jr="Stage",Xt="stage",gr="Board",et="board",vr="Opening",rt="opening",tt="Variation",st="variation",at="SubVariation",it="Subvariation",pr="subvariation",hr="subVariation",nt="ECO",Ye="Eco",ft="eco",ot="NIC",dr="Nic",lt="nic",Vt="Time",Qt="time",Zt="UTCTime",Jt="UTCtime",$r="UtcTime",es="Utctime",ct="utctime",ie="utcTime",ut="UTCDate",gt="UTCdate",vt="UtcDate",Oe="Utcdate",pt="utcdate",ht="utcDate",mr="TimeControl",dt="Timecontrol",$t="timecontrol",br="timeControl",mt="SetUp",wr="Setup",He="setup",bt="setUp",wt="FEN",yr="Fen",Xe="fen",yt="Termination",Ve="termination",rs="Annotator",_t="annotator",u="Mode",w="mode",y="PlyCount",D="Plycount",j="plycount",O="plyCount",U="Variant",le="variant",ye="WhiteRatingDiff",de="BlackRatingDiff",ve="WhiteFideId",xt="BlackFideId",At="WhiteTeam",A="BlackTeam",te="Clock",fe="WhiteClock",Te="BlackClock",Qe='"',Ys="\\",ts=".",_r=":",ds="/",Hs="?",Xs="-",$s="+",Vs="*",Qs="1-0",Zs="0-1",Js="1/2-1/2",ea="1/2",ra="=",ta="%csl",sa="%cal",ms="%",aa="%eval",ia="[%",na="}",ss=",",Yi="Y",Hi="G",Xi="R",Vi="B",Qi="O",Zi="C",Ji="{",en="[",rn="]",tn=";",fa="clk",oa="egt",la="emt",ca="mct",sn="(",an=")",ua=" ",nn="e.p.",ga="O-O-O",va="O-O",fn="@",pa="Z0",as="+-",ha="$$$",on="#",ln="$",da="!!",$a="??",ma="!?",ba="?!",cn="!",un="‼",gn="⁇",vn="⁉",pn="⁈",hn="□",dn="∞",$n="⩲",mn="⩱",bn="±",wn="∓",wa="-+",yn="⨀",_n="⟳",xn="→",An="↑",kn="⇆",Cn="D",En="x",xr=/^[ \t\n\r]/,ya=/^[\n\r]/,_a=/^[\-a-zA-Z0-9_.]/,Sn=/^[^"\\\r\n]/,je=/^[0-9?]/,_e=/^[0-9]/,Mn=/^[BNW]/,xa=/^[^\n\r]/,Dn=/^[1-8a-h]/,Tn=/^[RNBQKP]/,Rn=/^[RNBQ]/,Nn=/^[a-h]/,Pn=/^[1-8]/,On=/^[\-x]/,Fn=v("\uFEFF",!1),Bn=v("Event",!1),jn=v("event",!1),Wn=v("Site",!1),Un=v("site",!1),In=v("Date",!1),qn=v("date",!1),Kn=v("Round",!1),Gn=v("round",!1),zn=v("White",!1),Ln=v("white",!1),Yn=v("Black",!1),Hn=v("black",!1),Xn=v("Result",!1),Vn=v("result",!1),Qn=v("WhiteTitle",!1),Zn=v("Whitetitle",!1),Jn=v("whitetitle",!1),ef=v("whiteTitle",!1),rf=v("BlackTitle",!1),tf=v("Blacktitle",!1),sf=v("blacktitle",!1),af=v("blackTitle",!1),nf=v("WhiteELO",!1),ff=v("WhiteElo",!1),of=v("Whiteelo",!1),lf=v("whiteelo",!1),cf=v("whiteElo",!1),uf=v("BlackELO",!1),gf=v("BlackElo",!1),vf=v("Blackelo",!1),pf=v("blackelo",!1),hf=v("blackElo",!1),df=v("WhiteUSCF",!1),$f=v("WhiteUscf",!1),mf=v("Whiteuscf",!1),bf=v("whiteuscf",!1),wf=v("whiteUscf",!1),yf=v("BlackUSCF",!1),_f=v("BlackUscf",!1),xf=v("Blackuscf",!1),Af=v("blackuscf",!1),kf=v("blackUscf",!1),Cf=v("WhiteNA",!1),Ef=v("WhiteNa",!1),Sf=v("Whitena",!1),Mf=v("whitena",!1),Df=v("whiteNa",!1),Tf=v("whiteNA",!1),Rf=v("BlackNA",!1),Nf=v("BlackNa",!1),Pf=v("Blackna",!1),Of=v("blackna",!1),Ff=v("blackNA",!1),Bf=v("blackNa",!1),jf=v("WhiteType",!1),Wf=v("Whitetype",!1),Uf=v("whitetype",!1),If=v("whiteType",!1),qf=v("BlackType",!1),Kf=v("Blacktype",!1),Gf=v("blacktype",!1),zf=v("blackType",!1),Lf=v("EventDate",!1),Yf=v("Eventdate",!1),Hf=v("eventdate",!1),Xf=v("eventDate",!1),Vf=v("EventSponsor",!1),Qf=v("Eventsponsor",!1),Zf=v("eventsponsor",!1),Jf=v("eventSponsor",!1),eo=v("Section",!1),ro=v("section",!1),to=v("Stage",!1),so=v("stage",!1),ao=v("Board",!1),io=v("board",!1),no=v("Opening",!1),fo=v("opening",!1),oo=v("Variation",!1),lo=v("variation",!1),co=v("SubVariation",!1),uo=v("Subvariation",!1),go=v("subvariation",!1),vo=v("subVariation",!1),po=v("ECO",!1),ho=v("Eco",!1),$o=v("eco",!1),mo=v("NIC",!1),bo=v("Nic",!1),wo=v("nic",!1),yo=v("Time",!1),_o=v("time",!1),xo=v("UTCTime",!1),Ao=v("UTCtime",!1),ko=v("UtcTime",!1),Co=v("Utctime",!1),Eo=v("utctime",!1),So=v("utcTime",!1),Mo=v("UTCDate",!1),Do=v("UTCdate",!1),To=v("UtcDate",!1),Ro=v("Utcdate",!1),No=v("utcdate",!1),Po=v("utcDate",!1),Oo=v("TimeControl",!1),Fo=v("Timecontrol",!1),Bo=v("timecontrol",!1),jo=v("timeControl",!1),Wo=v("SetUp",!1),Uo=v("Setup",!1),Io=v("setup",!1),qo=v("setUp",!1),Ko=v("FEN",!1),Go=v("Fen",!1),zo=v("fen",!1),Lo=v("Termination",!1),Yo=v("termination",!1),Ho=v("Annotator",!1),Xo=v("annotator",!1),Vo=v("Mode",!1),Qo=v("mode",!1),Zo=v("PlyCount",!1),Jo=v("Plycount",!1),el=v("plycount",!1),rl=v("plyCount",!1),tl=v("Variant",!1),sl=v("variant",!1),al=v("WhiteRatingDiff",!1),il=v("BlackRatingDiff",!1),nl=v("WhiteFideId",!1),fl=v("BlackFideId",!1),ol=v("WhiteTeam",!1),ll=v("BlackTeam",!1),cl=v("Clock",!1),ul=v("WhiteClock",!1),gl=v("BlackClock",!1),Aa=Ya("whitespace"),Ar=$e([" ","	",`
`,"\r"],!1,!1),ka=$e([`
`,"\r"],!1,!1),Ca=$e(["-",["a","z"],["A","Z"],["0","9"],"_","."],!1,!1),is=v('"',!1),vl=$e(['"',"\\","\r",`
`],!0,!1),Ea=v("\\",!1),We=$e([["0","9"],"?"],!1,!1),ns=v(".",!1),xe=$e([["0","9"]],!1,!1),kr=v(":",!1),bs=v("/",!1),pl=$e(["B","N","W"],!1,!1),Sa=v("?",!1),Ma=v("-",!1),ws=v("+",!1),Da=v("*",!1),hl=v("1-0",!1),dl=v("0-1",!1),$l=v("1/2-1/2",!1),ml=v("1/2",!1),ys=v("=",!1),bl=v("%csl",!1),wl=v("%cal",!1),_s=v("%",!1),yl=v("%eval",!1),_l=v("[%",!1),Ta=v("}",!1),Ra=Sv(),Na=$e([`
`,"\r"],!0,!1),fs=v(",",!1),xl=v("Y",!1),Al=v("G",!1),kl=v("R",!1),Cl=v("B",!1),El=v("O",!1),Sl=v("C",!1),Ml=v("{",!1),Dl=v("[",!1),Tl=v("]",!1),Rl=v(";",!1),Nl=v("clk",!1),Pl=v("egt",!1),Ol=v("emt",!1),Fl=v("mct",!1),Bl=v("(",!1),jl=v(")",!1),Wl=Ya("integer"),Pa=v(" ",!1),Ul=v("e.p.",!1),Il=v("O-O-O",!1),ql=v("O-O",!1),Kl=v("@",!1),Gl=v("Z0",!1),Oa=v("+-",!1),zl=v("$$$",!1),Ll=v("#",!1),Yl=v("$",!1),Hl=v("!!",!1),Xl=v("??",!1),Vl=v("!?",!1),Ql=v("?!",!1),Zl=v("!",!1),Jl=v("‼",!1),ec=v("⁇",!1),rc=v("⁉",!1),tc=v("⁈",!1),sc=v("□",!1),ac=v("∞",!1),ic=v("⩲",!1),nc=v("⩱",!1),fc=v("±",!1),oc=v("∓",!1),lc=v("-+",!1),cc=v("⨀",!1),uc=v("⟳",!1),gc=v("→",!1),vc=v("↑",!1),pc=v("⇆",!1),hc=v("D",!1),dc=$e([["1","8"],["a","h"]],!1,!1),$c=$e(["R","N","B","Q","K","P"],!1,!1),mc=$e(["R","N","B","Q"],!1,!1),bc=$e([["a","h"]],!1,!1),wc=$e([["1","8"]],!1,!1),yc=v("x",!1),_c=$e(["-","x"],!1,!1),Fa=function(e,s){return s},xc=function(e,s){return[e].concat(s)},Ac=function(e){return e},kc=function(e,s,i){var a=hs;return hs=[],{tags:e,gameComment:s,moves:i,messages:a}},Ba=function(e,s){return s},Cc=function(e,s){var i={};return[e].concat(s).forEach(function(a){i[a.name]=a.value}),i},Ec=function(e){return e===null?{}:(e.messages=hs,e)},Sc=function(e){return e},Mc=function(e){return{name:"Event",value:e}},Dc=function(e){return{name:"Site",value:e}},Tc=function(e){return{name:"Date",value:e}},Rc=function(e){return{name:"Round",value:e}},Nc=function(e){return{name:"WhiteTitle",value:e}},Pc=function(e){return{name:"BlackTitle",value:e}},Oc=function(e){return{name:"WhiteElo",value:e}},Fc=function(e){return{name:"BlackElo",value:e}},Bc=function(e){return{name:"WhiteUSCF",value:e}},jc=function(e){return{name:"BlackUSCF",value:e}},Wc=function(e){return{name:"WhiteNA",value:e}},Uc=function(e){return{name:"BlackNA",value:e}},Ic=function(e){return{name:"WhiteType",value:e}},qc=function(e){return{name:"BlackType",value:e}},Kc=function(e){return{name:"White",value:e}},Gc=function(e){return{name:"Black",value:e}},zc=function(e){return{name:"Result",value:e}},Lc=function(e){return{name:"EventDate",value:e}},Yc=function(e){return{name:"EventSponsor",value:e}},Hc=function(e){return{name:"Section",value:e}},Xc=function(e){return{name:"Stage",value:e}},Vc=function(e){return{name:"Board",value:e}},Qc=function(e){return{name:"Opening",value:e}},Zc=function(e){return{name:"Variation",value:e}},Jc=function(e){return{name:"SubVariation",value:e}},eu=function(e){return{name:"ECO",value:e}},ru=function(e){return{name:"NIC",value:e}},tu=function(e){return{name:"Time",value:e}},su=function(e){return{name:"UTCTime",value:e}},au=function(e){return{name:"UTCDate",value:e}},iu=function(e){return{name:"TimeControl",value:e}},nu=function(e){return{name:"SetUp",value:e}},fu=function(e){return{name:"FEN",value:e}},ou=function(e){return{name:"Termination",value:e}},lu=function(e){return{name:"Annotator",value:e}},cu=function(e){return{name:"Mode",value:e}},uu=function(e){return{name:"PlyCount",value:e}},gu=function(e){return{name:"Variant",value:e}},vu=function(e){return{name:"WhiteRatingDiff",value:e}},pu=function(e){return{name:"BlackRatingDiff",value:e}},hu=function(e){return{name:"WhiteFideId",value:e}},du=function(e){return{name:"BlackFideId",value:e}},$u=function(e){return{name:"WhiteTeam",value:e}},mu=function(e){return{name:"BlackTeam",value:e}},bu=function(e){return{name:"Clock",value:e}},wu=function(e){return{name:"WhiteClock",value:e}},yu=function(e){return{name:"BlackClock",value:e}},_u=function(e,s){return me({key:e,value:s,message:`Format of tag: "${e}" not correct: "${s}"`}),{name:e,value:s}},xu=function(e,s){return me({key:e,value:s,message:`Tag: "${e}" not known: "${s}"`}),{name:e,value:s}},Au=function(e){return e.join("")},ku=function(e){return e.map(s=>s.char||s).join("")},Cu=function(){return{type:"char",char:"\\"}},Eu=function(){return{type:"char",char:'"'}},Su=function(e){return e},Mu=function(e,s,i){return{value:""+e.join("")+"."+s.join("")+"."+i.join(""),year:rr(e),month:rr(s),day:rr(i)}},Du=function(e,s,i,a){let h=e.join("")+":"+s.join("")+":"+i.join(""),_=0;return a&&(h=h+"."+a,me({message:`Unusual use of millis in time: ${h}`}),rr(a)),{value:h,hour:rr(e),minute:rr(s),second:rr(i),millis:_}},Tu=function(e){return e.join("")},Ru=function(e){return e},Nu=function(e,s){return e+"/"+s},Pu=function(e){return e},Ou=function(e){return e},Fu=function(e){return e||(me({message:"Tag TimeControl has to have a value"}),"")},ja=function(e,s){return s},Bu=function(e,s){let i=[e].concat(s);return i.value=i.map(a=>a.value).join(":"),i},ju=function(e){return e},Wu=function(){return{kind:"unknown",value:"?"}},Uu=function(){return{kind:"unlimited",value:"-"}},Iu=function(e,s,i){return{kind:"movesInSecondsIncrement",moves:e,seconds:s,increment:i,value:""+e+"/"+s+"+"+i}},qu=function(e,s){return{kind:"movesInSeconds",moves:e,seconds:s,value:""+e+"/"+s}},Ku=function(e,s){return{kind:"increment",seconds:e,increment:s,value:""+e+"+"+s}},Gu=function(e){return{kind:"suddenDeath",seconds:e,value:""+e}},zu=function(e){return{kind:"hourglass",seconds:e,value:"*"+e}},Lu=function(e){return e},Yu=function(e){return e},Hu=function(e){return e},Xu=function(e){return e},Vu=function(){return"1/2-1/2"},Qu=function(e){return e},Zu=function(e){return e},Ju=function(){return 0},eg=function(){return me({message:'Use "-" for an unknown value'}),0},rg=function(e){return Ps(e)},tg=function(e,s,i,a,h,_,M,B){var L=B||[],se={};return se.moveNumber=s,se.notation=i,_&&(se.commentAfter=_.comment),e&&(se.commentMove=e.comment),h&&(se.drawOffer=!0),se.variations=M||[],se.nag=a||null,L.unshift(se),se.commentDiag=_,L},sg=function(e){return e},ag=function(e){return[e]},Wa=function(e,s){return s},ig=function(e,s){return qe([e].concat(s))},ng=function(){},fg=function(e){return e},og=function(e){return{comment:e}},Ua=function(e,s){return s},lg=function(e,s){return qe([{colorFields:e}].concat(s[0]))},Ia=function(e,s){return s},cg=function(e,s){return qe([{colorArrows:e}].concat(s[0]))},qa=function(e,s,i){return i},ug=function(e,s,i){var a={};return a[e]=s,qe([a].concat(i[0]))},Ka=function(e,s,i){return i},gg=function(e,s,i){var a={};return a[e]=s,qe([a].concat(i[0]))},Ga=function(e,s){return s},vg=function(e,s){var i={};return i.eval=parseFloat(e),qe([i].concat(s[0]))},za=function(e,s,i){return i},pg=function(e,s,i){var a={};return a[e]=s.join(""),qe([a].concat(i[0]))},La=function(e,s){return s},hg=function(e,s){return s.length>0?qe([{comment:Pi(e.join(""))}].concat(Ni(s[0]))):{comment:e.join("")}},dg=function(e){return e},$g=function(e){return e},mg=function(e){return e.join("")},bg=function(e,s){var i=[];i.push(e);for(var a=0;a<s.length;a++)i.push(s[a][2]);return i},wg=function(e,s){return e+s},yg=function(e,s){var i=[];i.push(e);for(var a=0;a<s.length;a++)i.push(s[a][2]);return i},_g=function(e,s,i){return e+s+i},xg=function(){return"Y"},Ag=function(){return"G"},kg=function(){return"R"},Cg=function(){return"B"},Eg=function(){return"O"},Sg=function(){return"C"},Mg=function(e,s){return e+s},Dg=function(){return"clk"},Tg=function(){return"egt"},Rg=function(){return"emt"},Ng=function(){return"mct"},Pg=function(e,s,i,a){let h=s;return e?h=e+h:me({message:"Hours and minutes missing"}),e&&(e.match(/:/g)||[]).length==2&&e.search(":")==2&&me({message:"Only 1 digit for hours normally used"}),i?h+=i:me({message:"Only 2 digit for seconds normally used"}),a&&(me({message:"Unusual use of millis in clock value"}),h+="."+a),h},Og=function(e,s,i){let a=s;return e?a=e+a:me({message:"Hours and minutes missing"}),e&&(e.match(/:/g)||[]).length==2&&e.search(":")==1&&me({message:"Only 2 digits for hours normally used"}),i?a+=i:me({message:"Only 2 digit for seconds normally used"}),a},Fg=function(e,s){return s?e+s:(me({message:"No hours found"}),e)},Bg=function(e,s){let i=e;return s?i+=s+":":i+=":",i},jg=function(e,s){let i=e;return s?i+=s+":":(i+=":",me({message:"Only 2 digits for minutes normally used"})),i},Wg=function(e){return e},Ug=function(e,s){var i=s||[];return i.unshift(e),i},Ig=function(e){return e},qg=function(e){return Ps(e)},Kg=function(){return""},Gg=function(e,s,i,a,h,_,M){var B={};return B.fig=e||null,B.disc=s||null,B.strike=i||null,B.col=a,B.row=h,B.check=M||null,B.promotion=_,B.notation=(e||"")+(s||"")+(i||"")+a+h+(_||"")+(M||""),B},zg=function(e,s,i,a,h,_,M,B){var L={};return L.fig=e||null,L.strike=a=="x"?a:null,L.col=h,L.row=_,L.notation=(e&&e!=="P"?e:"")+s+i+(a=="x"?a:"-")+h+_+(M||"")+(B||""),L.check=B||null,L.promotion=M,L},Lg=function(e,s,i,a,h,_){var M={};return M.fig=e||null,M.strike=s||null,M.col=i,M.row=a,M.check=_||null,M.promotion=h,M.notation=(e||"")+(s||"")+i+a+(h||"")+(_||""),M},Yg=function(e){var s={};return s.notation="O-O-O"+(e||""),s.check=e||null,s},Hg=function(e){var s={};return s.notation="O-O"+(e||""),s.check=e||null,s},Xg=function(e,s,i){var a={};return a.fig=e,a.drop=!0,a.col=s,a.row=i,a.notation=e+"@"+s+i,a},Vg=function(){var e={};return e.notation="Z0",e},Qg=function(e){return e[1]},Zg=function(e){return e[1]},Jg=function(e){return"="+e},ev=function(e,s){var i=s||[];return i.unshift(e),i},rv=function(e){return"$"+e},tv=function(){return"$3"},sv=function(){return"$4"},av=function(){return"$5"},iv=function(){return"$6"},nv=function(){return"$1"},fv=function(){return"$2"},ov=function(){return"$3"},lv=function(){return"$4"},cv=function(){return"$5"},uv=function(){return"$6"},gv=function(){return"$7"},vv=function(){return"$10"},pv=function(){return"$13"},hv=function(){return"$14"},dv=function(){return"$15"},$v=function(){return"$16"},mv=function(){return"$17"},bv=function(){return"$18"},wv=function(){return"$19"},yv=function(){return"$22"},_v=function(){return"$32"},xv=function(){return"$36"},Av=function(){return"$40"},kv=function(){return"$132"},Cv=function(){return"$220"},t=F.peg$currPos|0,$=t,Cr=[{line:1,column:1}],Se=t,os=F.peg$maxFailExpected||[],o=F.peg$silentFails|0,kt;if(F.startRule){if(!(F.startRule in z))throw new Error(`Can't start parsing from rule "`+F.startRule+'".');K=z[F.startRule]}function Ev(){return xs($,t)}function v(e,s){return{type:"literal",text:e,ignoreCase:s}}function $e(e,s,i){return{type:"class",parts:e,inverted:s,ignoreCase:i}}function Sv(){return{type:"any"}}function Mv(){return{type:"end"}}function Ya(e){return{type:"other",description:e}}function Ha(e){var s=Cr[e],i;if(s)return s;if(e>=Cr.length)i=Cr.length-1;else for(i=e;!Cr[--i];);for(s=Cr[i],s={line:s.line,column:s.column};i<e;)f.charCodeAt(i)===10?(s.line++,s.column=1):s.column++,i++;return Cr[e]=s,s}function xs(e,s,i){var a=Ha(e),h=Ha(s),_={source:X,start:{offset:e,line:a.line,column:a.column},end:{offset:s,line:h.line,column:h.column}};return _}function l(e){t<Se||(t>Se&&(Se=t,os=[]),os.push(e))}function Dv(e,s,i){return new Y(Y.buildMessage(e,s),e,s,i)}function ls(){var e;return f.charCodeAt(t)===65279?(e=oe,t++):(e=r,o===0&&l(Fn)),e}function Tv(){var e,s,i,a,h,_;if(e=t,ls(),T(),s=t,i=cs(),i!==r){for(a=[],h=t,T(),_=cs(),_!==r?($=h,h=Fa(i,_)):(t=h,h=r);h!==r;)a.push(h),h=t,T(),_=cs(),_!==r?($=h,h=Fa(i,_)):(t=h,h=r);$=s,s=xc(i,a)}else t=s,s=r;return s===r&&(s=null),$=e,e=Ac(s),e}function cs(){var e,s,i,a;return e=t,ls(),s=Xa(),i=Es(),i===r&&(i=null),a=Et(),a!==r?($=e,e=kc(s,i,a)):(t=e,e=r),e}function Xa(){var e,s,i,a,h,_;if(e=t,ls(),T(),s=t,i=As(),i!==r){for(a=[],h=t,T(),_=As(),_!==r?($=h,h=Ba(i,_)):(t=h,h=r);h!==r;)a.push(h),h=t,T(),_=As(),_!==r?($=h,h=Ba(i,_)):(t=h,h=r);$=s,s=Cc(i,a)}else t=s,s=r;return s===r&&(s=null),i=T(),$=e,e=Ec(s),e}function As(){var e,s,i,a;return e=t,s=Ze(),s!==r?(T(),i=Rv(),i!==r?(T(),a=Ue(),a!==r?($=e,e=Sc(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Rv(){var e,s,i,a,h;return e=t,s=Nv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Mc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Pv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Dc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Qa(),s!==r?(i=T(),a=ks(),a!==r?($=e,e=Tc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Ov(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Rc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=jv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Nc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Wv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Pc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Ja(),s!==r?(i=T(),a=wi(),a!==r?($=e,e=Oc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ei(),s!==r?(i=T(),a=wi(),a!==r?($=e,e=Fc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ri(),s!==r?(i=T(),a=Ct(),a!==r?($=e,e=Bc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ti(),s!==r?(i=T(),a=Ct(),a!==r?($=e,e=jc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Uv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Wc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Iv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Uc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=qv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Ic(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Kv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=qc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Fv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Kc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Bv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Gc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Za(),s!==r?(i=T(),a=$p(),a!==r?($=e,e=zc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=si(),s!==r?(i=T(),a=ks(),a!==r?($=e,e=Lc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Gv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Yc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=zv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Hc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Lv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Xc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ai(),s!==r?(i=T(),a=Ct(),a!==r?($=e,e=Vc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Yv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Qc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Hv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Zc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Xv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=Jc(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Vv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=eu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Qv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=ru(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ii(),s!==r?(i=T(),a=hi(),a!==r?($=e,e=tu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ni(),s!==r?(i=T(),a=hi(),a!==r?($=e,e=su(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=fi(),s!==r?(i=T(),a=ks(),a!==r?($=e,e=au(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=oi(),s!==r?(i=T(),a=hp(),a!==r?($=e,e=iu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Zv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=nu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Jv(),s!==r?(i=T(),a=J(),a!==r?($=e,e=fu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ep(),s!==r?(i=T(),a=J(),a!==r?($=e,e=ou(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=rp(),s!==r?(i=T(),a=J(),a!==r?($=e,e=lu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=tp(),s!==r?(i=T(),a=J(),a!==r?($=e,e=cu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=li(),s!==r?(i=T(),a=Ct(),a!==r?($=e,e=uu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=sp(),s!==r?(i=T(),a=J(),a!==r?($=e,e=gu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ap(),s!==r?(i=T(),a=J(),a!==r?($=e,e=vu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ip(),s!==r?(i=T(),a=J(),a!==r?($=e,e=pu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=np(),s!==r?(i=T(),a=J(),a!==r?($=e,e=hu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=fp(),s!==r?(i=T(),a=J(),a!==r?($=e,e=du(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=op(),s!==r?(i=T(),a=J(),a!==r?($=e,e=$u(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=lp(),s!==r?(i=T(),a=J(),a!==r?($=e,e=mu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ci(),s!==r?(i=T(),a=gp(),a!==r?($=e,e=bu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ui(),s!==r?(i=T(),a=$i(),a!==r?($=e,e=wu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=gi(),s!==r?(i=T(),a=$i(),a!==r?($=e,e=yu(a)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=t,o++,i=Va(),o--,i!==r?(t=s,s=void 0):s=r,s!==r?(i=us(),a=T(),h=J(),h!==r?($=e,e=_u(i,h)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=t,o++,i=Va(),o--,i===r?s=void 0:(t=s,s=r),s!==r?(i=us(),a=T(),h=J(),h!==r?($=e,e=xu(i,h)):(t=e,e=r)):(t=e,e=r))))))))))))))))))))))))))))))))))))))))))))))))),e}function Va(){var e;return e=Qa(),e===r&&(e=Ja(),e===r&&(e=ei(),e===r&&(e=ri(),e===r&&(e=ti(),e===r&&(e=Za(),e===r&&(e=si(),e===r&&(e=ai(),e===r&&(e=ii(),e===r&&(e=ni(),e===r&&(e=fi(),e===r&&(e=oi(),e===r&&(e=li(),e===r&&(e=ci(),e===r&&(e=ui(),e===r&&(e=gi()))))))))))))))),e}function Nv(){var e;return f.substr(t,5)===ne?(e=ne,t+=5):(e=r,o===0&&l(Bn)),e===r&&(f.substr(t,5)===V?(e=V,t+=5):(e=r,o===0&&l(jn))),e}function Pv(){var e;return f.substr(t,4)===q?(e=q,t+=4):(e=r,o===0&&l(Wn)),e===r&&(f.substr(t,4)===G?(e=G,t+=4):(e=r,o===0&&l(Un))),e}function Qa(){var e;return f.substr(t,4)===ee?(e=ee,t+=4):(e=r,o===0&&l(In)),e===r&&(f.substr(t,4)===ue?(e=ue,t+=4):(e=r,o===0&&l(qn))),e}function Ov(){var e;return f.substr(t,5)===be?(e=be,t+=5):(e=r,o===0&&l(Kn)),e===r&&(f.substr(t,5)===Ce?(e=Ce,t+=5):(e=r,o===0&&l(Gn))),e}function Fv(){var e;return f.substr(t,5)===Sr?(e=Sr,t+=5):(e=r,o===0&&l(zn)),e===r&&(f.substr(t,5)===ir?(e=ir,t+=5):(e=r,o===0&&l(Ln))),e}function Bv(){var e;return f.substr(t,5)===Dt?(e=Dt,t+=5):(e=r,o===0&&l(Yn)),e===r&&(f.substr(t,5)===Tt?(e=Tt,t+=5):(e=r,o===0&&l(Hn))),e}function Za(){var e;return f.substr(t,6)===Rt?(e=Rt,t+=6):(e=r,o===0&&l(Xn)),e===r&&(f.substr(t,6)===nr?(e=nr,t+=6):(e=r,o===0&&l(Vn))),e}function jv(){var e;return f.substr(t,10)===Ne?(e=Ne,t+=10):(e=r,o===0&&l(Qn)),e===r&&(f.substr(t,10)===Fe?(e=Fe,t+=10):(e=r,o===0&&l(Zn)),e===r&&(f.substr(t,10)===Mr?(e=Mr,t+=10):(e=r,o===0&&l(Jn)),e===r&&(f.substr(t,10)===fr?(e=fr,t+=10):(e=r,o===0&&l(ef))))),e}function Wv(){var e;return f.substr(t,10)===Dr?(e=Dr,t+=10):(e=r,o===0&&l(rf)),e===r&&(f.substr(t,10)===Tr?(e=Tr,t+=10):(e=r,o===0&&l(tf)),e===r&&(f.substr(t,10)===Rr?(e=Rr,t+=10):(e=r,o===0&&l(sf)),e===r&&(f.substr(t,10)===Nt?(e=Nt,t+=10):(e=r,o===0&&l(af))))),e}function Ja(){var e;return f.substr(t,8)===Nr?(e=Nr,t+=8):(e=r,o===0&&l(nf)),e===r&&(f.substr(t,8)===Pt?(e=Pt,t+=8):(e=r,o===0&&l(ff)),e===r&&(f.substr(t,8)===Pr?(e=Pr,t+=8):(e=r,o===0&&l(of)),e===r&&(f.substr(t,8)===Or?(e=Or,t+=8):(e=r,o===0&&l(lf)),e===r&&(f.substr(t,8)===or?(e=or,t+=8):(e=r,o===0&&l(cf)))))),e}function ei(){var e;return f.substr(t,8)===Fr?(e=Fr,t+=8):(e=r,o===0&&l(uf)),e===r&&(f.substr(t,8)===Ae?(e=Ae,t+=8):(e=r,o===0&&l(gf)),e===r&&(f.substr(t,8)===Ot?(e=Ot,t+=8):(e=r,o===0&&l(vf)),e===r&&(f.substr(t,8)===pe?(e=pe,t+=8):(e=r,o===0&&l(pf)),e===r&&(f.substr(t,8)===Br?(e=Br,t+=8):(e=r,o===0&&l(hf)))))),e}function ri(){var e;return f.substr(t,9)===lr?(e=lr,t+=9):(e=r,o===0&&l(df)),e===r&&(f.substr(t,9)===jr?(e=jr,t+=9):(e=r,o===0&&l($f)),e===r&&(f.substr(t,9)===Ke?(e=Ke,t+=9):(e=r,o===0&&l(mf)),e===r&&(f.substr(t,9)===Ee?(e=Ee,t+=9):(e=r,o===0&&l(bf)),e===r&&(f.substr(t,9)===De?(e=De,t+=9):(e=r,o===0&&l(wf)))))),e}function ti(){var e;return f.substr(t,9)===Wr?(e=Wr,t+=9):(e=r,o===0&&l(yf)),e===r&&(f.substr(t,9)===we?(e=we,t+=9):(e=r,o===0&&l(_f)),e===r&&(f.substr(t,9)===Ft?(e=Ft,t+=9):(e=r,o===0&&l(xf)),e===r&&(f.substr(t,9)===Ur?(e=Ur,t+=9):(e=r,o===0&&l(Af)),e===r&&(f.substr(t,9)===Ir?(e=Ir,t+=9):(e=r,o===0&&l(kf)))))),e}function Uv(){var e;return f.substr(t,7)===qr?(e=qr,t+=7):(e=r,o===0&&l(Cf)),e===r&&(f.substr(t,7)===Kr?(e=Kr,t+=7):(e=r,o===0&&l(Ef)),e===r&&(f.substr(t,7)===Bt?(e=Bt,t+=7):(e=r,o===0&&l(Sf)),e===r&&(f.substr(t,7)===Gr?(e=Gr,t+=7):(e=r,o===0&&l(Mf)),e===r&&(f.substr(t,7)===Pe?(e=Pe,t+=7):(e=r,o===0&&l(Df)),e===r&&(f.substr(t,7)===jt?(e=jt,t+=7):(e=r,o===0&&l(Tf))))))),e}function Iv(){var e;return f.substr(t,7)===Ge?(e=Ge,t+=7):(e=r,o===0&&l(Rf)),e===r&&(f.substr(t,7)===zr?(e=zr,t+=7):(e=r,o===0&&l(Nf)),e===r&&(f.substr(t,7)===Wt?(e=Wt,t+=7):(e=r,o===0&&l(Pf)),e===r&&(f.substr(t,7)===Lr?(e=Lr,t+=7):(e=r,o===0&&l(Of)),e===r&&(f.substr(t,7)===Yr?(e=Yr,t+=7):(e=r,o===0&&l(Ff)),e===r&&(f.substr(t,7)===Hr?(e=Hr,t+=7):(e=r,o===0&&l(Bf))))))),e}function qv(){var e;return f.substr(t,9)===Xr?(e=Xr,t+=9):(e=r,o===0&&l(jf)),e===r&&(f.substr(t,9)===ze?(e=ze,t+=9):(e=r,o===0&&l(Wf)),e===r&&(f.substr(t,9)===Vr?(e=Vr,t+=9):(e=r,o===0&&l(Uf)),e===r&&(f.substr(t,9)===Qr?(e=Qr,t+=9):(e=r,o===0&&l(If))))),e}function Kv(){var e;return f.substr(t,9)===Zr?(e=Zr,t+=9):(e=r,o===0&&l(qf)),e===r&&(f.substr(t,9)===Ut?(e=Ut,t+=9):(e=r,o===0&&l(Kf)),e===r&&(f.substr(t,9)===It?(e=It,t+=9):(e=r,o===0&&l(Gf)),e===r&&(f.substr(t,9)===qt?(e=qt,t+=9):(e=r,o===0&&l(zf))))),e}function si(){var e;return f.substr(t,9)===cr?(e=cr,t+=9):(e=r,o===0&&l(Lf)),e===r&&(f.substr(t,9)===Le?(e=Le,t+=9):(e=r,o===0&&l(Yf)),e===r&&(f.substr(t,9)===Kt?(e=Kt,t+=9):(e=r,o===0&&l(Hf)),e===r&&(f.substr(t,9)===ur?(e=ur,t+=9):(e=r,o===0&&l(Xf))))),e}function Gv(){var e;return f.substr(t,12)===Gt?(e=Gt,t+=12):(e=r,o===0&&l(Vf)),e===r&&(f.substr(t,12)===zt?(e=zt,t+=12):(e=r,o===0&&l(Qf)),e===r&&(f.substr(t,12)===Lt?(e=Lt,t+=12):(e=r,o===0&&l(Zf)),e===r&&(f.substr(t,12)===Be?(e=Be,t+=12):(e=r,o===0&&l(Jf))))),e}function zv(){var e;return f.substr(t,7)===Yt?(e=Yt,t+=7):(e=r,o===0&&l(eo)),e===r&&(f.substr(t,7)===Ht?(e=Ht,t+=7):(e=r,o===0&&l(ro))),e}function Lv(){var e;return f.substr(t,5)===Jr?(e=Jr,t+=5):(e=r,o===0&&l(to)),e===r&&(f.substr(t,5)===Xt?(e=Xt,t+=5):(e=r,o===0&&l(so))),e}function ai(){var e;return f.substr(t,5)===gr?(e=gr,t+=5):(e=r,o===0&&l(ao)),e===r&&(f.substr(t,5)===et?(e=et,t+=5):(e=r,o===0&&l(io))),e}function Yv(){var e;return f.substr(t,7)===vr?(e=vr,t+=7):(e=r,o===0&&l(no)),e===r&&(f.substr(t,7)===rt?(e=rt,t+=7):(e=r,o===0&&l(fo))),e}function Hv(){var e;return f.substr(t,9)===tt?(e=tt,t+=9):(e=r,o===0&&l(oo)),e===r&&(f.substr(t,9)===st?(e=st,t+=9):(e=r,o===0&&l(lo))),e}function Xv(){var e;return f.substr(t,12)===at?(e=at,t+=12):(e=r,o===0&&l(co)),e===r&&(f.substr(t,12)===it?(e=it,t+=12):(e=r,o===0&&l(uo)),e===r&&(f.substr(t,12)===pr?(e=pr,t+=12):(e=r,o===0&&l(go)),e===r&&(f.substr(t,12)===hr?(e=hr,t+=12):(e=r,o===0&&l(vo))))),e}function Vv(){var e;return f.substr(t,3)===nt?(e=nt,t+=3):(e=r,o===0&&l(po)),e===r&&(f.substr(t,3)===Ye?(e=Ye,t+=3):(e=r,o===0&&l(ho)),e===r&&(f.substr(t,3)===ft?(e=ft,t+=3):(e=r,o===0&&l($o)))),e}function Qv(){var e;return f.substr(t,3)===ot?(e=ot,t+=3):(e=r,o===0&&l(mo)),e===r&&(f.substr(t,3)===dr?(e=dr,t+=3):(e=r,o===0&&l(bo)),e===r&&(f.substr(t,3)===lt?(e=lt,t+=3):(e=r,o===0&&l(wo)))),e}function ii(){var e;return f.substr(t,4)===Vt?(e=Vt,t+=4):(e=r,o===0&&l(yo)),e===r&&(f.substr(t,4)===Qt?(e=Qt,t+=4):(e=r,o===0&&l(_o))),e}function ni(){var e;return f.substr(t,7)===Zt?(e=Zt,t+=7):(e=r,o===0&&l(xo)),e===r&&(f.substr(t,7)===Jt?(e=Jt,t+=7):(e=r,o===0&&l(Ao)),e===r&&(f.substr(t,7)===$r?(e=$r,t+=7):(e=r,o===0&&l(ko)),e===r&&(f.substr(t,7)===es?(e=es,t+=7):(e=r,o===0&&l(Co)),e===r&&(f.substr(t,7)===ct?(e=ct,t+=7):(e=r,o===0&&l(Eo)),e===r&&(f.substr(t,7)===ie?(e=ie,t+=7):(e=r,o===0&&l(So))))))),e}function fi(){var e;return f.substr(t,7)===ut?(e=ut,t+=7):(e=r,o===0&&l(Mo)),e===r&&(f.substr(t,7)===gt?(e=gt,t+=7):(e=r,o===0&&l(Do)),e===r&&(f.substr(t,7)===vt?(e=vt,t+=7):(e=r,o===0&&l(To)),e===r&&(f.substr(t,7)===Oe?(e=Oe,t+=7):(e=r,o===0&&l(Ro)),e===r&&(f.substr(t,7)===pt?(e=pt,t+=7):(e=r,o===0&&l(No)),e===r&&(f.substr(t,7)===ht?(e=ht,t+=7):(e=r,o===0&&l(Po))))))),e}function oi(){var e;return f.substr(t,11)===mr?(e=mr,t+=11):(e=r,o===0&&l(Oo)),e===r&&(f.substr(t,11)===dt?(e=dt,t+=11):(e=r,o===0&&l(Fo)),e===r&&(f.substr(t,11)===$t?(e=$t,t+=11):(e=r,o===0&&l(Bo)),e===r&&(f.substr(t,11)===br?(e=br,t+=11):(e=r,o===0&&l(jo))))),e}function Zv(){var e;return f.substr(t,5)===mt?(e=mt,t+=5):(e=r,o===0&&l(Wo)),e===r&&(f.substr(t,5)===wr?(e=wr,t+=5):(e=r,o===0&&l(Uo)),e===r&&(f.substr(t,5)===He?(e=He,t+=5):(e=r,o===0&&l(Io)),e===r&&(f.substr(t,5)===bt?(e=bt,t+=5):(e=r,o===0&&l(qo))))),e}function Jv(){var e;return f.substr(t,3)===wt?(e=wt,t+=3):(e=r,o===0&&l(Ko)),e===r&&(f.substr(t,3)===yr?(e=yr,t+=3):(e=r,o===0&&l(Go)),e===r&&(f.substr(t,3)===Xe?(e=Xe,t+=3):(e=r,o===0&&l(zo)))),e}function ep(){var e;return f.substr(t,11)===yt?(e=yt,t+=11):(e=r,o===0&&l(Lo)),e===r&&(f.substr(t,11)===Ve?(e=Ve,t+=11):(e=r,o===0&&l(Yo))),e}function rp(){var e;return f.substr(t,9)===rs?(e=rs,t+=9):(e=r,o===0&&l(Ho)),e===r&&(f.substr(t,9)===_t?(e=_t,t+=9):(e=r,o===0&&l(Xo))),e}function tp(){var e;return f.substr(t,4)===u?(e=u,t+=4):(e=r,o===0&&l(Vo)),e===r&&(f.substr(t,4)===w?(e=w,t+=4):(e=r,o===0&&l(Qo))),e}function li(){var e;return f.substr(t,8)===y?(e=y,t+=8):(e=r,o===0&&l(Zo)),e===r&&(f.substr(t,8)===D?(e=D,t+=8):(e=r,o===0&&l(Jo)),e===r&&(f.substr(t,8)===j?(e=j,t+=8):(e=r,o===0&&l(el)),e===r&&(f.substr(t,8)===O?(e=O,t+=8):(e=r,o===0&&l(rl))))),e}function sp(){var e;return f.substr(t,7)===U?(e=U,t+=7):(e=r,o===0&&l(tl)),e===r&&(f.substr(t,7)===le?(e=le,t+=7):(e=r,o===0&&l(sl))),e}function ap(){var e;return f.substr(t,15)===ye?(e=ye,t+=15):(e=r,o===0&&l(al)),e}function ip(){var e;return f.substr(t,15)===de?(e=de,t+=15):(e=r,o===0&&l(il)),e}function np(){var e;return f.substr(t,11)===ve?(e=ve,t+=11):(e=r,o===0&&l(nl)),e}function fp(){var e;return f.substr(t,11)===xt?(e=xt,t+=11):(e=r,o===0&&l(fl)),e}function op(){var e;return f.substr(t,9)===At?(e=At,t+=9):(e=r,o===0&&l(ol)),e}function lp(){var e;return f.substr(t,9)===A?(e=A,t+=9):(e=r,o===0&&l(ll)),e}function ci(){var e;return f.substr(t,5)===te?(e=te,t+=5):(e=r,o===0&&l(cl)),e}function ui(){var e;return f.substr(t,10)===fe?(e=fe,t+=10):(e=r,o===0&&l(ul)),e}function gi(){var e;return f.substr(t,10)===Te?(e=Te,t+=10):(e=r,o===0&&l(gl)),e}function T(){var e,s;for(o++,e=[],s=f.charAt(t),xr.test(s)?t++:(s=r,o===0&&l(Ar));s!==r;)e.push(s),s=f.charAt(t),xr.test(s)?t++:(s=r,o===0&&l(Ar));return o--,s=r,o===0&&l(Aa),e}function Er(){var e,s;if(e=[],s=f.charAt(t),xr.test(s)?t++:(s=r,o===0&&l(Ar)),s!==r)for(;s!==r;)e.push(s),s=f.charAt(t),xr.test(s)?t++:(s=r,o===0&&l(Ar));else e=r;return e}function cp(){var e,s;if(e=[],s=f.charAt(t),ya.test(s)?t++:(s=r,o===0&&l(ka)),s!==r)for(;s!==r;)e.push(s),s=f.charAt(t),ya.test(s)?t++:(s=r,o===0&&l(ka));else e=r;return e}function us(){var e,s,i;for(e=t,s=[],i=f.charAt(t),_a.test(i)?t++:(i=r,o===0&&l(Ca));i!==r;)s.push(i),i=f.charAt(t),_a.test(i)?t++:(i=r,o===0&&l(Ca));return $=e,s=Au(s),e=s,e}function ge(){var e;return f.charCodeAt(t)===34?(e=Qe,t++):(e=r,o===0&&l(is)),e}function J(){var e,s,i,a,h;if(e=t,f.charCodeAt(t)===34?(s=Qe,t++):(s=r,o===0&&l(is)),s!==r){for(pi(),i=[],a=vi();a!==r;)i.push(a),a=vi();a=pi(),f.charCodeAt(t)===34?(h=Qe,t++):(h=r,o===0&&l(is)),h!==r?($=e,e=ku(i)):(t=e,e=r)}else t=e,e=r;return e}function vi(){var e,s,i,a;return e=f.charAt(t),Sn.test(e)?t++:(e=r,o===0&&l(vl)),e===r&&(e=t,s=up(),s!==r?(i=t,f.charCodeAt(t)===92?(a=Ys,t++):(a=r,o===0&&l(Ea)),a!==r&&($=i,a=Cu()),i=a,i===r&&(i=t,f.charCodeAt(t)===34?(a=Qe,t++):(a=r,o===0&&l(is)),a!==r&&($=i,a=Eu()),i=a),i!==r?($=e,e=Su(i)):(t=e,e=r)):(t=e,e=r)),e}function pi(){var e,s;for(o++,e=[],s=f.charAt(t),xr.test(s)?t++:(s=r,o===0&&l(Ar));s!==r;)e.push(s),s=f.charAt(t),xr.test(s)?t++:(s=r,o===0&&l(Ar));return o--,s=r,o===0&&l(Aa),e}function up(){var e;return f.charCodeAt(t)===92?(e=Ys,t++):(e=r,o===0&&l(Ea)),e}function ks(){var e,s,i,a,h,_,M,B,L;return e=t,s=ge(),s!==r?(i=t,a=f.charAt(t),je.test(a)?t++:(a=r,o===0&&l(We)),a!==r?(h=f.charAt(t),je.test(h)?t++:(h=r,o===0&&l(We)),h!==r?(_=f.charAt(t),je.test(_)?t++:(_=r,o===0&&l(We)),_!==r?(M=f.charAt(t),je.test(M)?t++:(M=r,o===0&&l(We)),M!==r?(a=[a,h,_,M],i=a):(t=i,i=r)):(t=i,i=r)):(t=i,i=r)):(t=i,i=r),i!==r?(f.charCodeAt(t)===46?(a=ts,t++):(a=r,o===0&&l(ns)),a!==r?(h=t,_=f.charAt(t),je.test(_)?t++:(_=r,o===0&&l(We)),_!==r?(M=f.charAt(t),je.test(M)?t++:(M=r,o===0&&l(We)),M!==r?(_=[_,M],h=_):(t=h,h=r)):(t=h,h=r),h!==r?(f.charCodeAt(t)===46?(_=ts,t++):(_=r,o===0&&l(ns)),_!==r?(M=t,B=f.charAt(t),je.test(B)?t++:(B=r,o===0&&l(We)),B!==r?(L=f.charAt(t),je.test(L)?t++:(L=r,o===0&&l(We)),L!==r?(B=[B,L],M=B):(t=M,M=r)):(t=M,M=r),M!==r?(B=ge(),B!==r?($=e,e=Mu(i,h,M)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function hi(){var e,s,i,a,h,_,M,B,L;if(e=t,s=ge(),s!==r){if(i=[],a=f.charAt(t),_e.test(a)?t++:(a=r,o===0&&l(xe)),a!==r)for(;a!==r;)i.push(a),a=f.charAt(t),_e.test(a)?t++:(a=r,o===0&&l(xe));else i=r;if(i!==r)if(f.charCodeAt(t)===58?(a=_r,t++):(a=r,o===0&&l(kr)),a!==r){if(h=[],_=f.charAt(t),_e.test(_)?t++:(_=r,o===0&&l(xe)),_!==r)for(;_!==r;)h.push(_),_=f.charAt(t),_e.test(_)?t++:(_=r,o===0&&l(xe));else h=r;if(h!==r)if(f.charCodeAt(t)===58?(_=_r,t++):(_=r,o===0&&l(kr)),_!==r){if(M=[],B=f.charAt(t),_e.test(B)?t++:(B=r,o===0&&l(xe)),B!==r)for(;B!==r;)M.push(B),B=f.charAt(t),_e.test(B)?t++:(B=r,o===0&&l(xe));else M=r;M!==r?(B=di(),B===r&&(B=null),L=ge(),L!==r?($=e,e=Du(i,h,M,B)):(t=e,e=r)):(t=e,e=r)}else t=e,e=r;else t=e,e=r}else t=e,e=r;else t=e,e=r}else t=e,e=r;return e}function di(){var e,s,i,a;if(e=t,f.charCodeAt(t)===46?(s=ts,t++):(s=r,o===0&&l(ns)),s!==r){if(i=[],a=f.charAt(t),_e.test(a)?t++:(a=r,o===0&&l(xe)),a!==r)for(;a!==r;)i.push(a),a=f.charAt(t),_e.test(a)?t++:(a=r,o===0&&l(xe));else i=r;i!==r?($=e,e=Tu(i)):(t=e,e=r)}else t=e,e=r;return e}function gp(){var e,s,i,a;return e=t,s=ge(),s!==r?(i=vp(),i!==r?(a=ge(),a!==r?($=e,e=Ru(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function vp(){var e,s,i,a;return e=t,s=pp(),s!==r?(f.charCodeAt(t)===47?(i=ds,t++):(i=r,o===0&&l(bs)),i!==r?(a=mi(),a!==r?($=e,e=Nu(s,a)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function pp(){var e;return e=f.charAt(t),Mn.test(e)?t++:(e=r,o===0&&l(pl)),e}function $i(){var e,s,i,a;return e=t,s=ge(),s!==r?(i=mi(),i!==r?(a=ge(),a!==r?($=e,e=Pu(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function mi(){var e,s;return e=t,s=Ci(),s!==r&&($=e,s=Ou(s)),e=s,e}function hp(){var e,s,i,a;return e=t,s=ge(),s!==r?(i=dp(),a=ge(),a!==r?($=e,e=Fu(i)):(t=e,e=r)):(t=e,e=r),e}function dp(){var e,s,i,a,h,_,M;if(e=t,s=t,i=Cs(),i!==r){for(a=[],h=t,f.charCodeAt(t)===58?(_=_r,t++):(_=r,o===0&&l(kr)),_!==r?(M=Cs(),M!==r?($=h,h=ja(i,M)):(t=h,h=r)):(t=h,h=r);h!==r;)a.push(h),h=t,f.charCodeAt(t)===58?(_=_r,t++):(_=r,o===0&&l(kr)),_!==r?(M=Cs(),M!==r?($=h,h=ja(i,M)):(t=h,h=r)):(t=h,h=r);$=s,s=Bu(i,a)}else t=s,s=r;return s===r&&(s=null),$=e,s=ju(s),e=s,e}function Cs(){var e,s,i,a,h,_;return e=t,f.charCodeAt(t)===63?(s=Hs,t++):(s=r,o===0&&l(Sa)),s!==r&&($=e,s=Wu()),e=s,e===r&&(e=t,f.charCodeAt(t)===45?(s=Xs,t++):(s=r,o===0&&l(Ma)),s!==r&&($=e,s=Uu()),e=s,e===r&&(e=t,s=Me(),s!==r?(f.charCodeAt(t)===47?(i=ds,t++):(i=r,o===0&&l(bs)),i!==r?(a=Me(),a!==r?(f.charCodeAt(t)===43?(h=$s,t++):(h=r,o===0&&l(ws)),h!==r?(_=Me(),_!==r?($=e,e=Iu(s,a,_)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Me(),s!==r?(f.charCodeAt(t)===47?(i=ds,t++):(i=r,o===0&&l(bs)),i!==r?(a=Me(),a!==r?($=e,e=qu(s,a)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Me(),s!==r?(f.charCodeAt(t)===43?(i=$s,t++):(i=r,o===0&&l(ws)),i!==r?(a=Me(),a!==r?($=e,e=Ku(s,a)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Me(),s!==r&&($=e,s=Gu(s)),e=s,e===r&&(e=t,f.charCodeAt(t)===42?(s=Vs,t++):(s=r,o===0&&l(Da)),s!==r?(i=Me(),i!==r?($=e,e=zu(i)):(t=e,e=r)):(t=e,e=r))))))),e}function $p(){var e,s,i,a;return e=t,s=ge(),s!==r?(i=bi(),i!==r?(a=ge(),a!==r?($=e,e=Lu(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function bi(){var e,s;return e=t,f.substr(t,3)===Qs?(s=Qs,t+=3):(s=r,o===0&&l(hl)),s!==r&&($=e,s=Yu(s)),e=s,e===r&&(e=t,f.substr(t,3)===Zs?(s=Zs,t+=3):(s=r,o===0&&l(dl)),s!==r&&($=e,s=Hu(s)),e=s,e===r&&(e=t,f.substr(t,7)===Js?(s=Js,t+=7):(s=r,o===0&&l($l)),s!==r&&($=e,s=Xu(s)),e=s,e===r&&(e=t,f.substr(t,3)===ea?(s=ea,t+=3):(s=r,o===0&&l(ml)),s!==r&&($=e,s=Vu()),e=s,e===r&&(e=t,f.charCodeAt(t)===42?(s=Vs,t++):(s=r,o===0&&l(Da)),s!==r&&($=e,s=Qu(s)),e=s)))),e}function wi(){var e,s,i,a;return e=t,s=Ct(),s!==r&&($=e,s=Zu(s)),e=s,e===r&&(e=t,s=ge(),s!==r?(f.charCodeAt(t)===45?(i=Xs,t++):(i=r,o===0&&l(Ma)),i!==r?(a=ge(),a!==r?($=e,e=Ju()):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ge(),s!==r?(i=ge(),i!==r?($=e,e=eg()):(t=e,e=r)):(t=e,e=r))),e}function Ct(){var e,s,i,a;if(e=t,s=ge(),s!==r){if(i=[],a=f.charAt(t),_e.test(a)?t++:(a=r,o===0&&l(xe)),a!==r)for(;a!==r;)i.push(a),a=f.charAt(t),_e.test(a)?t++:(a=r,o===0&&l(xe));else i=r;i!==r?(a=ge(),a!==r?($=e,e=rg(i)):(t=e,e=r)):(t=e,e=r)}else t=e,e=r;return e}function Et(){var e,s,i,a,h,_,M,B,L,se;return e=t,ls(),s=T(),i=Es(),i===r&&(i=null),T(),a=Mp(),a===r&&(a=null),T(),h=Dp(),h!==r?(T(),_=Ti(),_===r&&(_=null),M=mp(),M===r&&(M=null),T(),B=Es(),B===r&&(B=null),T(),L=Si(),L===r&&(L=null),se=Et(),se===r&&(se=null),$=e,e=tg(i,a,h,_,M,B,L,se)):(t=e,e=r),e===r&&(e=t,T(),s=bp(),s!==r?(i=T(),$=e,e=sg(s)):(t=e,e=r)),e}function mp(){var e,s,i,a;return e=t,s=Mi(),s!==r?(f.charCodeAt(t)===61?(i=ra,t++):(i=r,o===0&&l(ys)),i!==r?(a=Di(),a!==r?(s=[s,i,a],e=s):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function bp(){var e,s;return e=t,s=bi(),s!==r&&($=e,s=ag(s)),e=s,e}function Es(){var e,s,i,a,h;if(e=t,s=Ss(),s!==r){for(i=[],a=t,T(),h=Ss(),h!==r?($=a,a=Wa(s,h)):(t=a,a=r);a!==r;)i.push(a),a=t,T(),h=Ss(),h!==r?($=a,a=Wa(s,h)):(t=a,a=r);$=e,e=ig(s,i)}else t=e,e=r;return e}function Ss(){var e,s,i,a;return e=t,s=Ai(),s!==r?(i=ki(),i!==r?($=e,e=ng()):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=Ai(),s!==r?(i=he(),i!==r?(a=ki(),a!==r?($=e,e=fg(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=wp(),s!==r&&($=e,s=og(s)),e=s)),e}function he(){var e,s,i,a,h,_,M,B,L,se,H,I,ce;if(e=t,s=T(),i=Ze(),i!==r)if(f.substr(t,4)===ta?(a=ta,t+=4):(a=r,o===0&&l(bl)),a!==r)if(h=Er(),h!==r)if(_=yp(),_===r&&(_=null),M=T(),B=Ue(),B!==r){for(L=T(),se=[],H=t,I=he(),I!==r&&($=H,I=Ua(_,I)),H=I;H!==r;)se.push(H),H=t,I=he(),I!==r&&($=H,I=Ua(_,I)),H=I;$=e,e=lg(_,se)}else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;if(e===r){if(e=t,s=T(),i=Ze(),i!==r)if(f.substr(t,4)===sa?(a=sa,t+=4):(a=r,o===0&&l(wl)),a!==r)if(h=Er(),h!==r)if(_=_p(),_===r&&(_=null),M=T(),B=Ue(),B!==r){for(L=T(),se=[],H=t,I=he(),I!==r&&($=H,I=Ia(_,I)),H=I;H!==r;)se.push(H),H=t,I=he(),I!==r&&($=H,I=Ia(_,I)),H=I;$=e,e=cg(_,se)}else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;if(e===r){if(e=t,s=T(),i=Ze(),i!==r)if(f.charCodeAt(t)===37?(a=ms,t++):(a=r,o===0&&l(_s)),a!==r)if(h=Ap(),h!==r)if(_=Er(),_!==r)if(M=Ci(),M!==r)if(B=T(),L=Ue(),L!==r){for(se=T(),H=[],I=t,ce=he(),ce!==r&&($=I,ce=qa(h,M,ce)),I=ce;I!==r;)H.push(I),I=t,ce=he(),ce!==r&&($=I,ce=qa(h,M,ce)),I=ce;$=e,e=ug(h,M,H)}else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;if(e===r){if(e=t,s=T(),i=Ze(),i!==r)if(f.charCodeAt(t)===37?(a=ms,t++):(a=r,o===0&&l(_s)),a!==r)if(h=kp(),h!==r)if(_=Er(),_!==r)if(M=Cp(),M!==r)if(B=T(),L=Ue(),L!==r){for(se=T(),H=[],I=t,ce=he(),ce!==r&&($=I,ce=Ka(h,M,ce)),I=ce;I!==r;)H.push(I),I=t,ce=he(),ce!==r&&($=I,ce=Ka(h,M,ce)),I=ce;$=e,e=gg(h,M,H)}else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;if(e===r){if(e=t,s=T(),i=Ze(),i!==r)if(f.substr(t,5)===aa?(a=aa,t+=5):(a=r,o===0&&l(yl)),a!==r)if(h=Er(),h!==r)if(_=us(),M=T(),B=Ue(),B!==r){for(L=T(),se=[],H=t,I=he(),I!==r&&($=H,I=Ga(_,I)),H=I;H!==r;)se.push(H),H=t,I=he(),I!==r&&($=H,I=Ga(_,I)),H=I;$=e,e=vg(_,se)}else t=e,e=r;else t=e,e=r;else t=e,e=r;else t=e,e=r;if(e===r){if(e=t,s=T(),i=Ze(),i!==r)if(f.charCodeAt(t)===37?(a=ms,t++):(a=r,o===0&&l(_s)),a!==r)if(h=us(),_=Er(),_!==r){if(M=[],B=_i(),B!==r)for(;B!==r;)M.push(B),B=_i();else M=r;if(M!==r)if(B=Ue(),B!==r){for(L=T(),se=[],H=t,I=he(),I!==r&&($=H,I=za(h,M,I)),H=I;H!==r;)se.push(H),H=t,I=he(),I!==r&&($=H,I=za(h,M,I)),H=I;$=e,e=pg(h,M,se)}else t=e,e=r;else t=e,e=r}else t=e,e=r;else t=e,e=r;else t=e,e=r;if(e===r){if(e=t,s=[],i=yi(),i!==r)for(;i!==r;)s.push(i),i=yi();else s=r;if(s!==r){for(i=[],a=t,h=T(),_=he(),_!==r?($=a,a=La(s,_)):(t=a,a=r);a!==r;)i.push(a),a=t,h=T(),_=he(),_!==r?($=a,a=La(s,_)):(t=a,a=r);$=e,e=hg(s,i)}else t=e,e=r}}}}}}return e}function yi(){var e,s,i,a;return e=t,s=t,o++,f.substr(t,2)===ia?(i=ia,t+=2):(i=r,o===0&&l(_l)),o--,i===r?s=void 0:(t=s,s=r),s!==r?(i=t,o++,f.charCodeAt(t)===125?(a=na,t++):(a=r,o===0&&l(Ta)),o--,a===r?i=void 0:(t=i,i=r),i!==r?(f.length>t?(a=f.charAt(t),t++):(a=r,o===0&&l(Ra)),a!==r?($=e,e=dg(a)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function _i(){var e,s,i;return e=t,s=t,o++,i=Ue(),o--,i===r?s=void 0:(t=s,s=r),s!==r?(f.length>t?(i=f.charAt(t),t++):(i=r,o===0&&l(Ra)),i!==r?($=e,e=$g(i)):(t=e,e=r)):(t=e,e=r),e}function wp(){var e,s,i,a;if(e=t,s=xp(),s!==r){for(i=[],a=f.charAt(t),xa.test(a)?t++:(a=r,o===0&&l(Na));a!==r;)i.push(a),a=f.charAt(t),xa.test(a)?t++:(a=r,o===0&&l(Na));a=cp(),a!==r?($=e,e=mg(i)):(t=e,e=r)}else t=e,e=r;return e}function yp(){var e,s,i,a,h,_,M;if(e=t,s=Ms(),s!==r){for(T(),i=[],a=t,f.charCodeAt(t)===44?(h=ss,t++):(h=r,o===0&&l(fs)),h!==r?(_=T(),M=Ms(),M!==r?(h=[h,_,M],a=h):(t=a,a=r)):(t=a,a=r);a!==r;)i.push(a),a=t,f.charCodeAt(t)===44?(h=ss,t++):(h=r,o===0&&l(fs)),h!==r?(_=T(),M=Ms(),M!==r?(h=[h,_,M],a=h):(t=a,a=r)):(t=a,a=r);$=e,e=bg(s,i)}else t=e,e=r;return e}function Ms(){var e,s,i;return e=t,s=xi(),s!==r?(i=Ts(),i!==r?($=e,e=wg(s,i)):(t=e,e=r)):(t=e,e=r),e}function _p(){var e,s,i,a,h,_,M;if(e=t,s=Ds(),s!==r){for(T(),i=[],a=t,f.charCodeAt(t)===44?(h=ss,t++):(h=r,o===0&&l(fs)),h!==r?(_=T(),M=Ds(),M!==r?(h=[h,_,M],a=h):(t=a,a=r)):(t=a,a=r);a!==r;)i.push(a),a=t,f.charCodeAt(t)===44?(h=ss,t++):(h=r,o===0&&l(fs)),h!==r?(_=T(),M=Ds(),M!==r?(h=[h,_,M],a=h):(t=a,a=r)):(t=a,a=r);$=e,e=yg(s,i)}else t=e,e=r;return e}function Ds(){var e,s,i,a;return e=t,s=xi(),s!==r?(i=Ts(),i!==r?(a=Ts(),a!==r?($=e,e=_g(s,i,a)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function xi(){var e,s;return e=t,f.charCodeAt(t)===89?(s=Yi,t++):(s=r,o===0&&l(xl)),s!==r&&($=e,s=xg()),e=s,e===r&&(e=t,f.charCodeAt(t)===71?(s=Hi,t++):(s=r,o===0&&l(Al)),s!==r&&($=e,s=Ag()),e=s,e===r&&(e=t,f.charCodeAt(t)===82?(s=Xi,t++):(s=r,o===0&&l(kl)),s!==r&&($=e,s=kg()),e=s,e===r&&(e=t,f.charCodeAt(t)===66?(s=Vi,t++):(s=r,o===0&&l(Cl)),s!==r&&($=e,s=Cg()),e=s,e===r&&(e=t,f.charCodeAt(t)===79?(s=Qi,t++):(s=r,o===0&&l(El)),s!==r&&($=e,s=Eg()),e=s,e===r&&(e=t,f.charCodeAt(t)===67?(s=Zi,t++):(s=r,o===0&&l(Sl)),s!==r&&($=e,s=Sg()),e=s))))),e}function Ts(){var e,s,i;return e=t,s=Je(),s!==r?(i=er(),i!==r?($=e,e=Mg(s,i)):(t=e,e=r)):(t=e,e=r),e}function Ai(){var e;return f.charCodeAt(t)===123?(e=Ji,t++):(e=r,o===0&&l(Ml)),e}function ki(){var e;return f.charCodeAt(t)===125?(e=na,t++):(e=r,o===0&&l(Ta)),e}function Ze(){var e;return f.charCodeAt(t)===91?(e=en,t++):(e=r,o===0&&l(Dl)),e}function Ue(){var e;return f.charCodeAt(t)===93?(e=rn,t++):(e=r,o===0&&l(Tl)),e}function xp(){var e;return f.charCodeAt(t)===59?(e=tn,t++):(e=r,o===0&&l(Rl)),e}function Ap(){var e,s;return e=t,f.substr(t,3)===fa?(s=fa,t+=3):(s=r,o===0&&l(Nl)),s!==r&&($=e,s=Dg()),e=s,e===r&&(e=t,f.substr(t,3)===oa?(s=oa,t+=3):(s=r,o===0&&l(Pl)),s!==r&&($=e,s=Tg()),e=s,e===r&&(e=t,f.substr(t,3)===la?(s=la,t+=3):(s=r,o===0&&l(Ol)),s!==r&&($=e,s=Rg()),e=s)),e}function kp(){var e,s;return e=t,f.substr(t,3)===ca?(s=ca,t+=3):(s=r,o===0&&l(Fl)),s!==r&&($=e,s=Ng()),e=s,e}function Ci(){var e,s,i,a,h;return e=t,s=Ei(),s===r&&(s=null),i=Ie(),i!==r?(a=Ie(),a===r&&(a=null),h=di(),h===r&&(h=null),$=e,e=Pg(s,i,a,h)):(t=e,e=r),e}function Cp(){var e,s,i,a;return e=t,s=Ei(),s===r&&(s=null),i=Ie(),i!==r?(a=Ie(),a===r&&(a=null),$=e,e=Og(s,i,a)):(t=e,e=r),e}function Ei(){var e,s,i;return e=t,s=Ep(),s!==r?(i=Sp(),i===r&&(i=null),$=e,e=Fg(s,i)):(t=e,e=r),e}function Ep(){var e,s,i,a;return e=t,s=Ie(),s!==r?(i=Ie(),i===r&&(i=null),f.charCodeAt(t)===58?(a=_r,t++):(a=r,o===0&&l(kr)),a!==r?($=e,e=Bg(s,i)):(t=e,e=r)):(t=e,e=r),e}function Sp(){var e,s,i,a;return e=t,s=Ie(),s!==r?(i=Ie(),i===r&&(i=null),f.charCodeAt(t)===58?(a=_r,t++):(a=r,o===0&&l(kr)),a!==r?($=e,e=jg(s,i)):(t=e,e=r)):(t=e,e=r),e}function Ie(){var e,s;return e=t,s=f.charAt(t),_e.test(s)?t++:(s=r,o===0&&l(xe)),s!==r&&($=e,s=Wg(s)),e=s,e}function Si(){var e,s,i,a,h;return e=t,s=Mi(),s!==r?(i=Et(),i!==r?(a=Di(),a!==r?(T(),h=Si(),h===r&&(h=null),$=e,e=Ug(i,h)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Mi(){var e;return f.charCodeAt(t)===40?(e=sn,t++):(e=r,o===0&&l(Bl)),e}function Di(){var e;return f.charCodeAt(t)===41?(e=an,t++):(e=r,o===0&&l(jl)),e}function Mp(){var e,s,i,a,h,_,M;if(e=t,s=Me(),s!==r){for(i=[],a=vs();a!==r;)i.push(a),a=vs();for(a=[],h=gs();h!==r;)a.push(h),h=gs();for(h=[],_=vs();_!==r;)h.push(_),_=vs();for(_=[],M=gs();M!==r;)_.push(M),M=gs();$=e,e=Ig(s)}else t=e,e=r;return e}function gs(){var e;return f.charCodeAt(t)===46?(e=ts,t++):(e=r,o===0&&l(ns)),e}function Me(){var e,s,i;if(o++,e=t,s=[],i=f.charAt(t),_e.test(i)?t++:(i=r,o===0&&l(xe)),i!==r)for(;i!==r;)s.push(i),i=f.charAt(t),_e.test(i)?t++:(i=r,o===0&&l(xe));else s=r;return s!==r&&($=e,s=qg(s)),e=s,o--,e===r&&(s=r,o===0&&l(Wl)),e}function vs(){var e,s,i;if(e=t,s=[],f.charCodeAt(t)===32?(i=ua,t++):(i=r,o===0&&l(Pa)),i!==r)for(;i!==r;)s.push(i),f.charCodeAt(t)===32?(i=ua,t++):(i=r,o===0&&l(Pa));else s=r;return s!==r&&($=e,s=Kg()),e=s,e}function Dp(){var e,s,i,a,h,_,M,B,L;return e=t,s=ps(),s===r&&(s=null),i=t,o++,a=Rp(),o--,a!==r?(t=i,i=void 0):i=r,i!==r?(a=Ri(),a!==r?(h=Ns(),h===r&&(h=null),_=Je(),_!==r?(M=er(),M!==r?(B=Rs(),B===r&&(B=null),L=St(),L===r&&(L=null),T(),f.substr(t,4)===nn?t+=4:o===0&&l(Ul),$=e,e=Gg(s,a,h,_,M,B,L)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ps(),s===r&&(s=null),i=Je(),i!==r?(a=er(),a!==r?(h=Pp(),h===r&&(h=null),_=Je(),_!==r?(M=er(),M!==r?(B=Rs(),B===r&&(B=null),L=St(),L===r&&(L=null),$=e,e=zg(s,i,a,h,_,M,B,L)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,s=ps(),s===r&&(s=null),i=Ns(),i===r&&(i=null),a=Je(),a!==r?(h=er(),h!==r?(_=Rs(),_===r&&(_=null),M=St(),M===r&&(M=null),$=e,e=Lg(s,i,a,h,_,M)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,f.substr(t,5)===ga?(s=ga,t+=5):(s=r,o===0&&l(Il)),s!==r?(i=St(),i===r&&(i=null),$=e,e=Yg(i)):(t=e,e=r),e===r&&(e=t,f.substr(t,3)===va?(s=va,t+=3):(s=r,o===0&&l(ql)),s!==r?(i=St(),i===r&&(i=null),$=e,e=Hg(i)):(t=e,e=r),e===r&&(e=t,s=ps(),s!==r?(f.charCodeAt(t)===64?(i=fn,t++):(i=r,o===0&&l(Kl)),i!==r?(a=Je(),a!==r?(h=er(),h!==r?($=e,e=Xg(s,a,h)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,f.substr(t,2)===pa?(s=pa,t+=2):(s=r,o===0&&l(Gl)),s!==r&&($=e,s=Vg()),e=s)))))),e}function St(){var e,s,i,a;return e=t,s=t,i=t,o++,f.substr(t,2)===as?(a=as,t+=2):(a=r,o===0&&l(Oa)),o--,a===r?i=void 0:(t=i,i=r),i!==r?(f.charCodeAt(t)===43?(a=$s,t++):(a=r,o===0&&l(ws)),a!==r?(i=[i,a],s=i):(t=s,s=r)):(t=s,s=r),s!==r&&($=e,s=Qg(s)),e=s,e===r&&(e=t,s=t,i=t,o++,f.substr(t,3)===ha?(a=ha,t+=3):(a=r,o===0&&l(zl)),o--,a===r?i=void 0:(t=i,i=r),i!==r?(f.charCodeAt(t)===35?(a=on,t++):(a=r,o===0&&l(Ll)),a!==r?(i=[i,a],s=i):(t=s,s=r)):(t=s,s=r),s!==r&&($=e,s=Zg(s)),e=s),e}function Rs(){var e,s;return e=t,f.charCodeAt(t)===61?t++:o===0&&l(ys),s=Np(),s!==r?($=e,e=Jg(s)):(t=e,e=r),e}function Ti(){var e,s,i;return e=t,s=Tp(),s!==r?(T(),i=Ti(),i===r&&(i=null),$=e,e=ev(s,i)):(t=e,e=r),e}function Tp(){var e,s,i;return e=t,f.charCodeAt(t)===36?(s=ln,t++):(s=r,o===0&&l(Yl)),s!==r?(i=Me(),i!==r?($=e,e=rv(i)):(t=e,e=r)):(t=e,e=r),e===r&&(e=t,f.substr(t,2)===da?(s=da,t+=2):(s=r,o===0&&l(Hl)),s!==r&&($=e,s=tv()),e=s,e===r&&(e=t,f.substr(t,2)===$a?(s=$a,t+=2):(s=r,o===0&&l(Xl)),s!==r&&($=e,s=sv()),e=s,e===r&&(e=t,f.substr(t,2)===ma?(s=ma,t+=2):(s=r,o===0&&l(Vl)),s!==r&&($=e,s=av()),e=s,e===r&&(e=t,f.substr(t,2)===ba?(s=ba,t+=2):(s=r,o===0&&l(Ql)),s!==r&&($=e,s=iv()),e=s,e===r&&(e=t,f.charCodeAt(t)===33?(s=cn,t++):(s=r,o===0&&l(Zl)),s!==r&&($=e,s=nv()),e=s,e===r&&(e=t,f.charCodeAt(t)===63?(s=Hs,t++):(s=r,o===0&&l(Sa)),s!==r&&($=e,s=fv()),e=s,e===r&&(e=t,f.charCodeAt(t)===8252?(s=un,t++):(s=r,o===0&&l(Jl)),s!==r&&($=e,s=ov()),e=s,e===r&&(e=t,f.charCodeAt(t)===8263?(s=gn,t++):(s=r,o===0&&l(ec)),s!==r&&($=e,s=lv()),e=s,e===r&&(e=t,f.charCodeAt(t)===8265?(s=vn,t++):(s=r,o===0&&l(rc)),s!==r&&($=e,s=cv()),e=s,e===r&&(e=t,f.charCodeAt(t)===8264?(s=pn,t++):(s=r,o===0&&l(tc)),s!==r&&($=e,s=uv()),e=s,e===r&&(e=t,f.charCodeAt(t)===9633?(s=hn,t++):(s=r,o===0&&l(sc)),s!==r&&($=e,s=gv()),e=s,e===r&&(e=t,f.charCodeAt(t)===61?(s=ra,t++):(s=r,o===0&&l(ys)),s!==r&&($=e,s=vv()),e=s,e===r&&(e=t,f.charCodeAt(t)===8734?(s=dn,t++):(s=r,o===0&&l(ac)),s!==r&&($=e,s=pv()),e=s,e===r&&(e=t,f.charCodeAt(t)===10866?(s=$n,t++):(s=r,o===0&&l(ic)),s!==r&&($=e,s=hv()),e=s,e===r&&(e=t,f.charCodeAt(t)===10865?(s=mn,t++):(s=r,o===0&&l(nc)),s!==r&&($=e,s=dv()),e=s,e===r&&(e=t,f.charCodeAt(t)===177?(s=bn,t++):(s=r,o===0&&l(fc)),s!==r&&($=e,s=$v()),e=s,e===r&&(e=t,f.charCodeAt(t)===8723?(s=wn,t++):(s=r,o===0&&l(oc)),s!==r&&($=e,s=mv()),e=s,e===r&&(e=t,f.substr(t,2)===as?(s=as,t+=2):(s=r,o===0&&l(Oa)),s!==r&&($=e,s=bv()),e=s,e===r&&(e=t,f.substr(t,2)===wa?(s=wa,t+=2):(s=r,o===0&&l(lc)),s!==r&&($=e,s=wv()),e=s,e===r&&(e=t,f.charCodeAt(t)===10752?(s=yn,t++):(s=r,o===0&&l(cc)),s!==r&&($=e,s=yv()),e=s,e===r&&(e=t,f.charCodeAt(t)===10227?(s=_n,t++):(s=r,o===0&&l(uc)),s!==r&&($=e,s=_v()),e=s,e===r&&(e=t,f.charCodeAt(t)===8594?(s=xn,t++):(s=r,o===0&&l(gc)),s!==r&&($=e,s=xv()),e=s,e===r&&(e=t,f.charCodeAt(t)===8593?(s=An,t++):(s=r,o===0&&l(vc)),s!==r&&($=e,s=Av()),e=s,e===r&&(e=t,f.charCodeAt(t)===8646?(s=kn,t++):(s=r,o===0&&l(pc)),s!==r&&($=e,s=kv()),e=s,e===r&&(e=t,f.charCodeAt(t)===68?(s=Cn,t++):(s=r,o===0&&l(hc)),s!==r&&($=e,s=Cv()),e=s))))))))))))))))))))))))),e}function Ri(){var e;return e=f.charAt(t),Dn.test(e)?t++:(e=r,o===0&&l(dc)),e}function Rp(){var e,s,i,a,h;return e=t,s=Ri(),s!==r?(i=Ns(),i===r&&(i=null),a=Je(),a!==r?(h=er(),h!==r?(s=[s,i,a,h],e=s):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function ps(){var e;return e=f.charAt(t),Tn.test(e)?t++:(e=r,o===0&&l($c)),e}function Np(){var e;return e=f.charAt(t),Rn.test(e)?t++:(e=r,o===0&&l(mc)),e}function Je(){var e;return e=f.charAt(t),Nn.test(e)?t++:(e=r,o===0&&l(bc)),e}function er(){var e;return e=f.charAt(t),Pn.test(e)?t++:(e=r,o===0&&l(wc)),e}function Ns(){var e;return f.charCodeAt(t)===120?(e=En,t++):(e=r,o===0&&l(yc)),e}function Pp(){var e;return e=f.charAt(t),On.test(e)?t++:(e=r,o===0&&l(_c)),e}var hs=[];function me(e){var s=Object.assign(e,Ev());return hs.push(s),s}function Ps(e){return parseInt(e.join(""),10)}function rr(e){return e.join("").match(/\?/)?e.join(""):Ps(e)}function qe(e){var s={};return e.forEach(function(i){for(var a in i)Array.isArray(i[a])?s[a]=s[a]?s[a].concat(i[a]):i[a]:s[a]=s[a]?Pi(s[a])+" "+Ni(i[a]):i[a]}),s}function Ni(e){if(typeof e!="string")return e;var s=/^\s+/;return e.replace(s,"")}function Pi(e){if(typeof e!="string")return e;var s=/\s+$/;return e.replace(s,"")}if(kt=K(),F.peg$library)return{peg$result:kt,peg$currPos:t,peg$FAILED:r,peg$maxFailExpected:os,peg$maxFailPos:Se};if(kt!==r&&t===f.length)return kt;throw kt!==r&&t<f.length&&l(Mv()),Dv(os,Se<f.length?f.charAt(Se):null,Se<f.length?xs(Se,Se+1):xs(Se,Se))}return{StartRules:["pgn","tags","game","games"],SyntaxError:Y,parse:Q}})})(b);var k=b.exports,x=d(k);function g(N,W){return!W||W.startRule==="games"?E(N,W):C(N,W)}function C(N,W={startRule:"game"}){N=N.trim();let Y=x.parse(N,W),ae={moves:[],messages:[]};return W.startRule==="pgn"?ae.moves=Y:W.startRule==="tags"?ae.tags=Y:ae=Y,R(ae,N,W)}function R(N,W,Y){function ae(f){if(Y.startRule!=="tags"){let F=f.moves[f.moves.length-1];if(typeof F=="string"&&(f.moves.pop(),f.tags)){let r=f.tags.Result;r&&F!==r&&f.messages.push({key:"Result",value:r,message:"Result in tags is different to result in SAN"}),f.tags.Result=F}}return f}function Q(f){function F(r){function X(V){return V.split(/\s+/)[1]}function z(V,q){function G(ee){return ee==="w"?"b":"w"}return V.turn=q,V.variations&&V.variations.forEach(function(ee){let ue=q;ee.forEach(be=>ue=z(be,ue))}),G(q)}let oe=Y.fen||r.tags&&r.tags.FEN||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",ne=X(oe);return r.moves.forEach(V=>ne=z(V,ne)),r}return f.moves?F(f):f}return Q(ae(N))}function E(N,W={startRule:"games"}){function Y(F){if(!Array.isArray(F))return[];if(F.length===0)return F;let r=F.pop();return(r.tags!==void 0||r.moves.length>0)&&F.push(r),F}function ae(F,r,X={startRule:"games"}){return Y(F)}const Q=Object.assign({startRule:"games"},W);let f=x.parse(N,Q);return f?(ae(f,N,Q),f.forEach(F=>{R(F,N,Q)}),f):[]}const S=(N,W=`
`)=>N.replace(/\r?\n/g,W);function P(N,W={startRule:"games"}){let Y=S(N).split(/\n\n+/),ae=[],Q={tags:"",pgn:"",all:""};return Y.forEach(function(f){if(f.startsWith("["))Q.tags=f;else if(f){Q.pgn=f;let F=Q.tags?Q.tags+`

`+Q.pgn:Q.pgn;Q.all=F,ae.push(Q),Q={tags:"",pgn:"",all:""}}}),ae}c.parse=g,c.parseGame=C,c.parseGames=E,c.split=P})})(Ws,Ws.exports);var qp=Ws.exports;class Ui{username=null;load(){this.username=localStorage.getItem("username")}get(){return this.username}set(n){this.username=n,localStorage.setItem("username",this.username)}}class Kp{db=null;username="";lastChange={white:new Date,black:new Date};lastFetch={white:new Date(0),black:new Date(0)};cache={white:[],black:[]};whiteGames=[];blackGames=[];ready=!1;load_wait(){return new Promise((n,c)=>{this.ready&&n();const p=new Ui;p.load();const d=p.get();if(d)this.username=d;else{c();return}const b=window.indexedDB.open(`player-graph-${this.username}`,2);b.onerror=k=>{console.error("DB ERROR")},b.onsuccess=k=>{this.db||(this.db=k.target?.result),this.db?n():c()},b.onupgradeneeded=k=>{console.log("UPGRADE NEEDED");const x=k.target.result;x.createObjectStore("whitewhite",{keyPath:"fen"}),x.createObjectStore("whiteblack",{keyPath:"fen"}),x.createObjectStore("blackblack",{keyPath:"fen"}),x.createObjectStore("blackwhite",{keyPath:"fen"})}})}load(n){this.username=n;const c=window.indexedDB.open(`player-graph-${n}`,2);c.onerror=p=>{console.error("DB ERROR")},c.onsuccess=p=>{this.db||(this.db=p.target?.result)},c.onupgradeneeded=p=>{console.log("UPGRADE NEEDED");const d=p.target.result;d.createObjectStore("whitewhite",{keyPath:"fen"}),d.createObjectStore("whiteblack",{keyPath:"fen"}),d.createObjectStore("blackblack",{keyPath:"fen"}),d.createObjectStore("blackwhite",{keyPath:"fen"})}}async getPosition(n,c,p){return new Promise((d,b)=>{const k=c+p,x=this.db?.transaction(k,"readonly").objectStore(k);if(x){let g=x.get(n);g.onsuccess=C=>{if(!g.result?.moves){console.log("NOT FOUND"),d(void 0);return}d(g.result)},g.onerror=C=>{d(void 0)}}else b("object store is null")})}async getFen(n,c,p){return new Promise((d,b)=>{const k=c+p,x=this.db?.transaction(k,"readonly").objectStore(k);if(x){let g=x.get(n);g.onsuccess=C=>{const R=g.result?.moves;if(!R){console.log("NOT FOUND"),d([]);return}const E=Object.entries(R).toSorted((S,P)=>P[1].count-S[1].count);d(E)},g.onerror=C=>{d("error")}}else b("object store is null")})}isready(){return this.db!==void 0&&this.db!==null}async getAll(){const n=await this.getMostCommonPositions("white"),c=await this.getMostCommonPositions("black");return[...n,...c]}async getBlackWhite(){return new Promise((n,c)=>{const d=this.db?.transaction("blackwhite","readonly").objectStore("blackwhite")?.getAll();d.onsuccess=b=>{n(d?.result)}})}async getAllSplit(){let n=["whitewhite","whiteblack","blackblack","blackwhite"],c={whitewhite:new Map,whiteblack:new Map,blackblack:new Map,blackwhite:new Map};for(const p of n){let b=(await this.getCombo(p)).reduce((k,x)=>(k.set(x.fen,x),k),new Map);c[p]=b}return c}async getCombo(n){return new Promise((c,p)=>{const d=this.db?.transaction(n,"readonly").objectStore(n);if(d){let b=d?.getAll();b.onsuccess=k=>{c(b.result)}}})}async getMostCommonPositions(n){return n=n+n,new Promise(c=>{if(this.lastFetch[n]>this.lastChange[n])console.log("cached"),c(this.cache[n]);else{console.log("loading..."),this.db||console.log("NOT READY");const p=this.db?.transaction(n,"readonly").objectStore(n);if(p){let d=p.getAll();d.onsuccess=b=>{this.lastFetch[n]=new Date;let k=d.result;this.cache[n]=k,c(this.cache[n])}}}})}async graph(){console.log("hi")}async refresh(){if(!this.username)return;const n=new Date,c=localStorage.getItem("last_refresh"),p=c?new Date(c):new Date(0),d=p.getTime();if((n-p)/1e3/60<10)return;localStorage.setItem("last_refresh",new Date().toString());const x=`https://lichess.org/api/games/user/${this.username}?since=${d}&max=700&perfType=blitz?rated=true`;try{const C=(await fetch(x)).body?.getReader();let R=!1,E=!0;for(;!R;){const S=await C?.read();if(!S)break;const{value:P,done:N}=S;if(R=N,N)break;const W=new TextDecoder().decode(P),Y=qp.parse(W,{startRule:"games"});E&&(localStorage.setItem("lastgame",JSON.stringify(Y[0])),E=!1),await this.parseGames(Y)}console.log("done")}catch(g){console.error(g)}}addMoveAsColor(n,c,p,d,b,k){return new Promise((x,g)=>{if(n==="rnbqkbnr/pppppp1p/6p1/8/2P5/8/PP1PPPPP/RNBQKBNR w KQkq - 0 2"&&(console.log("xxxxxxxxxxx"),console.log(k),console.log(b)),this.db){const C=`${p}${d}`,E=this.db.transaction(C,"readwrite").objectStore(C),S=E.get(n);S.onsuccess=P=>{let N=S.result??{fen:n,count:0,moves:{},result:{white:0,black:0,draw:0}};N.result.white+=b.white,N.result.black+=b.black,N.result.draw+=b.draw,N.count+=1,N.moves[c]||(N.moves[c]={uci:c,count:0,result:{white:0,black:0,draw:0}}),N.moves[c].count+=1,N.moves[c].result.white+=b.white,N.moves[c].result.black+=b.black,N.moves[c].result.draw+=b.draw;const W=E.put(N);W.onsuccess=Y=>{x()},W.onerror=Y=>{console.error(Y),g()}},S.onerror=P=>{console.error("ERROR"),g()}}})}async parseGames(n){for(const c of n){const p=c.tags.White.toLowerCase()==this.username.toLowerCase()?"white":"black";if(c.tags?.Variant!="Standard")continue;const d=c.tags?.Result,b=c.tags?.Site,k={white:0,black:0,draw:0};switch(d?.split("-")[0]){case"1":k.white=1;break;case"0":k.black=1;break;case"1/2":k.draw=1;break}const x=new sr;console.log("------");for(const g of c.moves){const C=g.notation.notation,R=x.turn()=="w"?"white":"black",E=x.fen();x.move(C),await this.addMoveAsColor(E,C,p,R,k,b)}}}}var Us={exports:{}};Us.exports;(function(m){(function(n,c,p){function d(g){var C=this,R=x();C.next=function(){var E=2091639*C.s0+C.c*23283064365386963e-26;return C.s0=C.s1,C.s1=C.s2,C.s2=E-(C.c=E|0)},C.c=1,C.s0=R(" "),C.s1=R(" "),C.s2=R(" "),C.s0-=R(g),C.s0<0&&(C.s0+=1),C.s1-=R(g),C.s1<0&&(C.s1+=1),C.s2-=R(g),C.s2<0&&(C.s2+=1),R=null}function b(g,C){return C.c=g.c,C.s0=g.s0,C.s1=g.s1,C.s2=g.s2,C}function k(g,C){var R=new d(g),E=C&&C.state,S=R.next;return S.int32=function(){return R.next()*4294967296|0},S.double=function(){return S()+(S()*2097152|0)*11102230246251565e-32},S.quick=S,E&&(typeof E=="object"&&b(E,R),S.state=function(){return b(R,{})}),S}function x(){var g=4022871197,C=function(R){R=String(R);for(var E=0;E<R.length;E++){g+=R.charCodeAt(E);var S=.02519603282416938*g;g=S>>>0,S-=g,S*=g,g=S>>>0,S-=g,g+=S*4294967296}return(g>>>0)*23283064365386963e-26};return C}c&&c.exports?c.exports=k:this.alea=k})(Re,m)})(Us);var Gp=Us.exports,Is={exports:{}};Is.exports;(function(m){(function(n,c,p){function d(x){var g=this,C="";g.x=0,g.y=0,g.z=0,g.w=0,g.next=function(){var E=g.x^g.x<<11;return g.x=g.y,g.y=g.z,g.z=g.w,g.w^=g.w>>>19^E^E>>>8},x===(x|0)?g.x=x:C+=x;for(var R=0;R<C.length+64;R++)g.x^=C.charCodeAt(R)|0,g.next()}function b(x,g){return g.x=x.x,g.y=x.y,g.z=x.z,g.w=x.w,g}function k(x,g){var C=new d(x),R=g&&g.state,E=function(){return(C.next()>>>0)/4294967296};return E.double=function(){do var S=C.next()>>>11,P=(C.next()>>>0)/4294967296,N=(S+P)/(1<<21);while(N===0);return N},E.int32=C.next,E.quick=E,R&&(typeof R=="object"&&b(R,C),E.state=function(){return b(C,{})}),E}c&&c.exports?c.exports=k:this.xor128=k})(Re,m)})(Is);var zp=Is.exports,qs={exports:{}};qs.exports;(function(m){(function(n,c,p){function d(x){var g=this,C="";g.next=function(){var E=g.x^g.x>>>2;return g.x=g.y,g.y=g.z,g.z=g.w,g.w=g.v,(g.d=g.d+362437|0)+(g.v=g.v^g.v<<4^(E^E<<1))|0},g.x=0,g.y=0,g.z=0,g.w=0,g.v=0,x===(x|0)?g.x=x:C+=x;for(var R=0;R<C.length+64;R++)g.x^=C.charCodeAt(R)|0,R==C.length&&(g.d=g.x<<10^g.x>>>4),g.next()}function b(x,g){return g.x=x.x,g.y=x.y,g.z=x.z,g.w=x.w,g.v=x.v,g.d=x.d,g}function k(x,g){var C=new d(x),R=g&&g.state,E=function(){return(C.next()>>>0)/4294967296};return E.double=function(){do var S=C.next()>>>11,P=(C.next()>>>0)/4294967296,N=(S+P)/(1<<21);while(N===0);return N},E.int32=C.next,E.quick=E,R&&(typeof R=="object"&&b(R,C),E.state=function(){return b(C,{})}),E}c&&c.exports?c.exports=k:this.xorwow=k})(Re,m)})(qs);var Lp=qs.exports,Ks={exports:{}};Ks.exports;(function(m){(function(n,c,p){function d(x){var g=this;g.next=function(){var R=g.x,E=g.i,S,P;return S=R[E],S^=S>>>7,P=S^S<<24,S=R[E+1&7],P^=S^S>>>10,S=R[E+3&7],P^=S^S>>>3,S=R[E+4&7],P^=S^S<<7,S=R[E+7&7],S=S^S<<13,P^=S^S<<9,R[E]=P,g.i=E+1&7,P};function C(R,E){var S,P=[];if(E===(E|0))P[0]=E;else for(E=""+E,S=0;S<E.length;++S)P[S&7]=P[S&7]<<15^E.charCodeAt(S)+P[S+1&7]<<13;for(;P.length<8;)P.push(0);for(S=0;S<8&&P[S]===0;++S);for(S==8?P[7]=-1:P[S],R.x=P,R.i=0,S=256;S>0;--S)R.next()}C(g,x)}function b(x,g){return g.x=x.x.slice(),g.i=x.i,g}function k(x,g){x==null&&(x=+new Date);var C=new d(x),R=g&&g.state,E=function(){return(C.next()>>>0)/4294967296};return E.double=function(){do var S=C.next()>>>11,P=(C.next()>>>0)/4294967296,N=(S+P)/(1<<21);while(N===0);return N},E.int32=C.next,E.quick=E,R&&(R.x&&b(R,C),E.state=function(){return b(C,{})}),E}c&&c.exports?c.exports=k:this.xorshift7=k})(Re,m)})(Ks);var Yp=Ks.exports,Gs={exports:{}};Gs.exports;(function(m){(function(n,c,p){function d(x){var g=this;g.next=function(){var R=g.w,E=g.X,S=g.i,P,N;return g.w=R=R+1640531527|0,N=E[S+34&127],P=E[S=S+1&127],N^=N<<13,P^=P<<17,N^=N>>>15,P^=P>>>12,N=E[S]=N^P,g.i=S,N+(R^R>>>16)|0};function C(R,E){var S,P,N,W,Y,ae=[],Q=128;for(E===(E|0)?(P=E,E=null):(E=E+"\0",P=0,Q=Math.max(Q,E.length)),N=0,W=-32;W<Q;++W)E&&(P^=E.charCodeAt((W+32)%E.length)),W===0&&(Y=P),P^=P<<10,P^=P>>>15,P^=P<<4,P^=P>>>13,W>=0&&(Y=Y+1640531527|0,S=ae[W&127]^=P+Y,N=S==0?N+1:0);for(N>=128&&(ae[(E&&E.length||0)&127]=-1),N=127,W=4*128;W>0;--W)P=ae[N+34&127],S=ae[N=N+1&127],P^=P<<13,S^=S<<17,P^=P>>>15,S^=S>>>12,ae[N]=P^S;R.w=Y,R.X=ae,R.i=N}C(g,x)}function b(x,g){return g.i=x.i,g.w=x.w,g.X=x.X.slice(),g}function k(x,g){x==null&&(x=+new Date);var C=new d(x),R=g&&g.state,E=function(){return(C.next()>>>0)/4294967296};return E.double=function(){do var S=C.next()>>>11,P=(C.next()>>>0)/4294967296,N=(S+P)/(1<<21);while(N===0);return N},E.int32=C.next,E.quick=E,R&&(R.X&&b(R,C),E.state=function(){return b(C,{})}),E}c&&c.exports?c.exports=k:this.xor4096=k})(Re,m)})(Gs);var Hp=Gs.exports,zs={exports:{}};zs.exports;(function(m){(function(n,c,p){function d(x){var g=this,C="";g.next=function(){var E=g.b,S=g.c,P=g.d,N=g.a;return E=E<<25^E>>>7^S,S=S-P|0,P=P<<24^P>>>8^N,N=N-E|0,g.b=E=E<<20^E>>>12^S,g.c=S=S-P|0,g.d=P<<16^S>>>16^N,g.a=N-E|0},g.a=0,g.b=0,g.c=-1640531527,g.d=1367130551,x===Math.floor(x)?(g.a=x/4294967296|0,g.b=x|0):C+=x;for(var R=0;R<C.length+20;R++)g.b^=C.charCodeAt(R)|0,g.next()}function b(x,g){return g.a=x.a,g.b=x.b,g.c=x.c,g.d=x.d,g}function k(x,g){var C=new d(x),R=g&&g.state,E=function(){return(C.next()>>>0)/4294967296};return E.double=function(){do var S=C.next()>>>11,P=(C.next()>>>0)/4294967296,N=(S+P)/(1<<21);while(N===0);return N},E.int32=C.next,E.quick=E,R&&(typeof R=="object"&&b(R,C),E.state=function(){return b(C,{})}),E}c&&c.exports?c.exports=k:this.tychei=k})(Re,m)})(zs);var Xp=zs.exports,Ii={exports:{}};const Vp={},Qp=Object.freeze(Object.defineProperty({__proto__:null,default:Vp},Symbol.toStringTag,{value:"Module"})),Zp=Ip(Qp);(function(m){(function(n,c,p){var d=256,b=6,k=52,x="random",g=p.pow(d,b),C=p.pow(2,k),R=C*2,E=d-1,S;function P(F,r,X){var z=[];r=r==!0?{entropy:!0}:r||{};var K=ae(Y(r.entropy?[F,f(c)]:F??Q(),3),z),oe=new N(z),ne=function(){for(var V=oe.g(b),q=g,G=0;V<C;)V=(V+G)*d,q*=d,G=oe.g(1);for(;V>=R;)V/=2,q/=2,G>>>=1;return(V+G)/q};return ne.int32=function(){return oe.g(4)|0},ne.quick=function(){return oe.g(4)/4294967296},ne.double=ne,ae(f(oe.S),c),(r.pass||X||function(V,q,G,ee){return ee&&(ee.S&&W(ee,oe),V.state=function(){return W(oe,{})}),G?(p[x]=V,q):V})(ne,K,"global"in r?r.global:this==p,r.state)}function N(F){var r,X=F.length,z=this,K=0,oe=z.i=z.j=0,ne=z.S=[];for(X||(F=[X++]);K<d;)ne[K]=K++;for(K=0;K<d;K++)ne[K]=ne[oe=E&oe+F[K%X]+(r=ne[K])],ne[oe]=r;(z.g=function(V){for(var q,G=0,ee=z.i,ue=z.j,be=z.S;V--;)q=be[ee=E&ee+1],G=G*d+be[E&(be[ee]=be[ue=E&ue+q])+(be[ue]=q)];return z.i=ee,z.j=ue,G})(d)}function W(F,r){return r.i=F.i,r.j=F.j,r.S=F.S.slice(),r}function Y(F,r){var X=[],z=typeof F,K;if(r&&z=="object")for(K in F)try{X.push(Y(F[K],r-1))}catch{}return X.length?X:z=="string"?F:F+"\0"}function ae(F,r){for(var X=F+"",z,K=0;K<X.length;)r[E&K]=E&(z^=r[E&K]*19)+X.charCodeAt(K++);return f(r)}function Q(){try{var F;return S&&(F=S.randomBytes)?F=F(d):(F=new Uint8Array(d),(n.crypto||n.msCrypto).getRandomValues(F)),f(F)}catch{var r=n.navigator,X=r&&r.plugins;return[+new Date,n,X,n.screen,f(c)]}}function f(F){return String.fromCharCode.apply(0,F)}if(ae(p.random(),c),m.exports){m.exports=P;try{S=Zp}catch{}}else p["seed"+x]=P})(typeof self<"u"?self:Re,[],Math)})(Ii);var Jp=Ii.exports,eh=Gp,rh=zp,th=Lp,sh=Yp,ah=Hp,ih=Xp,ar=Jp;ar.alea=eh;ar.xor128=rh;ar.xorwow=th;ar.xorshift7=sh;ar.xor4096=ah;ar.tychei=ih;var nh=ar;const fh=Up(nh);var re=(m=>(m[m.New=0]="New",m[m.Learning=1]="Learning",m[m.Review=2]="Review",m[m.Relearning=3]="Relearning",m))(re||{}),Z=(m=>(m[m.Manual=0]="Manual",m[m.Again=1]="Again",m[m.Hard=2]="Hard",m[m.Good=3]="Good",m[m.Easy=4]="Easy",m))(Z||{});Date.prototype.scheduler=function(m,n){return tr(this,m,n)},Date.prototype.diff=function(m,n){return oh(this,m,n)},Date.prototype.format=function(){return lh(this)},Date.prototype.dueFormat=function(m,n,c){return ch(this,m,n,c)};function tr(m,n,c){return new Date(c?ke(m).getTime()+n*24*60*60*1e3:ke(m).getTime()+n*60*1e3)}function oh(m,n,c){if(!m||!n)throw new Error("Invalid date");const p=ke(m).getTime()-ke(n).getTime();let d=0;switch(c){case"days":d=Math.floor(p/(24*60*60*1e3));break;case"minutes":d=Math.floor(p/(60*1e3));break}return d}function lh(m){const n=ke(m),c=n.getFullYear(),p=n.getMonth()+1,d=n.getDate(),b=n.getHours(),k=n.getMinutes(),x=n.getSeconds();return`${c}-${Mt(p)}-${Mt(d)} ${Mt(b)}:${Mt(k)}:${Mt(x)}`}function Mt(m){return m<10?`0${m}`:`${m}`}const Os=[60,60,24,31,12],Fs=["second","min","hour","day","month","year"];function ch(m,n,c,p=Fs){m=ke(m),n=ke(n),p.length!==Fs.length&&(p=Fs);let d=m.getTime()-n.getTime(),b;for(d/=1e3,b=0;b<Os.length&&!(d<Os[b]);b++)d/=Os[b];return`${Math.floor(d)}${c?p[b]:""}`}function ke(m){if(typeof m=="object"&&m instanceof Date)return m;if(typeof m=="string"){const n=Date.parse(m);if(isNaN(n))throw new Error(`Invalid date:[${m}]`);return new Date(n)}else if(typeof m=="number")return new Date(m);throw new Error(`Invalid date:[${m}]`)}function Bs(m){if(typeof m=="string"){const n=m.charAt(0).toUpperCase(),c=m.slice(1).toLowerCase(),p=re[`${n}${c}`];if(p===void 0)throw new Error(`Invalid state:[${m}]`);return p}else if(typeof m=="number")return m;throw new Error(`Invalid state:[${m}]`)}function uh(m){if(typeof m=="string"){const n=m.charAt(0).toUpperCase(),c=m.slice(1).toLowerCase(),p=Z[`${n}${c}`];if(p===void 0)throw new Error(`Invalid rating:[${m}]`);return p}else if(typeof m=="number")return m;throw new Error(`Invalid rating:[${m}]`)}Z.Again,Z.Hard,Z.Good,Z.Easy;const gh=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function vh(m,n,c){let p=1;for(const k of gh)p+=k.factor*Math.max(Math.min(m,k.end)-k.start,0);m=Math.min(m,c);let d=Math.max(2,Math.round(m-p));const b=Math.min(Math.round(m+p),c);return m>n&&(d=Math.max(d,n+1)),d=Math.min(d,b),{min_ivl:d,max_ivl:b}}class ph{again;hard;good;easy;last_review;last_elapsed_days;copy(n){return{...n}}constructor(n,c){this.last_review=n.last_review||n.due,this.last_elapsed_days=n.elapsed_days,n.elapsed_days=n.state===re.New?0:c.diff(n.last_review,"days"),n.last_review=c,n.reps+=1,this.again=this.copy(n),this.hard=this.copy(n),this.good=this.copy(n),this.easy=this.copy(n)}update_state(n){return n===re.New?(this.again.state=re.Learning,this.hard.state=re.Learning,this.good.state=re.Learning,this.easy.state=re.Review):n===re.Learning||n===re.Relearning?(this.again.state=n,this.hard.state=n,this.good.state=re.Review,this.easy.state=re.Review):n===re.Review&&(this.again.state=re.Relearning,this.hard.state=re.Review,this.good.state=re.Review,this.easy.state=re.Review,this.again.lapses+=1),this}schedule(n,c,p,d){return this.again.scheduled_days=0,this.hard.scheduled_days=c,this.good.scheduled_days=p,this.easy.scheduled_days=d,this.again.due=tr(n,5),this.hard.due=c>0?tr(n,c,!0):tr(n,10),this.good.due=tr(n,p,!0),this.easy.due=tr(n,d,!0),this}record_log(n,c){return{[Z.Again]:{card:this.again,log:{rating:Z.Again,state:n.state,due:this.last_review,stability:n.stability,difficulty:n.difficulty,elapsed_days:n.elapsed_days,last_elapsed_days:this.last_elapsed_days,scheduled_days:n.scheduled_days,review:c}},[Z.Hard]:{card:this.hard,log:{rating:Z.Hard,state:n.state,due:this.last_review,stability:n.stability,difficulty:n.difficulty,elapsed_days:n.elapsed_days,last_elapsed_days:this.last_elapsed_days,scheduled_days:n.scheduled_days,review:c}},[Z.Good]:{card:this.good,log:{rating:Z.Good,state:n.state,due:this.last_review,stability:n.stability,difficulty:n.difficulty,elapsed_days:n.elapsed_days,last_elapsed_days:this.last_elapsed_days,scheduled_days:n.scheduled_days,review:c}},[Z.Easy]:{card:this.easy,log:{rating:Z.Easy,state:n.state,due:this.last_review,stability:n.stability,difficulty:n.difficulty,elapsed_days:n.elapsed_days,last_elapsed_days:this.last_elapsed_days,scheduled_days:n.scheduled_days,review:c}}}}}const hh=.9,dh=36500,$h=[.5701,1.4436,4.1386,10.9355,5.1443,1.2006,.8627,.0362,1.629,.1342,1.0166,2.1174,.0839,.3204,1.4676,.219,2.8237],mh=!1,Oi=m=>({request_retention:m?.request_retention||hh,maximum_interval:m?.maximum_interval||dh,w:m?.w||$h,enable_fuzz:m?.enable_fuzz||mh});function bh(m,n){return{due:new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,state:re.New,last_review:void 0}}const Fi=-.5,Bi=19/81;class wh{param;intervalModifier;seed;constructor(n){this.param=new Proxy(Oi(n),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention)}get interval_modifier(){return this.intervalModifier}calculate_interval_modifier(n){if(n<=0||n>1)throw new Error("Requested retention rate should be in the range (0,1]");return+((Math.pow(n,1/Fi)-1)/Bi).toFixed(8)}get parameters(){return this.param}set parameters(n){this.update_parameters(n)}params_handler_proxy(){const n=this;return{set:function(c,p,d){return p==="request_retention"&&Number.isFinite(d)&&(n.intervalModifier=n.calculate_interval_modifier(Number(d))),c[p]=d,!0}}}update_parameters(n){const c=Oi(n);for(const p in c)if(p in this.param){const d=p;this.param[d]=c[d]}}init_ds(n){n.again.difficulty=this.init_difficulty(Z.Again),n.again.stability=this.init_stability(Z.Again),n.hard.difficulty=this.init_difficulty(Z.Hard),n.hard.stability=this.init_stability(Z.Hard),n.good.difficulty=this.init_difficulty(Z.Good),n.good.stability=this.init_stability(Z.Good),n.easy.difficulty=this.init_difficulty(Z.Easy),n.easy.stability=this.init_stability(Z.Easy)}next_ds(n,c,p,d){n.again.difficulty=this.next_difficulty(c,Z.Again),n.again.stability=this.next_forget_stability(c,p,d),n.hard.difficulty=this.next_difficulty(c,Z.Hard),n.hard.stability=this.next_recall_stability(c,p,d,Z.Hard),n.good.difficulty=this.next_difficulty(c,Z.Good),n.good.stability=this.next_recall_stability(c,p,d,Z.Good),n.easy.difficulty=this.next_difficulty(c,Z.Easy),n.easy.stability=this.next_recall_stability(c,p,d,Z.Easy)}init_stability(n){return Math.max(this.param.w[n-1],.1)}init_difficulty(n){return+Math.min(Math.max(this.param.w[4]-(n-3)*this.param.w[5],1),10).toFixed(8)}apply_fuzz(n,c,p){if(!p||n<2.5)return Math.round(n);const d=fh(this.seed)(),{min_ivl:b,max_ivl:k}=vh(n,c,this.param.maximum_interval);return Math.floor(d*(k-b+1)+b)}next_interval(n,c,p=this.param.enable_fuzz){const d=Math.min(Math.max(1,Math.round(n*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(d,c,p)}next_difficulty(n,c){const p=n-this.param.w[6]*(c-3);return this.constrain_difficulty(this.mean_reversion(this.param.w[4],p))}constrain_difficulty(n){return Math.min(Math.max(+n.toFixed(8),1),10)}mean_reversion(n,c){return+(this.param.w[7]*n+(1-this.param.w[7])*c).toFixed(8)}next_recall_stability(n,c,p,d){const b=Z.Hard===d?this.param.w[15]:1,k=Z.Easy===d?this.param.w[16]:1;return+(c*(1+Math.exp(this.param.w[8])*(11-n)*Math.pow(c,-this.param.w[9])*(Math.exp((1-p)*this.param.w[10])-1)*b*k)).toFixed(8)}next_forget_stability(n,c,p){return+(this.param.w[11]*Math.pow(n,-this.param.w[12])*(Math.pow(c+1,this.param.w[13])-1)*Math.exp((1-p)*this.param.w[14])).toFixed(8)}forgetting_curve(n,c){return+Math.pow(1+Bi*n/c,Fi).toFixed(8)}}class yh extends wh{constructor(n){super(n)}preProcessCard(n){return{...n,state:Bs(n.state),due:ke(n.due),last_review:n.last_review?ke(n.last_review):void 0}}preProcessDate(n){return ke(n)}preProcessLog(n){return{...n,due:ke(n.due),rating:uh(n.rating),state:Bs(n.state),review:ke(n.review)}}repeat(n,c,p){const d=this.preProcessCard(n);c=this.preProcessDate(c);const b=new ph(d,c).update_state(d.state);this.seed=String(c.getTime())+String(d.reps);let k,x,g;const C=d.elapsed_days;switch(d.state){case re.New:this.init_ds(b),b.again.due=c.scheduler(1),b.hard.due=c.scheduler(5),b.good.due=c.scheduler(10),k=this.next_interval(b.easy.stability,C),b.easy.scheduled_days=k,b.easy.due=c.scheduler(k,!0);break;case re.Learning:case re.Relearning:g=0,x=this.next_interval(b.good.stability,C),k=Math.max(this.next_interval(b.easy.stability,C),x+1),b.schedule(c,g,x,k);break;case re.Review:{const E=d.difficulty,S=d.stability,P=this.forgetting_curve(C,S);this.next_ds(b,E,S,P),g=this.next_interval(b.hard.stability,C),x=this.next_interval(b.good.stability,C),g=Math.min(g,x),x=Math.max(x,g+1),k=Math.max(this.next_interval(b.easy.stability,C),x+1),b.schedule(c,g,x,k);break}}const R=b.record_log(d,c);return p&&typeof p=="function"?p(R):R}get_retrievability(n,c,p=!0){const d=this.preProcessCard(n);if(c=this.preProcessDate(c),d.state!==re.Review)return;const b=Math.max(c.diff(d.last_review,"days"),0),k=this.forgetting_curve(b,Math.round(d.stability));return p?`${(k*100).toFixed(2)}%`:k}rollback(n,c,p){const d=this.preProcessCard(n),b=this.preProcessLog(c);if(b.rating===Z.Manual)throw new Error("Cannot rollback a manual rating");let k,x,g;switch(b.state){case re.New:k=b.due,x=void 0,g=0;break;case re.Learning:case re.Relearning:case re.Review:k=b.review,x=b.due,g=d.lapses-(b.rating===Z.Again&&b.state===re.Review?1:0);break}const C={...d,due:k,stability:b.stability,difficulty:b.difficulty,elapsed_days:b.last_elapsed_days,scheduled_days:b.scheduled_days,reps:Math.max(0,d.reps-1),lapses:Math.max(0,g),state:b.state,last_review:x};return p&&typeof p=="function"?p(C):C}forget(n,c,p=!1,d){const b=this.preProcessCard(n);c=this.preProcessDate(c);const k=b.state===re.New?0:c.diff(b.last_review,"days"),x={rating:Z.Manual,state:b.state,due:b.due,stability:b.stability,difficulty:b.difficulty,elapsed_days:0,last_elapsed_days:b.elapsed_days,scheduled_days:k,review:c},g={card:{...b,due:c,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:p?0:b.reps,lapses:p?0:b.lapses,state:re.New,last_review:b.last_review},log:x};return d&&typeof d=="function"?d(g):g}reschedule(n,c={}){if(!Array.isArray(n))throw new Error("cards must be an array");const p=[];for(const d of n){if(Bs(d.state)!==re.Review||!d.last_review)continue;const b=Math.floor(d.scheduled_days),k=this.next_interval(+d.stability.toFixed(2),Math.round(d.elapsed_days),c.enable_fuzz??!0);if(k===b||k===0)continue;const x={...d};x.scheduled_days=k;const g=tr(x.last_review,k,!0);c.dateHandler&&typeof c.dateHandler=="function"?x.due=c.dateHandler(g):x.due=g,p.push(x)}return p}}const Bh=m=>new yh(m||{});class _h{db=null;constructor(){}ready(){return this.db!==null&&this.db!==void 0}load(){return new Promise((n,c)=>{this.db&&n();const p=window.indexedDB.open("repertoire",2);p.onerror=d=>{console.error("DB ERROR")},p.onsuccess=d=>{this.db||(this.db=d.target?.result),n()},p.onupgradeneeded=d=>{console.log("UPGRADE NEEDED"),d.target.result.createObjectStore("position",{keyPath:"fen"})}})}load_json(n){for(const c of n){const d=this.db.transaction("position","readwrite").objectStore("position"),b={card:{due:new Date(c.card.due),last_review:new Date(c.card.last_review),...c.card},...c};console.log(b),d.put(b)}}addLine(n,c){if(console.log("adding response to LINE"),this.db){console.log(this.db);const d=this.db.transaction("position","readwrite").objectStore("position"),b=bh();d.put({fen:n,response:[c],card:b})}}updateRep(n,c){this.db&&this.db.transaction("position","readwrite").objectStore("position").put({fen:n.fen,response:n.response,card:c})}getAll(){if(this.db){const p=this.db.transaction("position","readonly").objectStore("position").getAll();return new Promise((d,b)=>{p.onsuccess=k=>{d(p.result)},p.onerror=k=>{b()}})}else return console.error("ERROR"),new Promise((n,c)=>{c()})}getLine(n){return new Promise(async(c,p)=>{this.db||await this.load();const k=this.db.transaction("position","readonly").objectStore("position").get(n);k.onsuccess=x=>{const g=k.result??[];c(g)},k.onerror=x=>{p(x)}})}}var qi=(()=>{var m=import.meta.url;return function(n={}){var c;function p(){return K.buffer!=q.buffer&&Ce(),q}function d(){return K.buffer!=q.buffer&&Ce(),G}function b(){return K.buffer!=q.buffer&&Ce(),ee}function k(){return K.buffer!=q.buffer&&Ce(),ue}function x(){return K.buffer!=q.buffer&&Ce(),be}var g=Object.assign({},n),C,R,E=new Promise((u,w)=>{C=u,R=w}),S=typeof window=="object",P=typeof importScripts=="function",N=typeof process=="object"&&typeof process.ma=="object"&&typeof process.ma.node=="string",W=P&&self.name=="em-pthread";g.listen||(g.listen=u=>console.log(u)),g.onError||(g.onError=u=>console.error(u)),g.getRecommendedNnue=(u=0)=>ze(vt(u)),g.setNnueBuffer=function(u,w=0){if(!u)throw Error("buf is null");if(0>=u.byteLength)throw Error(`${u.byteLength} bytes?`);const y=br(u.byteLength);if(!y)throw Error(`could not allocate ${u.byteLength} bytes`);g.HEAPU8.set(u,y),gt(y,u.byteLength,w)},g.uci=function(u){const w=dr(u)+1,y=br(w);if(!y)throw Error(`Could not allocate ${w} bytes`);$r(u,y,w),ut(y)},g.print=u=>g.listen?.(u),g.printErr=u=>g.onError?.(u);var Y=Object.assign({},g),ae=[],Q="",f;(S||P)&&(P?Q=self.location.href:typeof document<"u"&&document.currentScript&&(Q=document.currentScript.src),m&&(Q=m),Q.startsWith("blob:")?Q="":Q=Q.substr(0,Q.replace(/[?#].*/,"").lastIndexOf("/")+1),P&&(f=u=>{var w=new XMLHttpRequest;return w.open("GET",u,!1),w.responseType="arraybuffer",w.send(null),new Uint8Array(w.response)}));var F=g.print||console.log.bind(console),r=g.printErr||console.error.bind(console);if(Object.assign(g,Y),Y=null,W){let u=function(...y){console.error(y.join(" "))},w=function(y){try{var D=y.data,j=D.cmd;if(j==="load"){let O=[];self.onmessage=U=>O.push(U),self.startWorker=()=>{postMessage({cmd:"loaded"});for(let U of O)w(U);self.onmessage=w};for(const U of D.handlers)(!g[U]||g[U].proxy)&&(g[U]=(...le)=>{postMessage({ea:"callHandler",pa:U,oa:le})},U=="print"&&(F=g[U]),U=="printErr"&&(r=g[U]));K=D.wasmMemory,Ce(),X(D.wasmModule)}else if(j==="run"){mr(D.pthread_ptr,0,0,1,0,0),cr(D.pthread_ptr),jt(),qr(),z||=!0;try{Wt(D.start_routine,D.arg)}catch(O){if(O!="unwind")throw O}}else j==="cancel"?Oe()&&He(-1):D.target!=="setimmediate"&&(j==="checkMailbox"?z&&Le():j&&(r(`worker: received unknown command ${j}`),r(D)))}catch(O){throw dt(),O}};var X,z=!1;g.printErr||(r=u),self.alert=function(...y){postMessage({ea:"alert",text:y.join(" "),qa:Oe()})},g.instantiateWasm=(y,D)=>new Promise(j=>{X=O=>{O=new WebAssembly.Instance(O,Pr()),D(O),j()}}),self.onunhandledrejection=y=>{throw y.reason||y},self.onmessage=w}var K,oe,ne=!1,V,q,G,ee,ue,be;function Ce(){var u=K.buffer;q=new Int8Array(u),g.HEAPU8=G=new Uint8Array(u),ee=new Int32Array(u),ue=new Uint32Array(u),be=new Float64Array(u)}if(!W){if(g.wasmMemory)K=g.wasmMemory;else if(K=new WebAssembly.Memory({initial:1024,maximum:32768,shared:!0}),!(K.buffer instanceof SharedArrayBuffer))throw r("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),N&&r("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");Ce()}var Sr=[],ir=[],Dt=[],Tt=[],Rt=[],nr=!1,Ne=0,Fe=null;function Mr(){if(Ne--,Ne==0&&Fe){var u=Fe;Fe=null,u()}}function fr(u){throw u="Aborted("+u+")",r(u),ne=!0,V=1,u=new WebAssembly.RuntimeError(u+". Build with -sASSERTIONS for more info."),R(u),u}var Dr=u=>u.startsWith("data:application/octet-stream;base64,"),Tr;function Rr(u){if(f)return f(u);throw"both async and sync fetching of the wasm failed"}function Nt(u){return(S||P)&&typeof fetch=="function"?fetch(u,{credentials:"same-origin"}).then(w=>{if(!w.ok)throw`failed to load wasm binary file at '${u}'`;return w.arrayBuffer()}).catch(()=>Rr(u)):Promise.resolve().then(()=>Rr(u))}function Nr(u,w,y){return Nt(u).then(D=>WebAssembly.instantiate(D,w)).then(y,D=>{r(`failed to asynchronously prepare wasm: ${D}`),fr(D)})}function Pt(u,w){var y=Tr;return typeof WebAssembly.instantiateStreaming!="function"||Dr(y)||typeof fetch!="function"?Nr(y,u,w):fetch(y,{credentials:"same-origin"}).then(D=>WebAssembly.instantiateStreaming(D,u).then(w,function(j){return r(`wasm streaming compile failed: ${j}`),r("falling back to ArrayBuffer instantiation"),Nr(y,u,w)}))}function Pr(){return ct={y:Yr,f:Vr,t:Qr,u:Zr,m:Ut,z:It,k:qt,x:Kt,i:Gt,g:zt,j:cr,h:Lt,d:Yt,l:Ht,b:Jr,w:Xt,r:Ot,p:rt,q:tt,c:Ke,e:st,s:at,n:it,v:nt,a:K,o:Jt},{a:ct}}function Or(u){this.name="ExitStatus",this.message=`Program terminated with exit(${u})`,this.status=u}var or=u=>{u.terminate(),u.onmessage=()=>{}},Fr=u=>{Ee.length==0&&(Gr(),Kr(Ee[0]));var w=Ee.pop();return w?(De.push(w),we[u.Y]=w,w.Y=u.Y,w.postMessage({cmd:"run",start_routine:u.ga,arg:u.fa,pthread_ptr:u.Y},u.la),0):6},Ae=0,Ot=()=>0<Ae,pe=(u,w,...y)=>{for(var D=y.length,j=yt(),O=Xe(8*D),U=O>>3,le=0;le<y.length;le++){var ye=y[le];x()[U+le]=ye}return u=mt(u,0,D,O,w),yr(j),u};function Br(u){if(W)return pe(0,1,u);throw V=u,0<Ae||(Ur(),ne=!0),new Or(u)}var lr=u=>{if(!(u instanceof Or||u=="unwind"))throw u};function jr(u){if(W)return pe(1,0,u);--Ae,Ke(u)}var Ke=u=>{if(V=u,W)throw jr(u),"unwind";0<Ae||W||(ht(),Pe(Tt),$t(0),pr[1].length&&hr(1,10),pr[2].length&&hr(2,10),Ur(),nr=!0),Br(u)},Ee=[],De=[],Wr=[],we={};function Ft(){for(var u=navigator.hardwareConcurrency;u--;)Gr();Sr.unshift(()=>{Ne++,Bt(()=>Mr())})}var Ur=()=>{for(var u of De)or(u);for(u of Ee)or(u);Ee=[],De=[],we=[]},Ir=u=>{var w=u.Y;delete we[w],Ee.push(u),De.splice(De.indexOf(u),1),u.Y=0,wr(w)};function qr(){Wr.forEach(u=>u())}var Kr=u=>new Promise(w=>{u.onmessage=O=>{O=O.data;var U=O.cmd;if(O.targetThread&&O.targetThread!=Oe()){var le=we[O.targetThread];le?le.postMessage(O,O.transferList):r(`Internal error! Worker sent a message "${U}" to target pthread ${O.targetThread}, but that thread no longer exists!`)}else U==="checkMailbox"?Le():U==="spawnThread"?Fr(O):U==="cleanupThread"?Ir(we[O.thread]):U==="killThread"?(O=O.thread,U=we[O],delete we[O],or(U),wr(O),De.splice(De.indexOf(U),1),U.Y=0):U==="cancelThread"?we[O.thread].postMessage({cmd:"cancel"}):U==="loaded"?(u.loaded=!0,w(u)):U==="alert"?alert(`Thread ${O.threadId}: ${O.text}`):O.target==="setimmediate"?u.postMessage(O):U==="callHandler"?g[O.handler](...O.args):U&&r(`worker sent an unknown command ${U}`)},u.onerror=O=>{throw r(`worker sent an error! ${O.filename}:${O.lineno}: ${O.message}`),O};var y=[],D=["print","printErr"],j;for(j of D)g.hasOwnProperty(j)&&y.push(j);u.postMessage({cmd:"load",handlers:y,wasmMemory:K,wasmModule:oe})});function Bt(u){W?u():Promise.all(Ee.map(Kr)).then(u)}function Gr(){var u=new Worker(new URL(import.meta.url),{type:"module",name:"em-pthread"});Ee.push(u)}var Pe=u=>{for(;0<u.length;)u.shift()(g)},jt=()=>{var u=Oe(),w=k()[u+52>>2];u=k()[u+56>>2],wt(w,w-u),yr(w)},Ge=[],zr,Wt=(u,w)=>{Ae=0;var y=Ge[u];y||(u>=Ge.length&&(Ge.length=u+1),Ge[u]=y=zr.get(u)),u=y(w),0<Ae?V=u:He(u)};function Lr(u,w,y,D){return W?pe(2,1,u,w,y,D):Yr(u,w,y,D)}var Yr=(u,w,y,D)=>{if(typeof SharedArrayBuffer>"u")return r("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var j=[];return W&&j.length===0?Lr(u,w,y,D):(u={ga:y,Y:u,fa:D,la:j},W?(u.ea="spawnThread",postMessage(u,j),0):Fr(u))},Hr=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Xr=(u,w,y)=>{var D=w+y;for(y=w;u[y]&&!(y>=D);)++y;if(16<y-w&&u.buffer&&Hr)return Hr.decode(u.buffer instanceof SharedArrayBuffer?u.slice(w,y):u.subarray(w,y));for(D="";w<y;){var j=u[w++];if(j&128){var O=u[w++]&63;if((j&224)==192)D+=String.fromCharCode((j&31)<<6|O);else{var U=u[w++]&63;j=(j&240)==224?(j&15)<<12|O<<6|U:(j&7)<<18|O<<12|U<<6|u[w++]&63,65536>j?D+=String.fromCharCode(j):(j-=65536,D+=String.fromCharCode(55296|j>>10,56320|j&1023))}}else D+=String.fromCharCode(j)}return D},ze=(u,w)=>u?Xr(d(),u,w):"";function Vr(u,w,y){return W?pe(3,1,u,w,y):0}function Qr(u,w,y){return W?pe(4,1,u,w,y):0}function Zr(u,w,y,D){if(W)return pe(5,1,u,w,y,D)}var Ut=()=>{fr("")},It=()=>1,qt=u=>{mr(u,!P,1,!S,2097152,!1),qr()},cr=u=>{typeof Atomics.na=="function"&&(Atomics.na(b(),u>>2,u).value.then(Le),u+=128,Atomics.store(b(),u>>2,1))},Le=()=>{var u=Oe();if(u&&(cr(u),u=bt,!nr&&!ne))try{if(u(),!(nr||0<Ae))try{W?He(V):Ke(V)}catch(w){lr(w)}}catch(w){lr(w)}},Kt=(u,w)=>{u==w?setTimeout(Le):W?postMessage({targetThread:u,cmd:"checkMailbox"}):(u=we[u])&&u.postMessage({cmd:"checkMailbox"})},ur=[],Gt=(u,w,y,D,j)=>{for(ur.length=D,w=j>>3,y=0;y<D;y++)ur[y]=x()[w+y];return(0,es[u])(...ur)},zt=u=>{W?postMessage({cmd:"cleanupThread",thread:u}):Ir(we[u])},Lt=()=>{},Be=()=>{Be.ca||(Be.ca={}),Be.ca["Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread"]||(Be.ca["Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread"]=1,r("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread"))},Yt=()=>{P||(Be(),fr("Blocking on the main thread is not allowed by default. See https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread"))},Ht=()=>{throw Ae+=1,"unwind"},Jr;Jr=()=>performance.timeOrigin+performance.now();var Xt=u=>{var w=d().length;if(u>>>=0,u<=w||2147483648<u)return!1;for(var y=1;4>=y;y*=2){var D=w*(1+.2/y);D=Math.min(D,u+100663296);var j=Math;D=Math.max(u,D);e:{j=(j.min.call(j,2147483648,D+(65536-D%65536)%65536)-K.buffer.byteLength+65535)/65536;try{K.grow(j),Ce();var O=1;break e}catch{}O=void 0}if(O)return!0}return!1},gr={},et=()=>{if(!vr){var u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"},w;for(w in gr)gr[w]===void 0?delete u[w]:u[w]=gr[w];var y=[];for(w in u)y.push(`${w}=${u[w]}`);vr=y}return vr},vr;function rt(u,w){if(W)return pe(6,1,u,w);var y=0;return et().forEach((D,j)=>{var O=w+y;for(j=k()[u+4*j>>2]=O,O=0;O<D.length;++O)p()[j++]=D.charCodeAt(O);p()[j]=0,y+=D.length+1}),0}function tt(u,w){if(W)return pe(7,1,u,w);var y=et();k()[u>>2]=y.length;var D=0;return y.forEach(j=>D+=j.length+1),k()[w>>2]=D,0}function st(u){return W?pe(8,1,u):52}function at(u,w,y,D){return W?pe(9,1,u,w,y,D):52}function it(u,w,y,D,j){return W?pe(10,1,u,w,y,D,j):70}var pr=[null,[],[]],hr=(u,w)=>{var y=pr[u];w===0||w===10?((u===1?F:r)(Xr(y,0)),y.length=0):y.push(w)};function nt(u,w,y,D){if(W)return pe(11,1,u,w,y,D);for(var j=0,O=0;O<y;O++){var U=k()[w>>2],le=k()[w+4>>2];w+=8;for(var ye=0;ye<le;ye++)hr(u,d()[U+ye]);j+=le}return k()[D>>2]=j,0}var Ye=u=>u%4===0&&(u%100!==0||u%400===0),ft=[31,29,31,30,31,30,31,31,30,31,30,31],ot=[31,28,31,30,31,30,31,31,30,31,30,31],dr=u=>{for(var w=0,y=0;y<u.length;++y){var D=u.charCodeAt(y);127>=D?w++:2047>=D?w+=2:55296<=D&&57343>=D?(w+=4,++y):w+=3}return w},lt=(u,w,y,D)=>{if(!(0<D))return 0;var j=y;D=y+D-1;for(var O=0;O<u.length;++O){var U=u.charCodeAt(O);if(55296<=U&&57343>=U){var le=u.charCodeAt(++O);U=65536+((U&1023)<<10)|le&1023}if(127>=U){if(y>=D)break;w[y++]=U}else{if(2047>=U){if(y+1>=D)break;w[y++]=192|U>>6}else{if(65535>=U){if(y+2>=D)break;w[y++]=224|U>>12}else{if(y+3>=D)break;w[y++]=240|U>>18,w[y++]=128|U>>12&63}w[y++]=128|U>>6&63}w[y++]=128|U&63}}return w[y]=0,y-j};function Vt(u){var w=Array(dr(u)+1);return lt(u,w,0,w.length),w}var Qt=(u,w)=>{p().set(u,w)},Zt=(u,w,y,D)=>{function j(A,te,fe){for(A=typeof A=="number"?A.toString():A||"";A.length<te;)A=fe[0]+A;return A}function O(A,te){return j(A,te,"0")}function U(A,te){function fe(Qe){return 0>Qe?-1:0<Qe?1:0}var Te;return(Te=fe(A.getFullYear()-te.getFullYear()))===0&&(Te=fe(A.getMonth()-te.getMonth()))===0&&(Te=fe(A.getDate()-te.getDate())),Te}function le(A){switch(A.getDay()){case 0:return new Date(A.getFullYear()-1,11,29);case 1:return A;case 2:return new Date(A.getFullYear(),0,3);case 3:return new Date(A.getFullYear(),0,2);case 4:return new Date(A.getFullYear(),0,1);case 5:return new Date(A.getFullYear()-1,11,31);case 6:return new Date(A.getFullYear()-1,11,30)}}function ye(A){var te=A.Z;for(A=new Date(new Date(A.$+1900,0,1).getTime());0<te;){var fe=A.getMonth(),Te=(Ye(A.getFullYear())?ft:ot)[fe];if(te>Te-A.getDate())te-=Te-A.getDate()+1,A.setDate(1),11>fe?A.setMonth(fe+1):(A.setMonth(0),A.setFullYear(A.getFullYear()+1));else{A.setDate(A.getDate()+te);break}}return fe=new Date(A.getFullYear()+1,0,4),te=le(new Date(A.getFullYear(),0,4)),fe=le(fe),0>=U(te,A)?0>=U(fe,A)?A.getFullYear()+1:A.getFullYear():A.getFullYear()-1}var de=k()[D+40>>2];D={ja:b()[D>>2],ia:b()[D+4>>2],aa:b()[D+8>>2],da:b()[D+12>>2],ba:b()[D+16>>2],$:b()[D+20>>2],X:b()[D+24>>2],Z:b()[D+28>>2],ra:b()[D+32>>2],ha:b()[D+36>>2],ka:de?ze(de):""},y=ze(y),de={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var ve in de)y=y.replace(new RegExp(ve,"g"),de[ve]);var xt="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),At="January February March April May June July August September October November December".split(" ");de={"%a":A=>xt[A.X].substring(0,3),"%A":A=>xt[A.X],"%b":A=>At[A.ba].substring(0,3),"%B":A=>At[A.ba],"%C":A=>O((A.$+1900)/100|0,2),"%d":A=>O(A.da,2),"%e":A=>j(A.da,2," "),"%g":A=>ye(A).toString().substring(2),"%G":ye,"%H":A=>O(A.aa,2),"%I":A=>(A=A.aa,A==0?A=12:12<A&&(A-=12),O(A,2)),"%j":A=>{for(var te=0,fe=0;fe<=A.ba-1;te+=(Ye(A.$+1900)?ft:ot)[fe++]);return O(A.da+te,3)},"%m":A=>O(A.ba+1,2),"%M":A=>O(A.ia,2),"%n":()=>`
`,"%p":A=>0<=A.aa&&12>A.aa?"AM":"PM","%S":A=>O(A.ja,2),"%t":()=>"	","%u":A=>A.X||7,"%U":A=>O(Math.floor((A.Z+7-A.X)/7),2),"%V":A=>{var te=Math.floor((A.Z+7-(A.X+6)%7)/7);if(2>=(A.X+371-A.Z-2)%7&&te++,te)te==53&&(fe=(A.X+371-A.Z)%7,fe==4||fe==3&&Ye(A.$)||(te=1));else{te=52;var fe=(A.X+7-A.Z-1)%7;(fe==4||fe==5&&Ye(A.$%400-1))&&te++}return O(te,2)},"%w":A=>A.X,"%W":A=>O(Math.floor((A.Z+7-(A.X+6)%7)/7),2),"%y":A=>(A.$+1900).toString().substring(2),"%Y":A=>A.$+1900,"%z":A=>{A=A.ha;var te=0<=A;return A=Math.abs(A)/60,(te?"+":"-")+("0000"+(A/60*100+A%60)).slice(-4)},"%Z":A=>A.ka,"%%":()=>"%"},y=y.replace(/%%/g,"\0\0");for(ve in de)y.includes(ve)&&(y=y.replace(new RegExp(ve,"g"),de[ve](D)));return y=y.replace(/\0\0/g,"%"),ve=Vt(y),ve.length>w?0:(Qt(ve,u),ve.length-1)},Jt=(u,w,y,D)=>Zt(u,w,y,D),$r=(u,w,y)=>lt(u,d(),w,y);W||Ft();var es=[Br,jr,Lr,Vr,Qr,Zr,rt,tt,st,at,it,nt],ct,ie=function(){function u(y,D){return ie=y.exports,Wr.push(ie.G),zr=ie.J,ir.unshift(ie.A),oe=D,Mr(),ie}var w=Pr();if(Ne++,g.instantiateWasm)try{return g.instantiateWasm(w,u)}catch(y){r(`Module.instantiateWasm callback failed with error: ${y}`),R(y)}return Tr||=g.locateFile?Dr("sf161-70.wasm")?"sf161-70.wasm":g.locateFile?g.locateFile("sf161-70.wasm",Q):Q+"sf161-70.wasm":new URL("sf161-70.wasm",import.meta.url).href,Pt(w,function(y){u(y.instance,y.module)}).catch(R),{}}();g._main=(u,w)=>(g._main=ie.B)(u,w),g.__Z10js_getlinev=u=>(g.__Z10js_getlinev=ie.C)(u);var ut=g._uci=u=>(ut=g._uci=ie.D)(u),gt=g._setNnueBuffer=(u,w,y)=>(gt=g._setNnueBuffer=ie.E)(u,w,y),vt=g._getRecommendedNnue=u=>(vt=g._getRecommendedNnue=ie.F)(u),Oe=()=>(Oe=ie.H)(),pt=g.__emscripten_proxy_main=(u,w)=>(pt=g.__emscripten_proxy_main=ie.I)(u,w),ht=()=>(ht=ie.K)(),mr=(u,w,y,D,j,O)=>(mr=ie.L)(u,w,y,D,j,O),dt=()=>(dt=ie.M)(),$t=u=>($t=ie.N)(u),br=g._malloc=u=>(br=g._malloc=ie.O)(u),mt=(u,w,y,D,j)=>(mt=ie.P)(u,w,y,D,j),wr=u=>(wr=ie.Q)(u),He=u=>(He=ie.R)(u),bt=()=>(bt=ie.S)(),wt=(u,w)=>(wt=ie.T)(u,w),yr=u=>(yr=ie.U)(u),Xe=u=>(Xe=ie.V)(u),yt=()=>(yt=ie.W)();g.UTF8ToString=ze,g.stringToUTF8=$r;var Ve;Fe=function u(){Ve||_t(),Ve||(Fe=u)};function rs(u=[]){var w=pt;Ae+=1,u.unshift("./this.program");var y=u.length,D=Xe(4*(y+1)),j=D;u.forEach(U=>{var le=k(),ye=j>>2,de=dr(U)+1,ve=Xe(de);$r(U,ve,de),le[ye]=ve,j+=4}),k()[j>>2]=0;try{var O=w(y,D);Ke(O,!0)}catch(U){lr(U)}}function _t(){0<Ne||(W?(C(g),W||Pe(ir),startWorker(g)):(Pe(Sr),0<Ne||Ve||(Ve=!0,g.calledRun=!0,ne||(W||Pe(ir),W||Pe(Dt),C(g),rs(ae),W||Pe(Rt)))))}return _t(),c=E,c}})(),xh=globalThis.self?.name==="em-pthread";xh&&qi();function Ki(){return new sr().fen()}const Ah=(m,n)=>{let c=null;return(...p)=>{window.clearTimeout(c),c=window.setTimeout(()=>{m(...p)},n)}},jh=(m,n)=>{let c=null;return(...p)=>{window.clearTimeout(c),c=window.setTimeout(async()=>{await m(...p)},n)}},kh=(m,n)=>{let c=null,p=new Date(0),d=new Date(0);return(...b)=>{const k=new Date-p,x=new Date-d;p=new Date,window.clearInterval(c),Math.max(k,x)>n?(m(...b),d=new Date):c=window.setTimeout(()=>{m(...b),d=new Date},n)}},Wh=m=>{const n=new sr;return n.load(m),n.turn()==="w"?"white":"black"},Uh=(m,n)=>{const c=new sr;return c.load(m),c.move(n),c.fen()},Ch=(m,n)=>{let c=null,p=new Date(0);return(...d)=>{const b=new Date-p;p=new Date,b>n?m(...d):(window.clearInterval(c),c=window.setTimeout(()=>{m(...d)},n))}};function Ih(m){const n=new Map;return Wp.forEach(c=>{const p=m.moves({square:c,verbose:!0});p.length&&n.set(c,p.map(d=>d.to))}),n}function qh(m,n){const c=new sr;c.load(m);const p=Ls(n);return c.move(p),c.history().at(-1)}function Kh(m,n){const c=new sr;c.load(m);const p=Ls(n);c.move(p);const d=c.history({verbose:!0}).at(0)?.lan;return{orig:d?.slice(0,2),dest:d?.slice(2,4)}}function ji(m,n){const c=new sr;c.load(m),c.moveNumber();for(let p of n){const d=Ls(p);c.move(d)}return c.history()}function Ls(m){switch(m){case"e8h8":return"e8g8";case"e8a8":return"e8c8";case"e1h1":return"e1g1";case"e1a1":return"e1c1";default:return m}}function Eh(m){const n=m.split(" ");switch(n[0]){case"info":return n.includes("currmove")?null:Sh(n);default:return null}}function Sh(m){let n=1;const c=m.length,p=m[2];for(;m[n]!="multipv"&&n<c;)n+=1;n+=1;const d=m[n];n+=3;const b=m[n];for(;m[n]!="pv"&&n<c;)n+=1;n+=1;const k=m.slice(n);return{multipv:Number(d),cp:Number(b),depth:Number(p),line:k}}const Gi="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Mh={fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",depth:63,mode:"cloud",cached:!0,lines:[{score:.2,lan:["e2e4","e7e5","g1f3","b8c6","f1b5","g8f6","e1h1","f6e4","f1e1","e4d6"],san:["e4","e5","Nf3","Nc6","Bb5","Nf6","O-O","Nxe4","Re1","Nd6"]},{score:.2,lan:["g1f3","d7d5","d2d4","e7e6","c2c4","g8f6","b1c3","f8b4","c4d5","e6d5"],san:["Nf3","d5","d4","e6","c4","Nf6","Nc3","Bb4","cxd5","exd5"]},{score:.2,lan:["d2d4","g8f6","c2c4","e7e6","g1f3","d7d5","b1c3","f8b4","c4d5","e6d5"],san:["d4","Nf6","c4","e6","Nf3","d5","Nc3","Bb4","cxd5","exd5"]}]};class Dh{tablename;db;status;constructor(n){this.tablename=n,this.status=1}get(n){return new Promise((c,p)=>{this.status!==0&&p("NOT READY");const d=this.db?.transaction(this.tablename,"readonly").objectStore(this.tablename);if(!d){p("UNDEFINED STORE");return}const b=d.get(n);b.onsuccess=k=>{const x=k.target;c(x.result)},b.onerror=()=>{p("DB GET ERROR")}})}ready(){return this.status===0}async size(){return await this.request(n=>n.count())}async getAll(){return await this.request(n=>n.getAll())}async remove(n){return await this.request(c=>c.delete(n))}request(n){return new Promise((c,p)=>{if(!this.ready())return p(`Database <${this.tablename}> is not ready.}`);const d=this.store();if(!d)return p(`Database <${this.tablename}> could not open store.`);const b=n(d);b.onsuccess=()=>{const k=b.result;return k===void 0?p("No result for request."):c(k)},b.onerror=()=>p("Database error.")})}store(){return this.db?.transaction(this.tablename,"readwrite").objectStore(this.tablename)}insert(n,c){return new Promise((p,d)=>{if(this.status!==0){d("NOT READY");return}const b=this.db?.transaction(this.tablename,"readwrite").objectStore(this.tablename);if(!b){d("UNDEFINED STORE");return}const k=b.put(c,n);k.onsuccess=x=>{const g=x.target;if(!g.result){d();return}p(g.result)},k.onerror=()=>{d("DB GET ERROR")}})}load(){return new Promise((n,c)=>{this.status===2&&c(),this.status===0&&n();const p=window.indexedDB.open(this.tablename);p.onerror=d=>{c(d),this.status=2},p.onsuccess=d=>{this.db=d.target.result,this.status=0,n()},p.onupgradeneeded=d=>{this.db=d.target.result,this.db.createObjectStore(this.tablename),this.status=0,n()}})}}class Th{maxsize;name;db;size;constructor(n,c=1e3){this.name=n,this.maxsize=c,this.db=new Dh(n)}load(){return this.db.load()}async get(n){return(await this.db.get(n))?.value}async count(){return this.size||(this.size=await this.db.size()),this.size}async remove(n){console.log("REMOVING"),await this.db.remove(n)}async add(n,c){if(this.size||(this.size=await this.db.size()),this.size>this.maxsize){const d=await this.db.getAll();d.sort((k,x)=>x.datetime.getTime()-k.datetime.getTime());const b=d.slice(0,100);this.size-=100;for(const k of b)await this.db.remove(k.key)}this.size+=1;const p={key:n,value:c,datetime:new Date};await this.db.insert(n,p)}}function js(){return{fen:Ki(),depth:0,mode:"local",cached:!1,lines:[]}}class Rh{subscribers=new Map;engine;last_cloud_request=new Date(0);uci_ready=!1;engine_ready=!0;current_task=null;current_evaluation=js();other_queue=[];board_queue=[];initialize_wait_queue=[];cache;current_position=Ki();sharedWasmMemory=(n,c=32767)=>{let p=4;for(;;)try{return new WebAssembly.Memory({shared:!0,initial:n,maximum:c})}catch(d){if(c<=n||!(d instanceof RangeError))throw d;c=Math.max(n,Math.ceil(c-c/p)),p=p===4?3:4}};async start(){const n=await qi({wasmMemmory:this.sharedWasmMemory(4096),locateFile:p=>`/${p}`}),c=new Set([]);for(let p=0;p<20;p++){const d=n.getRecommendedNnue(p);if(c.has(d))break;c.add(d);const k=await(await fetch(`/${d}`)).arrayBuffer(),x=new Uint8Array(k);try{await n.setNnueBuffer(x,p)}catch(g){console.error(d),console.error(g)}}this.engine=n;try{this.engine?(this.engine.listen=p=>{this.handle_message(p)},this.engine.onError=p=>{console.error(p)},this.engine.uci("uci")):console.error("ENGINE UNDEFINED")}catch(p){console.error(p)}this.cache=new Th("engine-cache"),await this.cache.load()}wait(){return new Promise((n,c)=>{this.uci_ready?n():this.initialize_wait_queue.push(n)})}async evaluate_next_task(){this.current_evaluation=js();let n=this.board_queue.pop();this.board_queue=[],n||(n=this.other_queue.pop()),this.current_task=n??null,n&&(this.current_task=n,this.engine_ready=!1,this.current_evaluation.fen=this.current_task.fen,this.evaluate(n))}async handle_message(n){if(n.includes("ponder")||n.includes("bestmove")){this.current_task?.mode==="other"&&this.emit({...this.current_evaluation}),this.current_task&&this.cache?.add(this.current_task.fen,{...this.current_evaluation,cached:!0}),console.log("ENGINE TASK FINISHED"),this.current_task=null,this.engine_ready=!0,this.engine?.uci("isready");return}if(n.includes("readyok")){console.log("ENGINE READY FOR ENXT TASK"),await this.evaluate_next_task();return}if(n.includes("uciok")){this.engine?.uci("setoption name Threads value 16"),this.engine?.uci("setoption name Hash value 1536"),this.engine?.uci("setoption name MultiPV value 3"),this.engine?.uci("ucinewgame");for(const p of this.initialize_wait_queue)p();this.uci_ready=!0,this.engine?.uci("isready");return}const c=Eh(n);if(c){this.current_evaluation.depth=Math.max(this.current_evaluation.depth,c.depth),console.log(this.current_evaluation.depth);const p=ji(this.current_evaluation.fen,c.line);this.current_evaluation.lines[c.multipv-1]={score:Math.round(c.cp/10)/10,san:p,lan:c.line},this.current_task?.mode==="main"&&this.emit_mainline({...this.current_evaluation})}}emit_mainline=kh(n=>{const c=this.subscribers.get("main");if(c)for(const p of c)p(n)},300);emit(n){const c=this.subscribers.get(n.fen);if(c)for(const p of c)p(n)}enqueue_other=Ah(n=>{this.prepare_task({mode:"other",fen:n,eval_type:"any"})},50);prepare_task(n){if(n.mode==="main"?this.board_queue.push(n):this.other_queue.push(n),!this.uci_ready){console.log(this.uci_ready),console.log("NOT READY");return}if(this.engine_ready){this.engine?.uci("isready");return}this.current_task?.mode==="main"&&(this.engine?.uci("stop"),console.log("STOPPING"))}enqueue_main=Ch(n=>{n===Gi?this.emit_mainline(Mh):(console.log("preparing"),this.prepare_task({mode:"main",fen:n,eval_type:"any"}))},1e3);subscribe_main(n){const c=this.subscribers.get("main")??[];c.push(n),this.subscribers.set("main",c)}subscribe_position(n,c){const p=this.subscribers.get(n)??[];p.push(c),this.subscribers.set(n,p)}wait_for(n){return new Promise((c,p)=>{this.subscribe_position(n,d=>{c(d)}),this.enqueue_other(n)})}async evaluate(n){console.log(`FEN: ${n.fen}`);const c=await this.cache?.get(n.fen);if(c){n.mode==="main"?this.emit_mainline(c):this.emit(c),this.current_task=null,this.engine_ready=!0;return}if(n.eval_type==="any"){const p=await this.cloud_evaluation(n);if(p)return this.cache?.add(p.fen,{...p,cached:!0}),n.mode==="main"?this.emit_mainline(p):this.emit(p)}this.start_local_evaluation(n)}start_local_evaluation(n){this.engine?.uci(`position fen ${n.fen}`),this.engine?.uci("go depth 24")}async cloud_evaluation(n){let c=`https://lichess.org/api/cloud-eval?fen=${encodeURIComponent(n.fen)}&multiPv=3`;if(Date.now()-this.last_cloud_request.getTime()<500)return null;const b=await(await fetch(c)).json();if(!b?.pvs)return null;let k=js();k.depth=b.depth??0,k.fen=b.fen,k.mode="cloud";for(const x of b.pvs.slice(0,3)){let g=x.moves.split(" ");k.lines.push({score:Math.round(x.cp/10)/10,lan:g,san:ji(k.fen,g)})}return this.current_task=null,this.engine_ready=!0,k}}class Wi{data;listeners=[];constructor(n){this.data=n}set(n){this.data={...this.data,...n},console.log("n listeners: "+this.listeners.length);for(const c of this.listeners)c(this.data)}on(n){this.listeners.push(n),n(this.data)}}class Nh{board=new Wi({active:!1,fen:Gi});sidebar=new Wi({active:!1,view:"user",data:void 0})}class Ph{color;mode;listeners;systemTheme;constructor(n="light"){this.color=n,this.listeners=[],this.systemTheme="light",Op(()=>{this.loadSaved(),this.emit()})}emit(){let n=this.color==="system"?this.systemTheme:this.color;for(const c of this.listeners)c(this.mode,n)}onChange(n){this.listeners.push(n),this.emit()}loadSaved(){if(window){const n=window.localStorage.getItem("saknoto-color"),c=window.localStorage.getItem("saknoto-mode");n?this.color=n:this.set_color("neutral-266"),c?this.mode=c:this.set_mode("light")}}set_color(n){this.color=n,window.localStorage.setItem("saknoto-color",this.color),this.emit()}set_mode(n){this.mode=n,window.localStorage.setItem("saknoto-mode",this.mode),this.emit()}get_color(){return this.color}get_mode(){return this.mode}}const zi={userManager:new Ui,openingGraph:new Kp,repertoire:new _h,engine:new Rh,ui:new Nh,themeManager:new Ph},Li=Bp(zi),Gh=()=>Fp(Li),zh=m=>jp(Li.Provider,{value:zi,get children(){return m.children}});export{Th as L,Gi as S,Bh as U,zh as a,Uh as b,Ah as c,jh as d,Mh as e,Kh as f,Wh as g,Up as h,Ls as m,Z as n,qh as p,Ki as s,Ih as t,Gh as u,Oi as w};
