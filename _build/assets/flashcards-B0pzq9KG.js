import{e as v,n as z,k as X,i as u,y as h,j as l,b as p,t as f,S as b,z as Y,o as D}from"./web-DuEVvOp5.js";import{C as Z}from"./chess-lriRiorr.js";import{U as ee,w as te,n as E,u as re,f as ne,S as se,t as oe,p as ie}from"./Context-D0aeQrfF.js";import{B as le}from"./BoardView-BhTIAIwV.js";class ae{done=[];doing=[];todo=[];repertoire;f=ee(te({enable_fuzz:!0}));constructor(e){this.repertoire=e}async refresh(){const e=new Date,n=await this.repertoire.getAll();for(const i of n)new Date(i.card.due)<e&&this.todo.push(i)}setScheduled(e){this.todo=e}getCard(){const e=this.todo.pop();return e&&this.doing.push(e),this.doing.at(0)??null}take(e){const n=["todo","doing","done"];for(const i of n){const r=this[i].findIndex(a=>a.fen===e.fen);if(r!==-1){const[a]=this[i].splice(r,1);return a}}return null}getProgress(){return{todo:this.todo.length,doing:this.doing.length,done:this.done.length}}practiceCard(e,n){const r=this.f.repeat(e.card,e.card.due)[n].card;e.card=r,this.repertoire.updateRep(e,r);const a=new Date;this.take(e),r.due>a?this.done.push(e):n===E.Again?this.doing.unshift(e):this.doing.push(e)}}var ce=f('<div class="flex gap-4 font-bold"><div class=text-red-400></div><div class=text-yellow-500></div><div class=text-blue-400>'),de=f('<div class="mt-1 text-accent-800 dark:text-accent-100">'),ge=f('<div class="p-2 font-medium">hint: <!$><!/>'),ue=f('<div class="bg-accent-200 border dark:bg-accent-800 dark:border-accent-600 border-accent-300 h-auto w-[400px] rounded overflow-hidden p-3"><!$><!/><!$><!/><div class=font-medium></div><!$><!/>'),fe=f('<div class="font-medium lvl-1 p-4 rounded border mt-8">All done for today!'),he=f('<div class="flex-grow flex px-24 gap-4 py-8 items-start justify-center relative dark:bg-accent-950 bg-accent-50"><!$><!/><!$><!/>'),pe=f("<div class=p-2>done for today!");const be=F=>{const e=re();let n=null;const i=new Z,[r,a]=v(null),[x,G]=v(null),[S,y]=v(""),[_,L]=v(0),[w,C]=v(null),k=()=>{if(n){const t=n.getCard();t?(i.load(t?.fen),a({...t})):a(null)}else console.log("NULL")};z(D(r,()=>{R()})),z(D(_,()=>{_()>0&&x()?.set({drawable:{autoShapes:T()}})}));const T=()=>{const t=r();if(_()>0&&t){const s=[];for(const c of t.response){const{orig:A,dest:P}=ne(t.fen,c);s.push({orig:A,dest:P,brush:"green"})}return s}return[]},R=()=>{const t=r()?.fen??se;i.load(t);const s=i.turn()==="w"?"white":"black";x()?.set({fen:t,orientation:s,turnColor:s,movable:{color:s,free:!1,dests:oe(i)},drawable:{autoShapes:_()>0?T():[]}})},I=t=>{const s=r();s&&(s.response.includes(t)?(console.log("correct"),y("correct!"),n?.practiceCard(s,E.Good),C(n?.getProgress()),setTimeout(()=>{y(""),L(0),k()},1e3)):(console.log("incorrect"),y("incorrect"),L(c=>c+1),n?.practiceCard(s,E.Again),C(n?.getProgress()),setTimeout(()=>{k()},1e3)))};return z(D(x,()=>{x()?.set({movable:{events:{after:(t,s)=>{const c=ie(i.fen(),`${t}${s}`);I(c)}}}}),R()})),X(async()=>{e.repertoire.ready()||await e.repertoire.load(),n=new ae(e.repertoire),await n.refresh(),k(),C(n.getProgress()),e.ui.sidebar.set({active:!1})}),(()=>{var t=u(he),s=t.firstChild,[c,A]=h(s.nextSibling),P=c.nextSibling,[M,U]=h(P.nextSibling);return l(t,p(b,{get when(){return r()},get children(){return[p(le,{setApi:G,class:"h-full z-20 relative"}),(()=>{var m=u(ue),V=m.firstChild,[j,q]=h(V.nextSibling),H=j.nextSibling,[B,J]=h(H.nextSibling),$=B.nextSibling,K=$.nextSibling,[O,Q]=h(K.nextSibling);return l(m,p(b,{get when(){return w()},get children(){var o=u(ce),g=o.firstChild,d=g.nextSibling,N=d.nextSibling;return l(g,()=>w().todo),l(d,()=>w().doing),l(N,()=>w().done),o}}),j,q),l(m,p(b,{get when(){return r()},get fallback(){return u(pe)},get children(){var o=u(de);return l(o,()=>r()?.card?.due.toLocaleString()),o}}),B,J),l($,S),l(m,p(b,{get when(){return _()>1},get children(){var o=u(ge),g=o.firstChild,d=g.nextSibling,[N,W]=h(d.nextSibling);return l(o,()=>r()?.response.toString(),N,W),o}}),O,Q),Y(o=>{var g=S().length>0,d=S()==="incorrect"?"salmon":"mediumseagreen";return g!==o.e&&$.classList.toggle("p-2",o.e=g),d!==o.t&&((o.t=d)!=null?$.style.setProperty("color",d):$.style.removeProperty("color")),o},{e:void 0,t:void 0}),m})()]}}),c,A),l(t,p(b,{get when(){return!r()},get children(){return u(fe)}}),M,U),t})()};export{be as default};
