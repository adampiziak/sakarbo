const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ClientOnlyGraph-CIdXmOrN.js","assets/web-DuEVvOp5.js","assets/Context-D0aeQrfF.js","assets/chess-lriRiorr.js"])))=>i.map(i=>d[i]);
import{_ as F}from"./preload-helper-N37mDRhq.js";import{h as A,e as _,n as M,i as $,j as w,b as d,y as C,r as P,F as T,t as k,k as G,E as j,S as E}from"./web-DuEVvOp5.js";import{F as z}from"./FilterOptionsComponent-xt4HpjGg.js";import{u as O,S as D,b as L,g as B,c as H}from"./Context-D0aeQrfF.js";import{c as R}from"./clientOnly-DsafAS6x.js";import{B as J}from"./BoardImage-Cl8ODxES.js";import"./QJIB6BDF-BszDVaDs.js";import"./JNCCF6MP-yLk7z_SF.js";import"./UKTBL2JL-CnBKWN1M.js";import"./FN6EICGO-iZF3THgN.js";import"./index-HbBCBvHV.js";import"./chess-lriRiorr.js";import"./BoardView-BhTIAIwV.js";var V=k('<div class="flex flex-col grow shrink min-h-0 overflow-auto">'),q=k('<div class="flex border-b dark:border-accent-900 dark:text-accent-50 hover:bg-accent-500"><!$><!/><div class=px-2><div class=opacity-60></div><div>games: <!$><!/></div><div>elo Î”: <!$><!/>');const W=n=>{const g=O(),[s,h]=_([]);return M(()=>{const r=n.options;let t=[];const l=new Map(n.repertoire.map(e=>[e.fen,e]));if(r.color==="white"||r.color==="both"){const e=[...n.split.whitewhite.values()].map(o=>({color:"white",elo_delta:(o.result.white-o.result.black)*6,...o}));t.push(...e)}if(r.color==="black"||r.color==="both"){const e=[...n.split.blackblack.values()].map(o=>({color:"black",elo_delta:(o.result.black-o.result.white)*6,...o}));t.push(...e)}r.sortby=="games"&&t.sort((e,o)=>o.count-e.count),r.sortby==="elo delta"&&t.sort((e,o)=>e.elo_delta-o.elo_delta),r.sortby==="winrate"&&t.sort((e,o)=>e.result.white/e.result.black-o.result.white/o.result.black),r.repertoire==="exclude repertoire"?t=t.filter(o=>!l.has(o.fen)):r.repertoire==="repertoire only"&&(t=t.filter(o=>l.has(o.fen))),t=t.filter(e=>e.count>2),h(t.slice(0,100))}),(()=>{var r=$(V);return w(r,d(T,{get each(){return s()},children:(t,l)=>(()=>{var a=$(q),e=a.firstChild,[o,i]=C(e.nextSibling),u=o.nextSibling,m=u.firstChild,c=m.nextSibling,p=c.firstChild,b=p.nextSibling,[v,S]=C(b.nextSibling),x=c.nextSibling,f=x.firstChild,y=f.nextSibling,[I,N]=C(y.nextSibling);return a.$$click=()=>g.ui.sidebar.set({active:!0,view:"board",data:t.fen}),w(a,d(J,{get fen(){return t.fen},class:"w-48 h-48"}),o,i),w(m,()=>t.fen),w(c,()=>t.count,v,S),w(x,()=>t.elo_delta,I,N),P(),a})()})),r})()};A(["click"]);var K=k('<div class="shrink grow min-w-0">');const Q=R(()=>F(()=>import("./ClientOnlyGraph-CIdXmOrN.js"),__vite__mapDeps([0,1,2,3]))),U=n=>{let g=O(),s,[h,r]=_("light"),[t,l]=_([0,0]),[a,e]=_({nodes:[],links:[]});const o=H(()=>{console.log("update"),l([s?.offsetWidth??0,s?.offsetHeight??0])},100);return M(()=>{e(X(n.split,n.repertoire,n.options.color,h()))}),G(()=>{g.themeManager.onChange((i,u)=>{r(i)}),s&&new ResizeObserver(()=>{o()}).observe(s)}),(()=>{var i=$(K),u=s;return typeof u=="function"?j(u,i):s=i,w(i,d(Q,{get data(){return a()},get size(){return t()}})),i})()},X=(n,g,s,h)=>{const r=new Map,t=[],l=[],a=new Set;s=s==="both"?"white":s;for(const p of g)a.add(p.fen);let e=0;const i=h==="light"?"#333333":"#CCCCCC",u=`${s}white`;console.log(u),console.log(n);const m=n[u].get(D);if(!m)return{nodes:[],links:[]};let c=[m];for(r.set(c[0].fen,{id:c[0].fen,count:c[0].count,color:i});e<500;){c.sort((b,v)=>v?.count-b?.count);const p=c.shift();if(!p)break;for(const b of Object.values(p.moves)){const v=L(p.fen,b.uci),S=B(v),x=s+S,f=n[x].get(v);if(f&&f.count>1){const y=a.has(f.fen)?"#304FFE":i;r.set(f.fen,{id:f?.fen,val:f?.count,color:y}),l.push({source:p.fen,target:f.fen,value:b.count,color:i}),c.push(f)}}e+=1}for(const p of r.values())t.push(p);return{nodes:t,links:l}};var Y=k('<div class="flex grow shrink min-h-0 min-w-0 justify-start w-screen bg-accent-50 dark:bg-accent-950">'),Z=k("<div>loading...");R(()=>F(()=>import("./ClientOnlyGraph-CIdXmOrN.js"),__vite__mapDeps([0,1,2,3])));function de(){const n=O(),[g,s]=_({whitewhite:new Map,whiteblack:new Map,blackblack:new Map,blackwhite:new Map}),[h,r]=_([]),t=_({color:"both",repertoire:"no filter",sortby:"games",view:"list"}),[l,a]=t,[e,o]=_(!1);return G(async()=>{await n.openingGraph.load_wait(),await n.repertoire.load();const i=await n.openingGraph.getAllSplit(),u=await n.repertoire.getAll();s(i),r(u);const m=window.localStorage.getItem("explore_options");if(m){const c=JSON.parse(m);a(c)}o(!0)}),M(()=>{e()&&window.localStorage.setItem("explore_options",JSON.stringify(l()))}),(()=>{var i=$(Y);return w(i,d(E,{get when(){return e()},get fallback(){return $(Z)},get children(){return[d(z,{options:t}),d(E,{get when(){return l().view==="list"},get children(){return d(W,{get options(){return l()},get split(){return g()},get repertoire(){return h()}})}}),d(E,{get when(){return l().view==="graph"},get children(){return d(U,{get options(){return l()},get split(){return g()},get repertoire(){return h()}})}})]}})),i})()}export{de as default};
