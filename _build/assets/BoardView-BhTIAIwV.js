import{e as ln,k as an,i as sn,z as dn,C as we,t as un,E as ye}from"./web-DuEVvOp5.js";import{c as fn}from"./Context-D0aeQrfF.js";const pn=["white","black"],G=["a","b","c","d","e","f","g","h"],X=["1","2","3","4","5","6","7","8"],hn=[...X].reverse(),de=Array.prototype.concat(...G.map(e=>X.map(n=>e+n))),C=e=>de[8*e[0]+e[1]],m=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],qe=de.map(m);function gn(e){let n;const o=()=>(n===void 0&&(n=e()),n);return o.clear=()=>{n=void 0},o}const mn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const n=performance.now()-e;return e=void 0,n}}},ue=e=>e==="white"?"black":"white",I=(e,n)=>{const o=e[0]-n[0],r=e[1]-n[1];return o*o+r*r},ce=(e,n)=>e.role===n.role&&e.color===n.color,F=e=>(n,o)=>[(o?n[0]:7-n[0])*e.width/8,(o?7-n[1]:n[1])*e.height/8],q=(e,n)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px)`},Oe=(e,n,o=1)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px) scale(${o})`},fe=(e,n)=>{e.style.visibility=n?"visible":"hidden"},H=e=>{var n;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((n=e.targetTouches)===null||n===void 0)&&n[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},_e=e=>e.button===2,_=(e,n)=>{const o=document.createElement(e);return n&&(o.className=n),o};function Ee(e,n,o){const r=m(e);return n||(r[0]=7-r[0],r[1]=7-r[1]),[o.left+o.width*r[0]/8+o.width/16,o.top+o.height*(7-r[1])/8+o.height/16]}const W=(e,n)=>Math.abs(e-n),vn=e=>(n,o,r,i)=>W(n,r)<2&&(e==="white"?i===o+1||o<=1&&i===o+2&&n===r:i===o-1||o>=6&&i===o-2&&n===r),Ke=(e,n,o,r)=>{const i=W(e,o),t=W(n,r);return i===1&&t===2||i===2&&t===1},Ne=(e,n,o,r)=>W(e,o)===W(n,r),Te=(e,n,o,r)=>e===o||n===r,We=(e,n,o,r)=>Ne(e,n,o,r)||Te(e,n,o,r),bn=(e,n,o)=>(r,i,t,c)=>W(r,t)<2&&W(i,c)<2||o&&i===c&&i===(e==="white"?0:7)&&(r===4&&(t===2&&n.includes(0)||t===6&&n.includes(7))||n.includes(t));function wn(e,n){const o=n==="white"?"1":"8",r=[];for(const[i,t]of e)i[1]===o&&t.color===n&&t.role==="rook"&&r.push(m(i)[0]);return r}function He(e,n,o){const r=e.get(n);if(!r)return[];const i=m(n),t=r.role,c=t==="pawn"?vn(r.color):t==="knight"?Ke:t==="bishop"?Ne:t==="rook"?Te:t==="queen"?We:bn(r.color,wn(e,r.color),o);return qe.filter(a=>(i[0]!==a[0]||i[1]!==a[1])&&c(i[0],i[1],a[0],a[1])).map(C)}function y(e,...n){e&&setTimeout(()=>e(...n),1)}function yn(e){e.orientation=ue(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function kn(e,n){for(const[o,r]of n)r?e.pieces.set(o,r):e.pieces.delete(o)}function Pn(e,n){if(e.check=void 0,n===!0&&(n=e.turnColor),n)for(const[o,r]of e.pieces)r.role==="king"&&r.color===n&&(e.check=o)}function Cn(e,n,o,r){N(e),e.premovable.current=[n,o],y(e.premovable.events.set,n,o,r)}function K(e){e.premovable.current&&(e.premovable.current=void 0,y(e.premovable.events.unset))}function Sn(e,n,o){K(e),e.predroppable.current={role:n,key:o},y(e.predroppable.events.set,n,o)}function N(e){const n=e.predroppable;n.current&&(n.current=void 0,y(n.events.unset))}function Mn(e,n,o){if(!e.autoCastle)return!1;const r=e.pieces.get(n);if(!r||r.role!=="king")return!1;const i=m(n),t=m(o);if(i[1]!==0&&i[1]!==7||i[1]!==t[1])return!1;i[0]===4&&!e.pieces.has(o)&&(t[0]===6?o=C([7,t[1]]):t[0]===2&&(o=C([0,t[1]])));const c=e.pieces.get(o);return!c||c.color!==r.color||c.role!=="rook"?!1:(e.pieces.delete(n),e.pieces.delete(o),i[0]<t[0]?(e.pieces.set(C([6,t[1]]),r),e.pieces.set(C([5,t[1]]),c)):(e.pieces.set(C([2,t[1]]),r),e.pieces.set(C([3,t[1]]),c)),!0)}function Re(e,n,o){const r=e.pieces.get(n),i=e.pieces.get(o);if(n===o||!r)return!1;const t=i&&i.color!==r.color?i:void 0;return o===e.selected&&S(e),y(e.events.move,n,o,t),Mn(e,n,o)||(e.pieces.set(o,r),e.pieces.delete(n)),e.lastMove=[n,o],e.check=void 0,y(e.events.change),t||!0}function pe(e,n,o,r){if(e.pieces.has(o))if(r)e.pieces.delete(o);else return!1;return y(e.events.dropNewPiece,n,o),e.pieces.set(o,n),e.lastMove=[o],e.check=void 0,y(e.events.change),e.movable.dests=void 0,e.turnColor=ue(e.turnColor),!0}function ze(e,n,o){const r=Re(e,n,o);return r&&(e.movable.dests=void 0,e.turnColor=ue(e.turnColor),e.animation.current=void 0),r}function Le(e,n,o){if(he(e,n,o)){const r=ze(e,n,o);if(r){const i=e.hold.stop();S(e);const t={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(t.captured=r),y(e.movable.events.after,n,o,t),!0}}else if(An(e,n,o))return Cn(e,n,o,{ctrlKey:e.stats.ctrlKey}),S(e),!0;return S(e),!1}function Be(e,n,o,r){const i=e.pieces.get(n);i&&(xn(e,n,o)||r)?(e.pieces.delete(n),pe(e,i,o,r),y(e.movable.events.afterNewPiece,i.role,o,{premove:!1,predrop:!1})):i&&$n(e,n,o)?Sn(e,i.role,o):(K(e),N(e)),e.pieces.delete(n),S(e)}function le(e,n,o){if(y(e.events.select,n),e.selected){if(e.selected===n&&!e.draggable.enabled){S(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==n&&Le(e,e.selected,n)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Ie(e,n)||ge(e,n))&&(je(e,n),e.hold.start())}function je(e,n){e.selected=n,ge(e,n)?e.premovable.customDests||(e.premovable.dests=He(e.pieces,n,e.premovable.castle)):e.premovable.dests=void 0}function S(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Ie(e,n){const o=e.pieces.get(n);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}const he=(e,n,o)=>{var r,i;return n!==o&&Ie(e,n)&&(e.movable.free||!!(!((i=(r=e.movable.dests)===null||r===void 0?void 0:r.get(n))===null||i===void 0)&&i.includes(o)))};function xn(e,n,o){const r=e.pieces.get(n);return!!r&&(n===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function ge(e,n){const o=e.pieces.get(n);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function An(e,n,o){var r,i;const t=(i=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(n))!==null&&i!==void 0?i:He(e.pieces,n,e.premovable.castle);return n!==o&&ge(e,n)&&t.includes(o)}function $n(e,n,o){const r=e.pieces.get(n),i=e.pieces.get(o);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function Dn(e,n){const o=e.pieces.get(n);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function qn(e){const n=e.premovable.current;if(!n)return!1;const o=n[0],r=n[1];let i=!1;if(he(e,o,r)){const t=ze(e,o,r);if(t){const c={premove:!0};t!==!0&&(c.captured=t),y(e.movable.events.after,o,r,c),i=!0}}return K(e),i}function On(e,n){const o=e.predroppable.current;let r=!1;if(!o)return!1;if(n(o)){const i={role:o.role,color:e.movable.color};pe(e,i,o.key)&&(y(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),r=!0)}return N(e),r}function me(e){K(e),N(e),S(e)}function ke(e){e.movable.color=e.movable.dests=e.animation.current=void 0,me(e)}function R(e,n,o){let r=Math.floor(8*(e[0]-o.left)/o.width);n||(r=7-r);let i=7-Math.floor(8*(e[1]-o.top)/o.height);return n||(i=7-i),r>=0&&r<8&&i>=0&&i<8?C([r,i]):void 0}function _n(e,n,o,r){const i=m(e),t=qe.filter(l=>We(i[0],i[1],l[0],l[1])||Ke(i[0],i[1],l[0],l[1])),a=t.map(l=>Ee(C(l),o,r)).map(l=>I(n,l)),[,s]=a.reduce((l,u,d)=>l[0]<u?l:[u,d],[a[0],0]);return C(t[s])}const k=e=>e.orientation==="white",Fe="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",En={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Kn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Ve(e){e==="start"&&(e=Fe);const n=new Map;let o=7,r=0;for(const i of e)switch(i){case" ":case"[":return n;case"/":if(--o,o<0)return n;r=0;break;case"~":{const t=n.get(C([r-1,o]));t&&(t.promoted=!0);break}default:{const t=i.charCodeAt(0);if(t<57)r+=t-48;else{const c=i.toLowerCase();n.set(C([r,o]),{role:En[c],color:i===c?"black":"white"}),++r}}}return n}function Nn(e){return hn.map(n=>G.map(o=>{const r=e.get(o+n);if(r){let i=Kn[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,n=>n.length.toString())}function Ze(e,n){n.animation&&(ve(e.animation,n.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Ge(e,n){var o,r,i;if(!((o=n.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((r=n.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),ve(e,n),n.fen&&(e.pieces=Ve(n.fen),e.drawable.shapes=((i=n.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in n&&Pn(e,n.check||!1),"lastMove"in n&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&je(e,e.selected),Ze(e,n),!e.movable.rookCastle&&e.movable.dests){const t=e.movable.color==="white"?"1":"8",c="e"+t,a=e.movable.dests.get(c),s=e.pieces.get(c);if(!a||!s||s.role!=="king")return;e.movable.dests.set(c,a.filter(l=>!(l==="a"+t&&a.includes("c"+t))&&!(l==="h"+t&&a.includes("g"+t))))}}function ve(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&Pe(e[o])&&Pe(n[o])?ve(e[o],n[o]):e[o]=n[o])}function Pe(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return n===Object.prototype||n===null}const T=(e,n)=>n.animation.enabled?Hn(e,n):E(e,n);function E(e,n){const o=e(n);return n.dom.redraw(),o}const oe=(e,n)=>({key:e,pos:m(e),piece:n}),Tn=(e,n)=>n.sort((o,r)=>I(e.pos,o.pos)-I(e.pos,r.pos))[0];function Wn(e,n){const o=new Map,r=[],i=new Map,t=[],c=[],a=new Map;let s,l,u;for(const[d,g]of e)a.set(d,oe(d,g));for(const d of de)s=n.pieces.get(d),l=a.get(d),s?l?ce(s,l.piece)||(t.push(l),c.push(oe(d,s))):c.push(oe(d,s)):l&&t.push(l);for(const d of c)l=Tn(d,t.filter(g=>ce(d.piece,g.piece))),l&&(u=[l.pos[0]-d.pos[0],l.pos[1]-d.pos[1]],o.set(d.key,u.concat(u)),r.push(l.key));for(const d of t)r.includes(d.key)||i.set(d.key,d.piece);return{anims:o,fadings:i}}function Xe(e,n){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(n-o.start)*o.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Rn(r);for(const t of o.plan.anims.values())t[2]=t[0]*i,t[3]=t[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((t=performance.now())=>Xe(e,t))}}function Hn(e,n){const o=new Map(n.pieces),r=e(n),i=Wn(o,n);if(i.anims.size||i.fadings.size){const t=n.animation.current&&n.animation.current.start;n.animation.current={start:performance.now(),frequency:1/n.animation.duration,plan:i},t||Xe(n,performance.now())}else n.dom.redraw();return r}const Rn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,zn=["green","red","blue","yellow"];function Ln(e,n){if(n.touches&&n.touches.length>1)return;n.stopPropagation(),n.preventDefault(),n.ctrlKey?S(e):me(e);const o=H(n),r=R(o,k(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:o,brush:Fn(n),snapToValidMove:e.drawable.defaultSnapToValidMove},Ye(e))}function Ye(e){requestAnimationFrame(()=>{const n=e.drawable.current;if(n){const o=R(n.pos,k(e),e.dom.bounds());o||(n.snapToValidMove=!1);const r=n.snapToValidMove?_n(n.orig,n.pos,k(e),e.dom.bounds()):o;r!==n.mouseSq&&(n.mouseSq=r,n.dest=r!==n.orig?r:void 0,e.dom.redrawNow()),Ye(e)}})}function Bn(e,n){e.drawable.current&&(e.drawable.current.pos=H(n))}function jn(e){const n=e.drawable.current;n&&(n.mouseSq&&Vn(e.drawable,n),Ue(e))}function Ue(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function In(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Qe(e.drawable))}function Fn(e){var n;const o=(e.shiftKey||e.ctrlKey)&&_e(e),r=e.altKey||e.metaKey||((n=e.getModifierState)===null||n===void 0?void 0:n.call(e,"AltGraph"));return zn[(o?1:0)+(r?2:0)]}function Vn(e,n){const o=i=>i.orig===n.orig&&i.dest===n.dest,r=e.shapes.find(o);r&&(e.shapes=e.shapes.filter(i=>!o(i))),(!r||r.brush!==n.brush)&&e.shapes.push({orig:n.orig,dest:n.dest,brush:n.brush}),Qe(e)}function Qe(e){e.onChange&&e.onChange(e.shapes)}function Zn(e,n){if(!(e.trustAllEvents||n.isTrusted)||n.buttons!==void 0&&n.buttons>1||n.touches&&n.touches.length>1)return;const o=e.dom.bounds(),r=H(n),i=R(r,k(e),o);if(!i)return;const t=e.pieces.get(i),c=e.selected;if(!c&&e.drawable.enabled&&(e.drawable.eraseOnClick||!t||t.color!==e.turnColor)&&In(e),n.cancelable!==!1&&(!n.touches||e.blockTouchScroll||t||c||Gn(e,r)))n.preventDefault();else if(n.touches)return;const a=!!e.premovable.current,s=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&he(e,e.selected,i)?T(d=>le(d,i),e):le(e,i);const l=e.selected===i,u=en(e,i);if(t&&u&&l&&Dn(e,i)){e.draggable.current={orig:i,piece:t,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:c,originTarget:n.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const d=e.dom.elements.ghost;d&&(d.className=`ghost ${t.color} ${t.role}`,q(d,F(o)(m(i),k(e))),fe(d,!0)),be(e)}else a&&K(e),s&&N(e);e.dom.redraw()}function Gn(e,n){const o=k(e),r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const t of e.pieces.keys()){const c=Ee(t,o,r);if(I(c,n)<=i)return!0}return!1}function Xn(e,n,o,r){const i="a0";e.pieces.set(i,n),e.dom.redraw();const t=H(o);e.draggable.current={orig:i,piece:n,origPos:t,pos:t,started:!0,element:()=>en(e,i),originTarget:o.target,newPiece:!0,force:!!r,keyHasChanged:!1},be(e)}function be(e){requestAnimationFrame(()=>{var n;const o=e.draggable.current;if(!o)return;!((n=e.animation.current)===null||n===void 0)&&n.plan.anims.has(o.orig)&&(e.animation.current=void 0);const r=e.pieces.get(o.orig);if(!r||!ce(r,o.piece))Y(e);else if(!o.started&&I(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const t=o.element();if(!t)return;t.cgDragging=!0,t.classList.add("dragging"),o.element=t}const i=e.dom.bounds();q(o.element,[o.pos[0]-i.left-i.width/16,o.pos[1]-i.top-i.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==R(o.pos,k(e),i))}be(e)})}function Yn(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.pos=H(n))}function Un(e,n){const o=e.draggable.current;if(!o)return;if(n.type==="touchend"&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchend"&&o.originTarget!==n.target&&!o.newPiece){e.draggable.current=void 0;return}K(e),N(e);const r=H(n)||o.pos,i=R(r,k(e),e.dom.bounds());i&&o.started&&o.orig!==i?o.newPiece?Be(e,o.orig,i,o.force):(e.stats.ctrlKey=n.ctrlKey,Le(e,o.orig,i)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(o.orig),y(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===i||!i)?S(e):e.selectable.enabled||S(e),Je(e),e.draggable.current=void 0,e.dom.redraw()}function Y(e){const n=e.draggable.current;n&&(n.newPiece&&e.pieces.delete(n.orig),e.draggable.current=void 0,S(e),Je(e),e.dom.redraw())}function Je(e){const n=e.dom.elements;n.ghost&&fe(n.ghost,!1)}function en(e,n){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===n&&o.tagName==="PIECE")return o;o=o.nextSibling}}function Qn(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(()=>{Ce(e,2),setTimeout(()=>Ce(e,void 0),120)},120)}function Ce(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}function Jn(e,n){function o(){yn(e),n()}return{set(r){r.orientation&&r.orientation!==e.orientation&&o(),Ze(e,r),(r.fen?T:E)(i=>Ge(i,r),e)},state:e,getFen:()=>Nn(e.pieces),toggleOrientation:o,setPieces(r){T(i=>kn(i,r),e)},selectSquare(r,i){r?T(t=>le(t,r,i),e):e.selected&&(S(e),e.dom.redraw())},move(r,i){T(t=>Re(t,r,i),e)},newPiece(r,i){T(t=>pe(t,r,i),e)},playPremove(){if(e.premovable.current){if(T(qn,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=On(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){E(K,e)},cancelPredrop(){E(N,e)},cancelMove(){E(r=>{me(r),Y(r)},e)},stop(){E(r=>{ke(r),Y(r)},e)},explode(r){Qn(e,r)},setAutoShapes(r){E(i=>i.drawable.autoShapes=r,e)},setShapes(r){E(i=>i.drawable.shapes=r,e)},getKeyAtDomPos(r){return R(r,k(e),e.dom.bounds())},redrawAll:n,dragNewPiece(r,i,t){Xn(e,r,i,t)},destroy(){ke(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function eo(){return{pieces:Ve(Fe),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:mn()}}const Se={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function no(){const e=b("defs"),n=w(b("filter"),{id:"cg-filter-blur"});return n.appendChild(w(b("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(n),e}function oo(e,n,o){var r;const i=e.drawable,t=i.current,c=t&&t.mouseSq?t:void 0,a=new Map,s=e.dom.bounds(),l=i.autoShapes.filter(p=>!p.piece);for(const p of i.shapes.concat(l).concat(c?[c]:[])){if(!p.dest)continue;const h=(r=a.get(p.dest))!==null&&r!==void 0?r:new Set,f=J(Q(m(p.orig),e.orientation),s),x=J(Q(m(p.dest),e.orientation),s);h.add(se(f,x)),a.set(p.dest,h)}const u=i.shapes.concat(l).map(p=>({shape:p,current:!1,hash:Me(p,ae(p.dest,a),!1,s)}));c&&u.push({shape:c,current:!0,hash:Me(c,ae(c.dest,a),!0,s)});const d=u.map(p=>p.hash).join(";");if(d===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=d;const g=n.querySelector("defs");ro(i,u,g),io(u,n.querySelector("g"),o.querySelector("g"),p=>lo(e,p,i.brushes,a,s))}function ro(e,n,o){var r;const i=new Map;let t;for(const s of n.filter(l=>l.shape.dest&&l.shape.brush))t=nn(e.brushes[s.shape.brush],s.shape.modifiers),!((r=s.shape.modifiers)===null||r===void 0)&&r.hilite&&i.set(U(t).key,U(t)),i.set(t.key,t);const c=new Set;let a=o.firstElementChild;for(;a;)c.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[s,l]of i.entries())c.has(s)||o.appendChild(uo(l))}function io(e,n,o,r){const i=new Map;for(const t of e)i.set(t.hash,!1);for(const t of[n,o]){const c=[];let a=t.firstElementChild,s;for(;a;)s=a.getAttribute("cgHash"),i.has(s)?i.set(s,!0):c.push(a),a=a.nextElementSibling;for(const l of c)t.removeChild(l)}for(const t of e.filter(c=>!i.get(c.hash)))for(const c of r(t))c.isCustom?o.appendChild(c.el):n.appendChild(c.el)}function Me({orig:e,dest:n,brush:o,piece:r,modifiers:i,customSvg:t,label:c},a,s,l){var u,d;return[l.width,l.height,s,e,n,o,a&&"-",r&&to(r),i&&co(i),t&&`custom-${xe(t.html)},${(d=(u=t.center)===null||u===void 0?void 0:u[0])!==null&&d!==void 0?d:"o"}`,c&&`label-${xe(c.text)}`].filter(g=>g).join(",")}function to(e){return[e.color,e.role,e.scale].filter(n=>n).join(",")}function co(e){return[e.lineWidth,e.hilite&&"*"].filter(n=>n).join(",")}function xe(e){let n=0;for(let o=0;o<e.length;o++)n=(n<<5)-n+e.charCodeAt(o)>>>0;return n.toString()}function lo(e,{shape:n,current:o,hash:r},i,t,c){var a,s;const l=J(Q(m(n.orig),e.orientation),c),u=n.dest?J(Q(m(n.dest),e.orientation),c):l,d=n.brush&&nn(i[n.brush],n.modifiers),g=t.get(n.dest),p=[];if(d){const h=w(b("g"),{cgHash:r});p.push({el:h}),l[0]!==u[0]||l[1]!==u[1]?h.appendChild(so(n,d,l,u,o,ae(n.dest,t))):h.appendChild(ao(i[n.brush],l,o,c))}if(n.label){const h=n.label;(a=h.fill)!==null&&a!==void 0||(h.fill=n.brush&&i[n.brush].color);const f=n.brush?void 0:"tr";p.push({el:fo(h,r,l,u,g,f),isCustom:!0})}if(n.customSvg){const h=(s=n.customSvg.center)!==null&&s!==void 0?s:"orig",[f,x]=h==="label"?rn(l,u,g).map(P=>P-.5):h==="dest"?u:l,M=w(b("g"),{transform:`translate(${f},${x})`,cgHash:r});M.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${n.customSvg.html}</svg>`,p.push({el:M,isCustom:!0})}return p}function ao(e,n,o,r){const i=po(),t=(r.width+r.height)/(4*Math.max(r.width,r.height));return w(b("circle"),{stroke:e.color,"stroke-width":i[o?0:1],fill:"none",opacity:on(e,o),cx:n[0],cy:n[1],r:t-i[1]/2})}function U(e){return["#ffffff","#fff","white"].includes(e.color)?Se.hilitePrimary:Se.hiliteWhite}function so(e,n,o,r,i,t){var c;function a(u){var d;const g=go(t&&!i),p=r[0]-o[0],h=r[1]-o[1],f=Math.atan2(h,p),x=Math.cos(f)*g,M=Math.sin(f)*g;return w(b("line"),{stroke:u?U(n).color:n.color,"stroke-width":ho(n,i)+(u?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${u?U(n).key:n.key})`,opacity:!((d=e.modifiers)===null||d===void 0)&&d.hilite?1:on(n,i),x1:o[0],y1:o[1],x2:r[0]-x,y2:r[1]-M})}if(!(!((c=e.modifiers)===null||c===void 0)&&c.hilite))return a(!1);const s=b("g"),l=w(b("g"),{filter:"url(#cg-filter-blur)"});return l.appendChild(mo(o,r)),l.appendChild(a(!0)),s.appendChild(l),s.appendChild(a(!1)),s}function uo(e){const n=w(b("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return n.appendChild(w(b("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function fo(e,n,o,r,i,t){var c;const s=.4*.75**e.text.length,l=rn(o,r,i),u=t==="tr"?.4:0,d=w(b("g"),{transform:`translate(${l[0]+u},${l[1]-u})`,cgHash:n});d.appendChild(w(b("circle"),{r:.4/2,"fill-opacity":t?1:.8,"stroke-opacity":t?1:.7,"stroke-width":.03,fill:(c=e.fill)!==null&&c!==void 0?c:"#666",stroke:"white"}));const g=w(b("text"),{"font-size":s,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return g.innerHTML=e.text,d.appendChild(g),d}function Q(e,n){return n==="white"?e:[7-e[0],7-e[1]]}function ae(e,n){return(e&&n.has(e)&&n.get(e).size>1)===!0}function b(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function w(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.setAttribute(o,n[o]);return e}function nn(e,n){return n?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth),key:[e.key,n.lineWidth].filter(o=>o).join("")}:e}function po(){return[3/64,4/64]}function ho(e,n){return(e.lineWidth||10)*(n?.85:1)/64}function on(e,n){return(e.opacity||1)*(n?.9:1)}function go(e){return(e?20:10)/64}function J(e,n){const o=Math.min(1,n.width/n.height),r=Math.min(1,n.height/n.width);return[(e[0]-3.5)*o,(3.5-e[1])*r]}function mo(e,n){const o={from:[Math.floor(Math.min(e[0],n[0])),Math.floor(Math.min(e[1],n[1]))],to:[Math.ceil(Math.max(e[0],n[0])),Math.ceil(Math.max(e[1],n[1]))]};return w(b("rect"),{x:o.from[0],y:o.from[1],width:o.to[0]-o.from[0],height:o.to[1]-o.from[1],fill:"none",stroke:"none"})}function se(e,n,o=!0){const r=Math.atan2(n[1]-e[1],n[0]-e[0])+Math.PI;return o?(Math.round(r*8/Math.PI)+16)%16:r}function vo(e,n){return Math.sqrt([e[0]-n[0],e[1]-n[1]].reduce((o,r)=>o+r*r,0))}function rn(e,n,o){let r=vo(e,n);const i=se(e,n,!1);if(o&&(r-=33/64,o.size>1)){r-=10/64;const t=se(e,n);(o.has((t+1)%16)||o.has((t+15)%16))&&t&1&&(r-=.4)}return[e[0]-Math.cos(i)*r,e[1]-Math.sin(i)*r].map(t=>t+.5)}function bo(e,n){e.innerHTML="",e.classList.add("cg-wrap");for(const s of pn)e.classList.toggle("orientation-"+s,n.orientation===s);e.classList.toggle("manipulable",!n.viewOnly);const o=_("cg-container");e.appendChild(o);const r=_("cg-board");o.appendChild(r);let i,t,c;if(n.drawable.visible&&(i=w(b("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(no()),i.appendChild(b("g")),t=w(b("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),t.appendChild(b("g")),c=_("cg-auto-pieces"),o.appendChild(i),o.appendChild(t),o.appendChild(c)),n.coordinates){const s=n.orientation==="black"?" black":"",l=n.ranksPosition==="left"?" left":"";if(n.coordinatesOnSquares){const u=n.orientation==="white"?d=>d+1:d=>8-d;G.forEach((d,g)=>o.appendChild(re(X.map(p=>d+p),"squares rank"+u(g)+s+l)))}else o.appendChild(re(X,"ranks"+s+l)),o.appendChild(re(G,"files"+s))}let a;return n.draggable.enabled&&n.draggable.showGhost&&(a=_("piece","ghost"),fe(a,!1),o.appendChild(a)),{board:r,container:o,wrap:e,ghost:a,svg:i,customSvg:t,autoPieces:c}}function re(e,n){const o=_("coords",n);let r;for(const i of e)r=_("coord"),r.textContent=i,o.appendChild(r);return o}function wo(e,n){if(!e.dropmode.active)return;K(e),N(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const r=H(n),i=r&&R(r,k(e),e.dom.bounds());i&&Be(e,"a0",i)}e.dom.redraw()}function yo(e,n){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(n).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=Po(e);o.addEventListener("touchstart",r,{passive:!1}),o.addEventListener("mousedown",r,{passive:!1})}function ko(e,n){const o=[];if("ResizeObserver"in window||o.push(B(document.body,"chessground.resize",n)),!e.viewOnly){const r=Ae(e,Yn,Bn),i=Ae(e,Un,jn);for(const c of["touchmove","mousemove"])o.push(B(document,c,r));for(const c of["touchend","mouseup"])o.push(B(document,c,i));const t=()=>e.dom.bounds.clear();o.push(B(document,"scroll",t,{capture:!0,passive:!0})),o.push(B(window,"resize",t,{passive:!0}))}return()=>o.forEach(r=>r())}function B(e,n,o,r){return e.addEventListener(n,o,r),()=>e.removeEventListener(n,o,r)}const Po=e=>n=>{e.draggable.current?Y(e):e.drawable.current?Ue(e):n.shiftKey||_e(n)?e.drawable.enabled&&Ln(e,n):e.viewOnly||(e.dropmode.active?wo(e,n):Zn(e,n))},Ae=(e,n,o)=>r=>{e.drawable.current?e.drawable.enabled&&o(e,r):e.viewOnly||n(e,r)};function Co(e){const n=k(e),o=F(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,t=e.animation.current,c=t?t.plan.anims:new Map,a=t?t.plan.fadings:new Map,s=e.draggable.current,l=Mo(e),u=new Set,d=new Set,g=new Map,p=new Map;let h,f,x,M,P,z,ee,A,ne,V;for(f=r.firstChild;f;){if(h=f.cgKey,tn(f))if(x=i.get(h),P=c.get(h),z=a.get(h),M=f.cgPiece,f.cgDragging&&(!s||s.orig!==h)&&(f.classList.remove("dragging"),q(f,o(m(h),n)),f.cgDragging=!1),!z&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),x){if(P&&f.cgAnimating&&M===j(x)){const v=m(h);v[0]+=P[2],v[1]+=P[3],f.classList.add("anim"),q(f,o(v,n))}else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),q(f,o(m(h),n)),e.addPieceZIndex&&(f.style.zIndex=ie(m(h),n)));M===j(x)&&(!z||!f.cgFading)?u.add(h):z&&M===j(z)?(f.classList.add("fading"),f.cgFading=!0):te(g,M,f)}else te(g,M,f);else if(cn(f)){const v=f.className;l.get(h)===v?d.add(h):te(p,v,f)}f=f.nextSibling}for(const[v,L]of l)if(!d.has(v)){ne=p.get(L),V=ne&&ne.pop();const $=o(m(v),n);if(V)V.cgKey=v,q(V,$);else{const D=_("square",L);D.cgKey=v,q(D,$),r.insertBefore(D,r.firstChild)}}for(const[v,L]of i)if(P=c.get(v),!u.has(v))if(ee=g.get(j(L)),A=ee&&ee.pop(),A){A.cgKey=v,A.cgFading&&(A.classList.remove("fading"),A.cgFading=!1);const $=m(v);e.addPieceZIndex&&(A.style.zIndex=ie($,n)),P&&(A.cgAnimating=!0,A.classList.add("anim"),$[0]+=P[2],$[1]+=P[3]),q(A,o($,n))}else{const $=j(L),D=_("piece",$),Z=m(v);D.cgPiece=$,D.cgKey=v,P&&(D.cgAnimating=!0,Z[0]+=P[2],Z[1]+=P[3]),q(D,o(Z,n)),e.addPieceZIndex&&(D.style.zIndex=ie(Z,n)),r.appendChild(D)}for(const v of g.values())De(e,v);for(const v of p.values())De(e,v)}function So(e){const n=k(e),o=F(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(tn(r)&&!r.cgAnimating||cn(r))&&q(r,o(m(r.cgKey),n)),r=r.nextSibling}function $e(e){var n,o;const r=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,t=r.height/r.width,c=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=c*t;i.style.width=c+"px",i.style.height=a+"px",e.dom.bounds.clear(),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-width",c+"px"),(o=e.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("---cg-height",a+"px")}const tn=e=>e.tagName==="PIECE",cn=e=>e.tagName==="SQUARE";function De(e,n){for(const o of n)e.dom.elements.board.removeChild(o)}function ie(e,n){const r=e[1];return`${n?10-r:3+r}`}const j=e=>`${e.color} ${e.role}`;function Mo(e){var n,o,r;const i=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)O(i,a,"last-move");if(e.check&&e.highlight.check&&O(i,e.check,"check"),e.selected&&(O(i,e.selected,"selected"),e.movable.showDests)){const a=(n=e.movable.dests)===null||n===void 0?void 0:n.get(e.selected);if(a)for(const l of a)O(i,l,"move-dest"+(e.pieces.has(l)?" oc":""));const s=(r=(o=e.premovable.customDests)===null||o===void 0?void 0:o.get(e.selected))!==null&&r!==void 0?r:e.premovable.dests;if(s)for(const l of s)O(i,l,"premove-dest"+(e.pieces.has(l)?" oc":""))}const t=e.premovable.current;if(t)for(const a of t)O(i,a,"current-premove");else e.predroppable.current&&O(i,e.predroppable.current.key,"current-premove");const c=e.exploding;if(c)for(const a of c.keys)O(i,a,"exploding"+c.stage);return e.highlight.custom&&e.highlight.custom.forEach((a,s)=>{O(i,s,a)}),i}function O(e,n,o){const r=e.get(n);r?e.set(n,`${r} ${o}`):e.set(n,o)}function te(e,n,o){const r=e.get(n);r?r.push(o):e.set(n,[o])}function xo(e,n,o){const r=new Map,i=[];for(const a of e)r.set(a.hash,!1);let t=n.firstElementChild,c;for(;t;)c=t.getAttribute("cgHash"),r.has(c)?r.set(c,!0):i.push(t),t=t.nextElementSibling;for(const a of i)n.removeChild(a);for(const a of e)r.get(a.hash)||n.appendChild(o(a))}function Ao(e,n){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:qo(i),current:!1}));xo(r,n,i=>Do(e,i,e.dom.bounds()))}function $o(e){var n;const o=k(e),r=F(e.dom.bounds());let i=(n=e.dom.elements.autoPieces)===null||n===void 0?void 0:n.firstChild;for(;i;)Oe(i,r(m(i.cgKey),o),i.cgScale),i=i.nextSibling}function Do(e,{shape:n,hash:o},r){var i,t,c;const a=n.orig,s=(i=n.piece)===null||i===void 0?void 0:i.role,l=(t=n.piece)===null||t===void 0?void 0:t.color,u=(c=n.piece)===null||c===void 0?void 0:c.scale,d=_("piece",`${s} ${l}`);return d.setAttribute("cgHash",o),d.cgKey=a,d.cgScale=u,Oe(d,F(r)(m(a),k(e)),u),d}const qo=e=>{var n,o,r;return[e.orig,(n=e.piece)===null||n===void 0?void 0:n.role,(o=e.piece)===null||o===void 0?void 0:o.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function Oo(e,n){const o=eo();Ge(o,n||{});function r(){const i="dom"in o?o.dom.unbind:void 0,t=bo(e,o),c=gn(()=>t.board.getBoundingClientRect()),a=u=>{Co(l),t.autoPieces&&Ao(l,t.autoPieces),!u&&t.svg&&oo(l,t.svg,t.customSvg)},s=()=>{$e(l),So(l),t.autoPieces&&$o(l)},l=o;return l.dom={elements:t,bounds:c,redraw:_o(a),redrawNow:a,unbind:i},l.drawable.prevSvgHash="",$e(l),a(!1),yo(l,s),i||(l.dom.unbind=ko(l,s)),l.events.insert&&l.events.insert(t),l}return Jn(r(),r)}function _o(e){let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{e(),n=!1}))}}var Eo=un('<div><div class="board-container overflow-hidden"><div>');const To=e=>{let n,o;const[r,i]=ln(0),t=fn(()=>{if(o!=null){const c=Math.floor(o.offsetHeight/8)*8;i(c),console.log(c)}},100);return an(()=>{if(n){const c=Oo(n,{});e.game&&e.game.attach(n);const a=e.onMove;a&&c.set({movable:{events:{after:(s,l)=>a(`${s}${l}`)}}}),e.setApi&&e.setApi(c)}if(o){const c=l=>{const u=l.getBoundingClientRect();return{x:u.left+window.scrollX,y:u.top+window.scrollY,w:u.width,h:u.height}};let a=c(o);const s=()=>{const l=c(o);(l.x!=a.x||l.y!=a.y||l.w!=a.w||l.h!=a.h)&&(a=l,console.log("new"),t()),requestAnimationFrame(s)};t(),s()}}),(()=>{var c=sn(Eo),a=c.firstChild,s=a.firstChild,l=o;typeof l=="function"?ye(l,c):o=c;var u=n;return typeof u=="function"?ye(u,s):n=s,dn(d=>{var g=e.class+" board-view shrink basis-[100%] items-start justify-center flex",p=`${r()}px`,h=`board ${e.rounded?"rounded overflow-hidden":""}`;return g!==d.e&&we(c,d.e=g),p!==d.t&&((d.t=p)!=null?c.style.setProperty("max-width",p):c.style.removeProperty("max-width")),h!==d.a&&we(s,d.a=h),d},{e:void 0,t:void 0,a:void 0}),c})()};export{To as B,Oo as C};
